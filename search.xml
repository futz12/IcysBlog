<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>山东大学23强基班计算机导论第四次习题答案</title>
      <link href="/2024/03/29/%E5%B1%B1%E4%B8%9C%E5%A4%A7%E5%AD%A623%E5%BC%BA%E5%9F%BA%E7%8F%AD%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AF%BC%E8%AE%BA%E7%AC%AC%E5%9B%9B%E6%AC%A1%E4%B9%A0%E9%A2%98%E7%AD%94%E6%A1%88/"/>
      <url>/2024/03/29/%E5%B1%B1%E4%B8%9C%E5%A4%A7%E5%AD%A623%E5%BC%BA%E5%9F%BA%E7%8F%AD%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AF%BC%E8%AE%BA%E7%AC%AC%E5%9B%9B%E6%AC%A1%E4%B9%A0%E9%A2%98%E7%AD%94%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<p>T7.1</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> lower,upper;</span><br><span class="line">    cin&gt;&gt;lower&gt;&gt;upper;</span><br><span class="line">    <span class="keyword">if</span>(lower &gt; upper || upper &gt; <span class="number">100</span> || lower &lt;=<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Invalid.&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;fahr celsius&quot;</span>&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = lower;i&lt;=upper;i+=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%6.1lf\n&quot;</span>,i, <span class="number">5.0</span> * (i - <span class="number">32.0</span>)/<span class="number">9.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.2</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> N;</span><br><span class="line">    cin&gt;&gt; N;</span><br><span class="line">    <span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i&lt;= N; i++)</span><br><span class="line">        sum+= <span class="number">1.0</span> / i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum = %.6lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.3</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> N;</span><br><span class="line">    cin &gt;&gt; N;</span><br><span class="line">    <span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i&lt;= N*<span class="number">2</span> ; i += <span class="number">2</span>)</span><br><span class="line">        sum += <span class="number">1.0</span> / i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum = %.6lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.4</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> N;</span><br><span class="line">    cin&gt;&gt; N;</span><br><span class="line">    <span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( (i &amp; <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">            sum += (<span class="number">1.0</span> / (i * <span class="number">3</span> <span class="number">-2</span>));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sum -= (<span class="number">1.0</span> / (i * <span class="number">3</span> <span class="number">-2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum = %.3lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.5</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> m,n;</span><br><span class="line">    cin&gt;&gt;m&gt;&gt;n;</span><br><span class="line">    <span class="type">double</span> sum =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=m;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += i*i + <span class="number">1.0</span>/i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum = %.6lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.6</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> N;</span><br><span class="line">    cin &gt;&gt; N;</span><br><span class="line">    <span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i&lt;=N;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (i &amp; <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">            sum += i / ( <span class="number">2</span>*i <span class="number">-1.0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sum -= i / ( <span class="number">2</span> *i <span class="number">-1.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.7</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> esp;</span><br><span class="line">    cin&gt;&gt; esp;</span><br><span class="line">    <span class="type">int</span> cur = <span class="number">1</span>;</span><br><span class="line">    <span class="type">double</span> sum =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (cur &amp; <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">            sum+=<span class="number">1.0</span>/(cur * <span class="number">3.0</span> <span class="number">-2.0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sum-=<span class="number">1.0</span>/(cur * <span class="number">3.0</span> <span class="number">-2.0</span>);</span><br><span class="line">        cur++;</span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="number">1.0</span>/(cur * <span class="number">3.0</span> <span class="number">-2.0</span>) &gt;= esp);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum = %.6lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.8</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,N;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;N;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(N--)</span><br><span class="line">    &#123;</span><br><span class="line">        count ++;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        cin&gt;&gt;n;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(n &gt; a)</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;Too big&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(n&lt;a)</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;Too small&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(count == <span class="number">1</span>)</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;Bingo!&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(count &lt;=<span class="number">3</span>)</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;Lucky You!&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;Good Guess!&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Game Over&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.9</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="type">double</span> sum =<span class="number">1</span> ;</span><br><span class="line">    <span class="type">double</span> gamma = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;=n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        gamma *= i;</span><br><span class="line">        sum += <span class="number">1.0</span> / gamma;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.8lf&quot;</span>,sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T7.10</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    int minn;</span><br><span class="line">    cin&gt;&gt;minn;</span><br><span class="line">    while(--n)</span><br><span class="line">    &#123;</span><br><span class="line">        int num;</span><br><span class="line">        cin&gt;&gt;num;</span><br><span class="line">        minn = min(minn,num);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;&quot;min = &quot;&lt;&lt;minn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 山东大学习题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 山东大学习题,C++,C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 OpenCV 进行文档矫正</title>
      <link href="/2024/03/26/%E4%BD%BF%E7%94%A8%20OpenCV%20%E8%BF%9B%E8%A1%8C%E6%96%87%E6%A1%A3%E7%9F%AB%E6%AD%A3/"/>
      <url>/2024/03/26/%E4%BD%BF%E7%94%A8%20OpenCV%20%E8%BF%9B%E8%A1%8C%E6%96%87%E6%A1%A3%E7%9F%AB%E6%AD%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-OpenCV-进行文档矫正"><a href="#使用-OpenCV-进行文档矫正" class="headerlink" title="使用 OpenCV 进行文档矫正"></a>使用 OpenCV 进行文档矫正</h1><blockquote><p>本文只发布于<a href="https://www.cnblogs.com/icys">博客园</a>与<a href="https://www.pchar.cn/">pchar博客</a></p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;std::vector&lt;cv::Point&gt;&gt; cvhelper::<span class="built_in">findCorners</span>(<span class="type">const</span> cv::Mat &amp;image) &#123;</span><br><span class="line">    cv::Mat gaussImage;</span><br><span class="line">    cv::<span class="built_in">GaussianBlur</span>(image, gaussImage, cv::<span class="built_in">Size</span>(<span class="number">5</span>, <span class="number">5</span>), <span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">threshold</span>(gaussImage, gaussImage, <span class="number">0</span>, <span class="number">255</span>, cv::THRESH_BINARY | cv::THRESH_OTSU);</span><br><span class="line">    cv::<span class="built_in">Canny</span>(gaussImage, gaussImage, <span class="number">50</span>, <span class="number">200</span>);</span><br><span class="line">    cv::<span class="built_in">morphologyEx</span>(gaussImage, gaussImage, cv::MORPH_CLOSE,</span><br><span class="line">                     cv::Mat::<span class="built_in">ones</span>(<span class="number">5</span>, <span class="number">5</span>, CV_32F));</span><br><span class="line">    std::vector&lt;std::vector&lt;cv::Point&gt;&gt; contours;</span><br><span class="line">    std::vector&lt;cv::Vec4i&gt; hierarchy;</span><br><span class="line">    cv::<span class="built_in">findContours</span>(gaussImage, contours, hierarchy, cv::RETR_LIST, cv::CHAIN_APPROX_SIMPLE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::vector&lt;cv::Point&gt;&gt; ret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;contour: contours) &#123;</span><br><span class="line">        <span class="type">double</span> peri = cv::<span class="built_in">arcLength</span>(contour, <span class="literal">true</span>);</span><br><span class="line">        std::vector&lt;cv::Point&gt; approx;</span><br><span class="line">        cv::<span class="built_in">approxPolyDP</span>(contour, approx, <span class="number">0.05</span> * peri, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (approx.<span class="built_in">size</span>() == <span class="number">4</span> &amp;&amp; cv::<span class="built_in">isContourConvex</span>(approx) &amp;&amp; cv::<span class="built_in">contourArea</span>(approx) &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(approx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cvhelper::GetDocumentRect</span><span class="params">(cv::Mat &amp;src, std::vector&lt;cv::Point&gt; &amp;ret_points)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> shrunkImageHeight = <span class="number">500</span>;</span><br><span class="line">    cv::Mat shrunkImage;</span><br><span class="line">    cv::<span class="built_in">resize</span>(src, shrunkImage, cv::<span class="built_in">Size</span>(shrunkImageHeight * src.cols / src.rows, shrunkImageHeight));</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(shrunkImage, shrunkImage, cv::COLOR_BGR2Luv);</span><br><span class="line">    std::vector&lt;cv::Mat&gt; channels;</span><br><span class="line">    cv::<span class="built_in">split</span>(shrunkImage, channels);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::vector&lt;cv::Point&gt;&gt; documentCorners;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;channel: channels) &#123;</span><br><span class="line">        std::vector&lt;std::vector&lt;cv::Point&gt;&gt; corners = <span class="built_in">findCorners</span>(channel);</span><br><span class="line">        <span class="keyword">if</span> (!corners.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">double</span> maxArea = <span class="number">0.0</span>;</span><br><span class="line">            std::vector&lt;cv::Point&gt; maxAreaContourIt;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;contour: corners) &#123;</span><br><span class="line">                <span class="type">double</span> area = cv::<span class="built_in">contourArea</span>(contour);</span><br><span class="line">                <span class="keyword">if</span> (area &gt; maxArea) &#123;</span><br><span class="line">                    maxArea = area;</span><br><span class="line">                    maxAreaContourIt = contour;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (maxArea &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                std::vector&lt;cv::Point&gt; scaledContour;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;point: maxAreaContourIt) &#123;</span><br><span class="line">                    cv::Point scaledPoint;</span><br><span class="line">                    scaledPoint.x = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(point.x * <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(src.rows) /</span><br><span class="line">                                                     shrunkImageHeight);</span><br><span class="line">                    scaledPoint.y = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(point.y * <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(src.rows) /</span><br><span class="line">                                                     shrunkImageHeight);</span><br><span class="line">                    scaledContour.<span class="built_in">push_back</span>(scaledPoint);</span><br><span class="line">                &#125;</span><br><span class="line">                documentCorners.<span class="built_in">push_back</span>(scaledContour);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (documentCorners.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;cv::Point&gt; maxDocumentCorners;</span><br><span class="line">    <span class="type">double</span> maxDocumentArea = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;documentCorner: documentCorners) &#123;</span><br><span class="line">        <span class="type">double</span> area = cv::<span class="built_in">contourArea</span>(documentCorner);</span><br><span class="line">        <span class="keyword">if</span> (area &gt; maxDocumentArea) &#123;</span><br><span class="line">            maxDocumentArea = area;</span><br><span class="line">            maxDocumentCorners = documentCorner;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret_points = maxDocumentCorners;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">cvhelper::CutKeyPosition</span><span class="params">(cv::Mat &amp;src, std::vector&lt;cv::Point2f&gt; &amp;src_points)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 透视变换</span></span><br><span class="line">    cv::Point2f dst_points[<span class="number">4</span>];</span><br><span class="line">    dst_points[<span class="number">0</span>] = cv::<span class="built_in">Point2f</span>(src.cols, <span class="number">0</span>);</span><br><span class="line">    dst_points[<span class="number">1</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    dst_points[<span class="number">2</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, src.rows);</span><br><span class="line">    dst_points[<span class="number">3</span>] = cv::<span class="built_in">Point2f</span>(src.cols, src.rows);</span><br><span class="line"></span><br><span class="line">    cv::Point2f tL = src_points[<span class="number">1</span>];</span><br><span class="line">    cv::Point2f tR = src_points[<span class="number">0</span>];</span><br><span class="line">    cv::Point2f bR = src_points[<span class="number">3</span>];</span><br><span class="line">    cv::Point2f bL = src_points[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> width = (std::min)(cv::<span class="built_in">norm</span>(tR - tL), cv::<span class="built_in">norm</span>(bR - bL));</span><br><span class="line">    <span class="type">int</span> height = (std::min)(cv::<span class="built_in">norm</span>(tR - bR), cv::<span class="built_in">norm</span>(tL - bL));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cv::Mat M = cv::<span class="built_in">getPerspectiveTransform</span>(src_points.<span class="built_in">data</span>(), dst_points);</span><br><span class="line">    cv::Mat dst;</span><br><span class="line">    cv::<span class="built_in">warpPerspective</span>(src, dst, M, src.<span class="built_in">size</span>());</span><br><span class="line">    <span class="comment">// 缩放图像</span></span><br><span class="line">    cv::<span class="built_in">resize</span>(dst, dst, cv::<span class="built_in">Size</span>(width, height));</span><br><span class="line">    <span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>效果展示</p><img src="data:image/webp;base64,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"/>]]></content>
      
      
      <categories>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> OpenCV </tag>
            
            <tag> 计算机视觉 </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>winrt新dx截图最小实现</title>
      <link href="/2024/03/25/winrt%E6%96%B0dx%E6%88%AA%E5%9B%BE%E6%9C%80%E5%B0%8F%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/03/25/winrt%E6%96%B0dx%E6%88%AA%E5%9B%BE%E6%9C%80%E5%B0%8F%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>转自：<a href="https://stackoverflow.co/questions/11283015">https://stackoverflow.co/questions/11283015</a><br>效果还是很不错的</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dxgi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inspectable.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dxgi1_2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;d3d11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winrt/Windows.Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winrt/Windows.System.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winrt/Windows.Graphics.Capture.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.graphics.capture.interop.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.graphics.directx.direct3d11.interop.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;roerrorapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;shlobj_core.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dwmapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;Dwmapi.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;windowsapp.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CaptureWindow</span><span class="params">(HWND hwndTarget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Init COM</span></span><br><span class="line">    winrt::<span class="built_in">init_apartment</span>(winrt::apartment_type::multi_threaded);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create Direct 3D Device</span></span><br><span class="line">    winrt::com_ptr&lt;ID3D11Device&gt; d3dDevice;</span><br><span class="line"></span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(<span class="built_in">D3D11CreateDevice</span>(<span class="literal">nullptr</span>, D3D_DRIVER_TYPE_HARDWARE, <span class="literal">nullptr</span>, D3D11_CREATE_DEVICE_BGRA_SUPPORT,</span><br><span class="line">                                           <span class="literal">nullptr</span>, <span class="number">0</span>,D3D11_SDK_VERSION, d3dDevice.<span class="built_in">put</span>(), <span class="literal">nullptr</span>, <span class="literal">nullptr</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    winrt::Windows::Graphics::DirectX::Direct3D11::IDirect3DDevice device;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> dxgiDevice = d3dDevice.<span class="built_in">as</span>&lt;IDXGIDevice&gt;();</span><br><span class="line">    &#123;</span><br><span class="line">        winrt::com_ptr&lt;::IInspectable&gt; inspectable;</span><br><span class="line">        winrt::<span class="built_in">check_hresult</span>(<span class="built_in">CreateDirect3D11DeviceFromDXGIDevice</span>(dxgiDevice.<span class="built_in">get</span>(), inspectable.<span class="built_in">put</span>()));</span><br><span class="line">        device = inspectable.<span class="built_in">as</span>&lt;winrt::Windows::Graphics::DirectX::Direct3D11::IDirect3DDevice&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> idxgiDevice2 = dxgiDevice.<span class="built_in">as</span>&lt;IDXGIDevice2&gt;();</span><br><span class="line">    winrt::com_ptr&lt;IDXGIAdapter&gt; adapter;</span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(idxgiDevice2-&gt;<span class="built_in">GetParent</span>(winrt::<span class="built_in">guid_of</span>&lt;IDXGIAdapter&gt;(), adapter.<span class="built_in">put_void</span>()));</span><br><span class="line">    winrt::com_ptr&lt;IDXGIFactory2&gt; factory;</span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(adapter-&gt;<span class="built_in">GetParent</span>(winrt::<span class="built_in">guid_of</span>&lt;IDXGIFactory2&gt;(), factory.<span class="built_in">put_void</span>()));</span><br><span class="line"></span><br><span class="line">    ID3D11DeviceContext* d3dContext = <span class="literal">nullptr</span>;</span><br><span class="line">    d3dDevice-&gt;<span class="built_in">GetImmediateContext</span>(&amp;d3dContext);</span><br><span class="line"></span><br><span class="line">    RECT rect&#123;&#125;;</span><br><span class="line">    <span class="built_in">DwmGetWindowAttribute</span>(hwndTarget, DWMWA_EXTENDED_FRAME_BOUNDS, &amp;rect, <span class="built_in">sizeof</span>(RECT));</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> size = winrt::Windows::Graphics::SizeInt32&#123;rect.right - rect.left, rect.bottom - rect.top&#125;;</span><br><span class="line"></span><br><span class="line">    winrt::Windows::Graphics::Capture::Direct3D11CaptureFramePool m_framePool =</span><br><span class="line">        winrt::Windows::Graphics::Capture::Direct3D11CaptureFramePool::<span class="built_in">Create</span>(</span><br><span class="line">            device,</span><br><span class="line">            winrt::Windows::Graphics::DirectX::DirectXPixelFormat::B8G8R8A8UIntNormalized,</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            size);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> activationFactory = winrt::<span class="built_in">get_activation_factory</span>&lt;</span><br><span class="line">        winrt::Windows::Graphics::Capture::GraphicsCaptureItem&gt;();</span><br><span class="line">    <span class="keyword">auto</span> interopFactory = activationFactory.<span class="built_in">as</span>&lt;IGraphicsCaptureItemInterop&gt;();</span><br><span class="line">    winrt::Windows::Graphics::Capture::GraphicsCaptureItem captureItem = &#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    interopFactory-&gt;<span class="built_in">CreateForWindow</span>(hwndTarget, winrt::<span class="built_in">guid_of</span>&lt;ABI::Windows::Graphics::Capture::IGraphicsCaptureItem&gt;(),</span><br><span class="line">                                    <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>**&gt;(winrt::<span class="built_in">put_abi</span>(captureItem)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> isFrameArrived = <span class="literal">false</span>;</span><br><span class="line">    winrt::com_ptr&lt;ID3D11Texture2D&gt; texture;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> session = m_framePool.<span class="built_in">CreateCaptureSession</span>(captureItem);</span><br><span class="line">    m_framePool.<span class="built_in">FrameArrived</span>([&amp;](<span class="keyword">auto</span>&amp; framePool, <span class="keyword">auto</span>&amp;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFrameArrived) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">auto</span> frame = framePool.<span class="built_in">TryGetNextFrame</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> __declspec(<span class="built_in">uuid</span>(<span class="string">&quot;A9B3D012-3DF2-4EE3-B8D1-8695F457D3C1&quot;</span>))</span><br><span class="line">            IDirect3DDxgiInterfaceAccess : ::IUnknown</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">virtual</span> HRESULT __stdcall <span class="built_in">GetInterface</span>(GUID <span class="type">const</span>&amp; id, <span class="type">void</span>** object) = <span class="number">0</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> access = frame.<span class="built_in">Surface</span>().<span class="built_in">as</span>&lt;IDirect3DDxgiInterfaceAccess&gt;();</span><br><span class="line">        access-&gt;<span class="built_in">GetInterface</span>(winrt::<span class="built_in">guid_of</span>&lt;ID3D11Texture2D&gt;(), texture.<span class="built_in">put_void</span>());</span><br><span class="line">        isFrameArrived = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    session.<span class="built_in">IsCursorCaptureEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    session.<span class="built_in">StartCapture</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Message pump</span></span><br><span class="line">    MSG msg;</span><br><span class="line">    <span class="type">clock_t</span> timer = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="keyword">while</span> (!isFrameArrived)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">PeekMessage</span>(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, PM_REMOVE) &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">clock</span>() - timer &gt; <span class="number">20000</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> try to make here a better error handling</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    session.<span class="built_in">Close</span>();</span><br><span class="line"></span><br><span class="line">    D3D11_TEXTURE2D_DESC capturedTextureDesc;</span><br><span class="line">    texture-&gt;<span class="built_in">GetDesc</span>(&amp;capturedTextureDesc);</span><br><span class="line"></span><br><span class="line">    capturedTextureDesc.Usage = D3D11_USAGE_STAGING;</span><br><span class="line">    capturedTextureDesc.BindFlags = <span class="number">0</span>;</span><br><span class="line">    capturedTextureDesc.CPUAccessFlags = D3D11_CPU_ACCESS_READ;</span><br><span class="line">    capturedTextureDesc.MiscFlags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    winrt::com_ptr&lt;ID3D11Texture2D&gt; userTexture = <span class="literal">nullptr</span>;</span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(d3dDevice-&gt;<span class="built_in">CreateTexture2D</span>(&amp;capturedTextureDesc, <span class="literal">NULL</span>, userTexture.<span class="built_in">put</span>()));</span><br><span class="line"></span><br><span class="line">    d3dContext-&gt;<span class="built_in">CopyResource</span>(userTexture.<span class="built_in">get</span>(), texture.<span class="built_in">get</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    D3D11_MAPPED_SUBRESOURCE resource;</span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(d3dContext-&gt;<span class="built_in">Map</span>(userTexture.<span class="built_in">get</span>(), <span class="literal">NULL</span>, D3D11_MAP_READ, <span class="number">0</span>, &amp;resource));</span><br><span class="line"></span><br><span class="line">    BITMAPINFO lBmpInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BMP 32 bpp</span></span><br><span class="line">    <span class="built_in">ZeroMemory</span>(&amp;lBmpInfo, <span class="built_in">sizeof</span>(BITMAPINFO));</span><br><span class="line">    lBmpInfo.bmiHeader.biSize = <span class="built_in">sizeof</span>(BITMAPINFOHEADER);</span><br><span class="line">    lBmpInfo.bmiHeader.biBitCount = <span class="number">32</span>;</span><br><span class="line">    lBmpInfo.bmiHeader.biCompression = BI_RGB;</span><br><span class="line">    lBmpInfo.bmiHeader.biWidth = capturedTextureDesc.Width;</span><br><span class="line">    lBmpInfo.bmiHeader.biHeight = capturedTextureDesc.Height;</span><br><span class="line">    lBmpInfo.bmiHeader.biPlanes = <span class="number">1</span>;</span><br><span class="line">    lBmpInfo.bmiHeader.biSizeImage = capturedTextureDesc.Width * capturedTextureDesc.Height * <span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::unique_ptr&lt;BYTE&gt; <span class="title">pBuf</span><span class="params">(<span class="keyword">new</span> BYTE[lBmpInfo.bmiHeader.biSizeImage])</span></span>;</span><br><span class="line">    UINT lBmpRowPitch = capturedTextureDesc.Width * <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">auto</span> sptr = <span class="built_in">static_cast</span>&lt;BYTE*&gt;(resource.pData);</span><br><span class="line">    <span class="keyword">auto</span> dptr = pBuf.<span class="built_in">get</span>() + lBmpInfo.bmiHeader.biSizeImage - lBmpRowPitch;</span><br><span class="line"></span><br><span class="line">    UINT lRowPitch = std::<span class="built_in">min</span>&lt;UINT&gt;(lBmpRowPitch, resource.RowPitch);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> h = <span class="number">0</span>; h &lt; capturedTextureDesc.Height; ++h)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy_s</span>(dptr, lBmpRowPitch, sptr, lRowPitch);</span><br><span class="line">        sptr += resource.RowPitch;</span><br><span class="line">        dptr -= lBmpRowPitch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save bitmap buffer into the file ScreenShot.bmp</span></span><br><span class="line">    WCHAR lMyDocPath[MAX_PATH];</span><br><span class="line"></span><br><span class="line">    winrt::<span class="built_in">check_hresult</span>(<span class="built_in">SHGetFolderPath</span>(<span class="literal">nullptr</span>, CSIDL_PERSONAL, <span class="literal">nullptr</span>, SHGFP_TYPE_CURRENT, lMyDocPath));</span><br><span class="line"></span><br><span class="line">    std::wstring lFilePath = <span class="string">L&quot;ScreenShot.bmp&quot;</span>;</span><br><span class="line"></span><br><span class="line">    FILE* lfile = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> lerr = _wfopen_s(&amp;lfile, lFilePath.<span class="built_in">c_str</span>(), <span class="string">L&quot;wb&quot;</span>); lerr != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lfile != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        BITMAPFILEHEADER bmpFileHeader;</span><br><span class="line"></span><br><span class="line">        bmpFileHeader.bfReserved1 = <span class="number">0</span>;</span><br><span class="line">        bmpFileHeader.bfReserved2 = <span class="number">0</span>;</span><br><span class="line">        bmpFileHeader.bfSize = <span class="built_in">sizeof</span>(BITMAPFILEHEADER) + <span class="built_in">sizeof</span>(BITMAPINFOHEADER) + lBmpInfo.bmiHeader.biSizeImage;</span><br><span class="line">        bmpFileHeader.bfType = <span class="string">&#x27;MB&#x27;</span>;</span><br><span class="line">        bmpFileHeader.bfOffBits = <span class="built_in">sizeof</span>(BITMAPFILEHEADER) + <span class="built_in">sizeof</span>(BITMAPINFOHEADER);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fwrite</span>(&amp;bmpFileHeader, <span class="built_in">sizeof</span>(BITMAPFILEHEADER), <span class="number">1</span>, lfile);</span><br><span class="line">        <span class="built_in">fwrite</span>(&amp;lBmpInfo.bmiHeader, <span class="built_in">sizeof</span>(BITMAPINFOHEADER), <span class="number">1</span>, lfile);</span><br><span class="line">        <span class="built_in">fwrite</span>(pBuf.<span class="built_in">get</span>(), lBmpInfo.bmiHeader.biSizeImage, <span class="number">1</span>, lfile);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fclose</span>(lfile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Windows </tag>
            
            <tag> DXGI </tag>
            
            <tag> winrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C语言简易万年历带注释</title>
      <link href="/2024/03/25/C%E8%AF%AD%E8%A8%80%E7%AE%80%E6%98%93%E4%B8%87%E5%B9%B4%E5%8E%86%E5%B8%A6%E6%B3%A8%E9%87%8A/"/>
      <url>/2024/03/25/C%E8%AF%AD%E8%A8%80%E7%AE%80%E6%98%93%E4%B8%87%E5%B9%B4%E5%8E%86%E5%B8%A6%E6%B3%A8%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<p>同学问的课后作业，顺便加了写注释。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 注意 每周的第一天是星期天</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> day_per_mo[<span class="number">12</span>] = &#123;</span><br><span class="line">            <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>,</span><br><span class="line">            <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span></span><br><span class="line">    &#125;;  <span class="comment">// 12个月的天数</span></span><br><span class="line">    <span class="type">int</span> fir_weekday[<span class="number">12</span>]; <span class="comment">// 12个月的第一天是星期几</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, year = <span class="number">0</span>, month;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;输入年份:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;year);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (year % <span class="number">400</span> == <span class="number">0</span> || (year % <span class="number">100</span> != <span class="number">0</span> &amp;&amp; year % <span class="number">4</span> == <span class="number">0</span>)) &#123; <span class="comment">// 判断是否为闰年</span></span><br><span class="line">        day_per_mo[<span class="number">1</span>] = <span class="number">29</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fir_weekday[<span class="number">0</span>] =</span><br><span class="line">            (<span class="type">int</span>) (year - <span class="number">1</span> + (year - <span class="number">1</span>) / <span class="number">4.0</span> - (year - <span class="number">1</span>) / <span class="number">100.0</span> + (year - <span class="number">1</span>) / <span class="number">400.0</span> + <span class="number">1</span>) % <span class="number">7</span>; <span class="comment">// 计算该年第一天是星期几</span></span><br><span class="line">    <span class="comment">// 365 % 7 = 1</span></span><br><span class="line">    <span class="comment">// 366 % 7 = 2</span></span><br><span class="line">    <span class="comment">// 距离公元元年的天数 + 闰年数 同余 当年第一天是星期几 mod 7</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">12</span>; i++) &#123;</span><br><span class="line">        fir_weekday[i] = (day_per_mo[i - <span class="number">1</span>] + fir_weekday[i - <span class="number">1</span>]) % <span class="number">7</span>;<span class="comment">// 计算每个月的第一天是星期几</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> opt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;请输入月份:&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;opt);</span><br><span class="line">        <span class="keyword">if</span> (opt &lt; <span class="number">0</span> || opt &gt; <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;输入错误&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (month = <span class="number">0</span>; month &lt; <span class="number">12</span>; month++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (opt != <span class="number">0</span> &amp;&amp; opt != month + <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n %d月\n&quot;</span>, month + <span class="number">1</span>);  <span class="comment">// 输出月份</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n 日 一 二 三 四 五 六\n&quot;</span>); <span class="comment">// 输出星期表头</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; fir_weekday[month] * <span class="number">3</span>; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>); <span class="comment">// 输出第一天前的空格，占用位</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= day_per_mo[month]; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%3d&quot;</span>, i); <span class="comment">// 输出日期</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((i + fir_weekday[month]) % <span class="number">7</span> == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>); <span class="comment">// 到周六换行</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AVX256加速矩阵乘法</title>
      <link href="/2024/03/25/AVX256%E5%8A%A0%E9%80%9F%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/"/>
      <url>/2024/03/25/AVX256%E5%8A%A0%E9%80%9F%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>最近打PKU的HPCGAME留下的代码，速度不是很快</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> BLOCK_SIZE = <span class="number">1024</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BLOCK_SIZE2 = <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">block_avx256_16x2</span><span class="params">(    <span class="comment">// 电脑不支持AVX512捏</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">int</span> n,<span class="type">int</span> K, <span class="comment">//方阵大小</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">__m256d c0000_0300, c0400_0700, c0800_1100, c1200_1500,</span><br><span class="line">c0001_0301, c0401_0701, c0801_1101, c1201_1501;</span><br><span class="line"></span><br><span class="line">__m256d a0x_3x, a4x_7x, a8x_11x, a12x_15x,</span><br><span class="line">bx0, bx1;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>* c0001_0301_ptr = C + n;</span><br><span class="line"></span><br><span class="line">c0000_0300 = _mm256_load_pd(C);</span><br><span class="line">c0400_0700 = _mm256_load_pd(C + <span class="number">4</span>);</span><br><span class="line">c0800_1100 = _mm256_load_pd(C + <span class="number">8</span>);</span><br><span class="line">c1200_1500 = _mm256_load_pd(C + <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">c0001_0301 = _mm256_load_pd(c0001_0301_ptr);</span><br><span class="line">c0401_0701 = _mm256_load_pd(c0001_0301_ptr + <span class="number">4</span>);</span><br><span class="line">c0801_1101 = _mm256_load_pd(c0001_0301_ptr + <span class="number">8</span>);</span><br><span class="line">c1201_1501 = _mm256_load_pd(c0001_0301_ptr + <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; K; ++x)</span><br><span class="line">&#123;</span><br><span class="line">a0x_3x = _mm256_load_pd(A);</span><br><span class="line">a4x_7x = _mm256_load_pd(A + <span class="number">4</span>);</span><br><span class="line">a8x_11x = _mm256_load_pd(A + <span class="number">8</span>);</span><br><span class="line">a12x_15x = _mm256_load_pd(A + <span class="number">12</span>);</span><br><span class="line">A+= <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">bx0 = _mm256_broadcast_sd(B++);</span><br><span class="line">bx1 = _mm256_broadcast_sd(B++);</span><br><span class="line"></span><br><span class="line">c0000_0300 = _mm256_add_pd(_mm256_mul_pd(a0x_3x, bx0), c0000_0300);</span><br><span class="line">c0400_0700 = _mm256_add_pd(_mm256_mul_pd(a4x_7x, bx0), c0400_0700);</span><br><span class="line">c0800_1100 = _mm256_add_pd(_mm256_mul_pd(a8x_11x, bx0), c0800_1100);</span><br><span class="line">c1200_1500 = _mm256_add_pd(_mm256_mul_pd(a12x_15x, bx0), c1200_1500);</span><br><span class="line"></span><br><span class="line">c0001_0301 = _mm256_add_pd(_mm256_mul_pd(a0x_3x, bx1), c0001_0301);</span><br><span class="line">c0401_0701 = _mm256_add_pd(_mm256_mul_pd(a4x_7x, bx1), c0401_0701);</span><br><span class="line">c0801_1101 = _mm256_add_pd(_mm256_mul_pd(a8x_11x, bx1), c0801_1101);</span><br><span class="line">c1201_1501 = _mm256_add_pd(_mm256_mul_pd(a12x_15x, bx1), c1201_1501);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_mm256_storeu_pd(C, c0000_0300);</span><br><span class="line">_mm256_storeu_pd(C + <span class="number">4</span>, c0400_0700);</span><br><span class="line">_mm256_storeu_pd(C + <span class="number">8</span>, c0800_1100);</span><br><span class="line">_mm256_storeu_pd(C + <span class="number">12</span>, c1200_1500);</span><br><span class="line"></span><br><span class="line">_mm256_storeu_pd(c0001_0301_ptr, c0001_0301);</span><br><span class="line">_mm256_storeu_pd(c0001_0301_ptr + <span class="number">4</span>, c0401_0701);</span><br><span class="line">_mm256_storeu_pd(c0001_0301_ptr + <span class="number">8</span>, c0801_1101);</span><br><span class="line">_mm256_storeu_pd(c0001_0301_ptr + <span class="number">12</span>, c1201_1501);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">copy_b</span><span class="params">(<span class="type">int</span> lda, <span class="type">const</span> <span class="type">int</span> K, <span class="type">double</span>* b_src, <span class="type">double</span>* b_dest)</span> </span>&#123;</span><br><span class="line"><span class="type">double</span>* b_ptr0, * b_ptr1;</span><br><span class="line">b_ptr0 = b_src;</span><br><span class="line">b_ptr1 = b_ptr0 + lda;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; K; ++i)</span><br><span class="line">&#123;</span><br><span class="line">*b_dest++ = *b_ptr0++;</span><br><span class="line">*b_dest++ = *b_ptr1++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">copy_a</span><span class="params">(<span class="type">int</span> lda, <span class="type">const</span> <span class="type">int</span> K, <span class="type">double</span>* a_src, <span class="type">double</span>* a_dest)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; K; ++i)</span><br><span class="line">&#123;</span><br><span class="line">*a_dest++ = *a_src;</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">1</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">2</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">3</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">4</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">5</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">6</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">7</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">8</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">9</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">10</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">11</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">12</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">13</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">14</span>);</span><br><span class="line">*a_dest++ = *(a_src + <span class="number">15</span>);</span><br><span class="line">a_src += lda;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">do_block</span><span class="params">(<span class="type">int</span> lda, <span class="type">int</span> M, <span class="type">int</span> N, <span class="type">int</span> K, <span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span> *A_block, *B_block;</span><br><span class="line">A_block = (<span class="type">double</span>*)_mm_malloc(M * K * <span class="built_in">sizeof</span>(<span class="type">double</span>), <span class="number">64</span>);</span><br><span class="line">B_block = (<span class="type">double</span>*)_mm_malloc(K * N * <span class="built_in">sizeof</span>(<span class="type">double</span>), <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>* a_ptr, * b_ptr, * c;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Nmax = N - <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> Mmax = M - <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nmax; j += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">b_ptr = &amp;B_block[j * K];</span><br><span class="line"><span class="built_in">copy_b</span>(lda, K, B + j * lda, b_ptr); <span class="comment">// 将 B 展开</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Mmax; i += <span class="number">16</span>) &#123;</span><br><span class="line">a_ptr = &amp;A_block[i * K];</span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">0</span>) <span class="built_in">copy_a</span>(lda, K, A + i, a_ptr); <span class="comment">// 将 A 展开</span></span><br><span class="line">c = C + i + j * lda;</span><br><span class="line"><span class="built_in">block_avx256_16x2</span>(lda, K, a_ptr, b_ptr, c);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">_mm_free(A_block);</span><br><span class="line">_mm_free(B_block);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gemm</span><span class="params">(<span class="type">int</span> lda, <span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> omp parallel for</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; lda; j += BLOCK_SIZE) &#123;    <span class="comment">// j i k 序 内存读写更快</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lda; i += BLOCK_SIZE) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; lda; k += BLOCK_SIZE) &#123;</span><br><span class="line"><span class="comment">// 大分块里小分块</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> jj = j; jj &lt; j + BLOCK_SIZE; jj += BLOCK_SIZE2)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> ii = i; ii &lt; i + BLOCK_SIZE; ii += BLOCK_SIZE2)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> kk = k; kk &lt; k + BLOCK_SIZE; kk += BLOCK_SIZE2)</span><br><span class="line"><span class="built_in">do_block</span>(lda, BLOCK_SIZE2, BLOCK_SIZE2, BLOCK_SIZE2, A + ii + kk * lda, B + kk + jj * lda, C + ii + jj * lda);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 高性能计算 </tag>
            
            <tag> 汇编 </tag>
            
            <tag> AVX </tag>
            
            <tag> SMID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AVX512加速矩阵乘法</title>
      <link href="/2024/03/25/AVX512%E5%8A%A0%E9%80%9F%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/"/>
      <url>/2024/03/25/AVX512%E5%8A%A0%E9%80%9F%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>最近打PKU的HPCGAME用的代码，这里只用上了20个zmm寄存器，改变block的大小应该还能优化一下速度。</p><blockquote><p>代码只考虑了方阵，其他非2^n次方阵要自己改代码。具体原理很简单，看看代码就差不多知道。</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> BLOCK_SIZE = <span class="number">1024</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BLOCK_SIZE2 = <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">block_avx512_32x4</span><span class="params">(<span class="comment">// AVX256效果不好，硬着头皮上吧(汇编上看好像还有12个寄存器没用上，还有优化空间)</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">int</span> n, <span class="type">int</span> K, <span class="comment">//方阵大小</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">__m512d c0000_0700,c0800_1500, c1600_2300, c2400_3100,</span><br><span class="line">c0001_0701, c0801_1501, c1601_2301, c2401_3101,</span><br><span class="line">c0002_0702, c0802_1502, c1602_2302, c2402_3102,</span><br><span class="line">c0003_0703, c0803_1503, c1603_2303, c2403_3103;</span><br><span class="line"></span><br><span class="line">__m512d a0x_7x, a8x_15x, a16x_23x, a24x_31x,</span><br><span class="line">bx0, bx1, bx2, bx3;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>* c0001_0701_ptr = C + n;</span><br><span class="line"><span class="type">double</span>* c0002_0702_ptr = C + n * <span class="number">2</span>;</span><br><span class="line"><span class="type">double</span>* c0003_0703_ptr = C + n * <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">c0000_0700 = _mm512_load_pd(C);</span><br><span class="line">c0800_1500 = _mm512_load_pd(C + <span class="number">8</span>);</span><br><span class="line">c1600_2300 = _mm512_load_pd(C + <span class="number">16</span>);</span><br><span class="line">c2400_3100 = _mm512_load_pd(C + <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">c0001_0701 = _mm512_load_pd(c0001_0701_ptr);</span><br><span class="line">c0801_1501 = _mm512_load_pd(c0001_0701_ptr + <span class="number">8</span>);</span><br><span class="line">c1601_2301 = _mm512_load_pd(c0001_0701_ptr + <span class="number">16</span>);</span><br><span class="line">c2401_3101 = _mm512_load_pd(c0001_0701_ptr + <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">c0002_0702 = _mm512_load_pd(c0002_0702_ptr);</span><br><span class="line">c0802_1502 = _mm512_load_pd(c0002_0702_ptr + <span class="number">8</span>);</span><br><span class="line">c1602_2302 = _mm512_load_pd(c0002_0702_ptr + <span class="number">16</span>);</span><br><span class="line">c2402_3102 = _mm512_load_pd(c0002_0702_ptr + <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">c0003_0703 = _mm512_load_pd(c0003_0703_ptr);</span><br><span class="line">c0803_1503 = _mm512_load_pd(c0003_0703_ptr + <span class="number">8</span>);</span><br><span class="line">c1603_2303 = _mm512_load_pd(c0003_0703_ptr + <span class="number">16</span>);</span><br><span class="line">c2403_3103 = _mm512_load_pd(c0003_0703_ptr + <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; K; ++x)</span><br><span class="line">&#123;</span><br><span class="line">a0x_7x = _mm512_load_pd(A);</span><br><span class="line">a8x_15x = _mm512_load_pd(A + <span class="number">8</span>);</span><br><span class="line">a16x_23x = _mm512_load_pd(A + <span class="number">16</span>);</span><br><span class="line">a24x_31x = _mm512_load_pd(A + <span class="number">24</span>);</span><br><span class="line">A += <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">bx0 = _mm512_broadcastsd_pd(_mm_load_sd(B++));</span><br><span class="line">bx1 = _mm512_broadcastsd_pd(_mm_load_sd(B++));</span><br><span class="line">bx2 = _mm512_broadcastsd_pd(_mm_load_sd(B++));</span><br><span class="line">bx3 = _mm512_broadcastsd_pd(_mm_load_sd(B++));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c0000_0700 = _mm512_add_pd(_mm512_mul_pd(a0x_7x, bx0), c0000_0700);</span><br><span class="line">c0800_1500 = _mm512_add_pd(_mm512_mul_pd(a8x_15x, bx0), c0800_1500);</span><br><span class="line">c1600_2300 = _mm512_add_pd(_mm512_mul_pd(a16x_23x, bx0), c1600_2300);</span><br><span class="line">c2400_3100 = _mm512_add_pd(_mm512_mul_pd(a24x_31x, bx0), c2400_3100);</span><br><span class="line"></span><br><span class="line">c0001_0701 = _mm512_add_pd(_mm512_mul_pd(a0x_7x, bx1), c0001_0701);</span><br><span class="line">c0801_1501 = _mm512_add_pd(_mm512_mul_pd(a8x_15x, bx1), c0801_1501);</span><br><span class="line">c1601_2301 = _mm512_add_pd(_mm512_mul_pd(a16x_23x, bx1), c1601_2301);</span><br><span class="line">c2401_3101 = _mm512_add_pd(_mm512_mul_pd(a24x_31x, bx1), c2401_3101);</span><br><span class="line"></span><br><span class="line">c0002_0702 = _mm512_add_pd(_mm512_mul_pd(a0x_7x, bx2), c0002_0702);</span><br><span class="line">c0802_1502 = _mm512_add_pd(_mm512_mul_pd(a8x_15x, bx2), c0802_1502);</span><br><span class="line">c1602_2302 = _mm512_add_pd(_mm512_mul_pd(a16x_23x, bx2), c1602_2302);</span><br><span class="line">c2402_3102 = _mm512_add_pd(_mm512_mul_pd(a24x_31x, bx2), c2402_3102);</span><br><span class="line"></span><br><span class="line">c0003_0703 = _mm512_add_pd(_mm512_mul_pd(a0x_7x, bx3), c0003_0703);</span><br><span class="line">c0803_1503 = _mm512_add_pd(_mm512_mul_pd(a8x_15x, bx3), c0803_1503);</span><br><span class="line">c1603_2303 = _mm512_add_pd(_mm512_mul_pd(a16x_23x, bx3), c1603_2303);</span><br><span class="line">c2403_3103 = _mm512_add_pd(_mm512_mul_pd(a24x_31x, bx3), c2403_3103);</span><br><span class="line">&#125;</span><br><span class="line">_mm512_storeu_pd(C, c0000_0700);</span><br><span class="line">_mm512_storeu_pd(C + <span class="number">8</span>, c0800_1500);</span><br><span class="line">_mm512_storeu_pd(C + <span class="number">16</span>, c1600_2300);</span><br><span class="line">_mm512_storeu_pd(C + <span class="number">24</span>, c2400_3100);</span><br><span class="line"></span><br><span class="line">_mm512_storeu_pd(c0001_0701_ptr, c0001_0701);</span><br><span class="line">_mm512_storeu_pd(c0001_0701_ptr + <span class="number">8</span>, c0801_1501);</span><br><span class="line">_mm512_storeu_pd(c0001_0701_ptr + <span class="number">16</span>, c1601_2301);</span><br><span class="line">_mm512_storeu_pd(c0001_0701_ptr + <span class="number">24</span>, c2401_3101);</span><br><span class="line"></span><br><span class="line">_mm512_storeu_pd(c0002_0702_ptr, c0002_0702);</span><br><span class="line">_mm512_storeu_pd(c0002_0702_ptr + <span class="number">8</span>, c0802_1502);</span><br><span class="line">_mm512_storeu_pd(c0002_0702_ptr + <span class="number">16</span>, c1602_2302);</span><br><span class="line">_mm512_storeu_pd(c0002_0702_ptr + <span class="number">24</span>, c2402_3102);</span><br><span class="line"></span><br><span class="line">_mm512_storeu_pd(c0003_0703_ptr, c0003_0703);</span><br><span class="line">_mm512_storeu_pd(c0003_0703_ptr + <span class="number">8</span>, c0803_1503);</span><br><span class="line">_mm512_storeu_pd(c0003_0703_ptr + <span class="number">16</span>, c1603_2303);</span><br><span class="line">_mm512_storeu_pd(c0003_0703_ptr + <span class="number">24</span>, c2403_3103);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">copy_avx512_b</span><span class="params">(<span class="type">int</span> lda, <span class="type">const</span> <span class="type">int</span> K, <span class="type">double</span>* b_src, <span class="type">double</span>* b_dest)</span> </span>&#123;</span><br><span class="line"><span class="type">double</span>* b_ptr0, * b_ptr1, * b_ptr2, * b_ptr3;</span><br><span class="line">b_ptr0 = b_src;</span><br><span class="line">b_ptr1 = b_ptr0 + lda;</span><br><span class="line">b_ptr2 = b_ptr1 + lda;</span><br><span class="line">b_ptr3 = b_ptr2 + lda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; K; ++i)</span><br><span class="line">&#123;</span><br><span class="line">*b_dest++ = *b_ptr0++;</span><br><span class="line">*b_dest++ = *b_ptr1++;</span><br><span class="line">*b_dest++ = *b_ptr2++;</span><br><span class="line">*b_dest++ = *b_ptr3++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">copy_avx512_a</span><span class="params">(<span class="type">int</span> lda, <span class="type">const</span> <span class="type">int</span> K, <span class="type">double</span>* a_src, <span class="type">double</span>* a_dest)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; K; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memcpy</span>(a_dest, a_src, <span class="number">32</span> * <span class="number">8</span>);</span><br><span class="line">a_dest += <span class="number">32</span>;</span><br><span class="line">a_src += lda;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title">do_block_avx512</span><span class="params">(<span class="type">int</span> lda, <span class="type">int</span> M, <span class="type">int</span> N, <span class="type">int</span> K, <span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span>* A_block, * B_block;</span><br><span class="line">A_block = (<span class="type">double</span>*)_mm_malloc(M * K * <span class="built_in">sizeof</span>(<span class="type">double</span>), <span class="number">64</span>);</span><br><span class="line">B_block = (<span class="type">double</span>*)_mm_malloc(K * N * <span class="built_in">sizeof</span>(<span class="type">double</span>), <span class="number">64</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>* a_ptr, * b_ptr, * c;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Nmax = N - <span class="number">3</span>;</span><br><span class="line"><span class="type">int</span> Mmax = M - <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nmax; j += <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">b_ptr = &amp;B_block[j * K];</span><br><span class="line"><span class="built_in">copy_avx512_b</span>(lda, K, B + j * lda, b_ptr); <span class="comment">// 将 B 展开</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Mmax; i += <span class="number">32</span>) &#123;</span><br><span class="line">a_ptr = &amp;A_block[i * K];</span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">0</span>) <span class="built_in">copy_avx512_a</span>(lda, K, A + i, a_ptr); <span class="comment">// 将 A 展开</span></span><br><span class="line">c = C + i + j * lda;</span><br><span class="line"><span class="built_in">block_avx512_32x4</span>(lda, K, a_ptr, b_ptr, c);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">_mm_free(A_block);</span><br><span class="line">_mm_free(B_block);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gemm_avx512</span><span class="params">(<span class="type">int</span> lda, <span class="type">double</span>* A, <span class="type">double</span>* B, <span class="type">double</span>* C)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> omp parallel for</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; lda; j += BLOCK_SIZE) &#123;    <span class="comment">// j i k 序 内存读写更快</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lda; i += BLOCK_SIZE) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; lda; k += BLOCK_SIZE) &#123;</span><br><span class="line"><span class="comment">// 大分块里小分块</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> jj = j; jj &lt; j + BLOCK_SIZE; jj += BLOCK_SIZE2)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> ii = i; ii &lt; i + BLOCK_SIZE; ii += BLOCK_SIZE2)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> kk = k; kk &lt; k + BLOCK_SIZE; kk += BLOCK_SIZE2)</span><br><span class="line"><span class="built_in">do_block_avx512</span>(lda, BLOCK_SIZE2, BLOCK_SIZE2, BLOCK_SIZE2, A + ii + kk * lda, B + kk + jj * lda, C + ii + jj * lda);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 高性能计算 </tag>
            
            <tag> 汇编 </tag>
            
            <tag> AVX </tag>
            
            <tag> SMID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORB/BEBLID 利用OpenCV(C++)实现尺度不变性与角度不变性的特征找图算法</title>
      <link href="/2024/03/25/ORB-BEBLID-%E5%88%A9%E7%94%A8OpenCV-C-%E5%AE%9E%E7%8E%B0%E5%B0%BA%E5%BA%A6%E4%B8%8D%E5%8F%98%E6%80%A7%E4%B8%8E%E8%A7%92%E5%BA%A6%E4%B8%8D%E5%8F%98%E6%80%A7%E7%9A%84%E7%89%B9%E5%BE%81%E6%89%BE%E5%9B%BE%E7%AE%97%E6%B3%95/"/>
      <url>/2024/03/25/ORB-BEBLID-%E5%88%A9%E7%94%A8OpenCV-C-%E5%AE%9E%E7%8E%B0%E5%B0%BA%E5%BA%A6%E4%B8%8D%E5%8F%98%E6%80%A7%E4%B8%8E%E8%A7%92%E5%BA%A6%E4%B8%8D%E5%8F%98%E6%80%A7%E7%9A%84%E7%89%B9%E5%BE%81%E6%89%BE%E5%9B%BE%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文只发布于<a href="https://www.cnblogs.com/Icys/p/ORB.html">利用OpenCV实现尺度不变性与角度不变性的特征找图算法</a>,知乎以及pchar.cn</p></blockquote><blockquote><p>一般来说，利用OpenCV实现找图功能，用的比较多的是模板匹配（matchTemplate）。笔者比较喜欢里面的NCC算法。但是模板有个很明显的短板，面对尺度改变，角度改变的目标就无能为力了。因此本文旨在做到模板匹配做不到的这两点上。</p><p>当然也有人利用模板匹配实现上面的功能，但是方法之无语，效率之低下让我不禁想起了三体中的一句话：</p><p>“成吉思汗的骑兵，攻击速度与二十世纪的装甲部队相当；北宋的床弩，射程达一千五百米，与二十世纪的狙击步枪差不多；但这些仍不过是古代的骑兵与弓弩而已，不可能与现代力量抗衡。基础理论决定一切，未来史学派清楚地看到了这一点。而你们，却被回光返照的低级技术蒙住了眼睛。你们躺在现代文明的温床中安于享乐，对即将到来的决定人类命运的终极决战完全没有精神上的准备。”</p><p>本文并不涉及ORB或者BEBLID算法的具体实现，想了解的同学请移步论文。本文撰自一名非计算机系大一新生，有不到处还请见谅。</p></blockquote><h4 id="从特征匹配开始"><a href="#从特征匹配开始" class="headerlink" title="从特征匹配开始"></a>从特征匹配开始</h4><p><strong>特征匹配</strong>首先是需要获得特征点。通过特征检测算法，获得特征点后利用匹配器，或是<strong>计算汉明距离</strong>或是计算<strong>余弦距离</strong>，将两个图上的点连接在一起。</p><p><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_231119135432_matcher_result1.jpg" alt="image21"></p><p>看笔者往期文章<a href="https://www.cnblogs.com/Icys/p/Match.html">浅谈OpenCV的多对象匹配透明图像的实现，以及如何匹配半透明控件</a>，在这篇文章中用的是<strong>SURF</strong>算法。但是这个算法并不支持角度不变性。</p><p>笔者在阅读<strong>OpenCV-mobile</strong>的<strong>readme</strong>的时候意外了解到<strong>ORB</strong>算法。简单查找一下资料，了解到ORB(<strong>Oriented FAST and Rotated BRIEF</strong>)算法满足以下特点</p><ul><li>支持尺度不变性和角度不变性</li><li>速度很快，甚至比特征匹配(NCC)还快(i9 13900hx)</li><li>开源，免费，无专利</li><li>目前最快速稳定的特征点检测和提取算法</li></ul><p><strong>ORB &#x3D; Oriented FAST（特征点） + Rotated BRIEF（特征描述）</strong></p><blockquote><p>From <a href="https://zhuanlan.zhihu.com/p/91479558">https://zhuanlan.zhihu.com/p/91479558</a></p></blockquote><p>在2020年提出了一个效果更好也更快的特征描述算法<strong>Boosted Efficient Binary Local Image Descriptor</strong>（笔者不清楚他算法这有没有专利，但是这个算法在<strong>nonfree</strong>里，如果需要商业化请慎用，或者替换回BRIEF算法）</p><h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cv::Ptr&lt;cv::ORB&gt; orb = cv::ORB::<span class="built_in">create</span>(nKeypoints); <span class="comment">//寻找nKeypoints个特征点</span></span><br><span class="line">cv::Ptr&lt;cv::xfeatures2d::BEBLID&gt; beblid = cv::xfeatures2d::BEBLID::<span class="built_in">create</span>(<span class="number">0.75f</span>, cv::xfeatures2d::BEBLID::SIZE_256_BITS);<span class="comment">//用256个比特来描述特征</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;cv::KeyPoint&gt; src_keypoints, target_keypoints;</span><br><span class="line">cv::Mat src_descriptors, target_descriptors;</span><br><span class="line"></span><br><span class="line">orb-&gt;<span class="built_in">detect</span>(src_mat, src_keypoints);</span><br><span class="line">orb-&gt;<span class="built_in">detect</span>(target_mat, target_keypoints);</span><br><span class="line"></span><br><span class="line">beblid-&gt;<span class="built_in">compute</span>(src_mat, src_keypoints, src_descriptors);</span><br><span class="line">beblid-&gt;<span class="built_in">compute</span>(target_mat, target_keypoints, target_descriptors);</span><br><span class="line"></span><br><span class="line"><span class="function">cv::BFMatcher <span class="title">matcher</span><span class="params">(cv::NORM_HAMMING, <span class="literal">true</span>)</span></span>;<span class="comment">//利用汉明距离的匹配器</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;cv::DMatch&gt; matches;</span><br><span class="line">matcher.<span class="built_in">match</span>(target_descriptors, src_descriptors, matches);</span><br><span class="line"></span><br><span class="line">std::vector&lt;cv::Point2d&gt; matched_target, matched_src;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp;match : matches)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(match.distance &gt; max_distance)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">matched_target.<span class="built_in">push_back</span>(target_keypoints[match.queryIdx].pt);</span><br><span class="line">matched_src.<span class="built_in">push_back</span>(src_keypoints[match.trainIdx].pt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里创建了ORB和BEBLID对象，并且对目标图片完成了匹配，将彼此能够匹配的点对应存放到了<strong>matched_target</strong>和<strong>matched_src</strong>里。</p><h4 id="从透视变换继续"><a href="#从透视变换继续" class="headerlink" title="从透视变换继续"></a>从透视变换继续</h4><p>虽然我们这里成功建立了模板图和目标图的特征点对点关系，然而，很多时候我们想要的是特征匹配提供的那种更为直接的反映在目标图里的坐标。</p><p>如何将离散的的点集转换为模板在目标图上的大致区域，成了我们需要解决的一个问题。这里我使用的方法是<strong>findHomography</strong>和<strong>perspectiveTransform</strong>。</p><ul><li><p><strong>findHomography</strong> 计算多个二维点对之间的最优单映射变换矩阵H(3行3列)。使用最小均方误差或RANSAC方法。比较好解释的是最小均方误差方法，但是为了效果笔者用的是RANSAC方法。关于这个矩阵作用，大家可以去B站上看3blue1brown的系列视频《线性代数的本质》。我们获取到这个矩阵，就可以估计出模板图怎么变化到目标图上。同理模板的四个角的坐标也可以通过这个矩阵变换到目标图上的坐标，就得到了模板在目标图上的大致位置和边界。</p></li><li><p><strong>perspectiveTransform</strong> 透视变换，就是完成坐标的变换过程。</p></li></ul><h5 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cv::Mat H = cv::<span class="built_in">findHomography</span>(matched_src, matched_target, cv::RANSAC);</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;cv::Point2f&gt; <span class="title">obj_corners</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">obj_corners[<span class="number">0</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">obj_corners[<span class="number">1</span>] = cv::<span class="built_in">Point2f</span>((<span class="type">float</span>)target_mat.cols, <span class="number">0</span>);</span><br><span class="line">obj_corners[<span class="number">2</span>] = cv::<span class="built_in">Point2f</span>((<span class="type">float</span>)target_mat.cols, (<span class="type">float</span>)target_mat.rows);</span><br><span class="line">obj_corners[<span class="number">3</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, (<span class="type">float</span>)target_mat.rows);</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;cv::Point2f&gt; <span class="title">buf_corners</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">cv::<span class="built_in">perspectiveTransform</span>(obj_corners, buf_corners, H);</span><br></pre></td></tr></table></figure><h4 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h4><p><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_231119135413_9DAFD40DC56CFFF2D5F759E029DDE611.png" alt="9DAFD40DC56CFFF2D5F759E029DDE611"></p><table><thead><tr><th>缩放</th><th>压扁</th><th>旋转</th></tr></thead><tbody><tr><td><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_231119135413_01261DB496B1EFC49EA1D88C8BAA16D8.jpg" alt="01261DB496B1EFC49EA1D88C8BAA16D8" style="zoom: 25%;" /></td><td><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_231119135413_CE9F5E7AE49EC75A0A74EAE88CF73913.jpg" style="zoom:25%;" /></td><td><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_231119135413_1F058667CECF66FBCE14976EB115C530.jpg" alt="CE9F5E7AE49EC75A0A74EAE88CF73913" alt="1F058667CECF66FBCE14976EB115C530" style="zoom:25%;" /></td></tr></tbody></table><p>可以发现实现的效果非常好。</p><h4 id="还能更强？"><a href="#还能更强？" class="headerlink" title="还能更强？"></a>还能更强？</h4><p>这里只实现了单个目标的检测匹配，事实上这个算法不止步于此，我们可以使用<strong>KMeans</strong>算法，实现对于一个图片上多个目标一次检测。也可以多个图片同时匹配。但是鉴于时间，和笔者不容乐观的数学分析成绩，以及即将到来的数论期中考试，为了不被踢出强基计划，下次有时间再说吧。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> OpenCV </tag>
            
            <tag> 计算机视觉 </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DX后台截图C++实现代码</title>
      <link href="/2024/03/25/DX%E5%90%8E%E5%8F%B0%E6%88%AA%E5%9B%BEC-%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81/"/>
      <url>/2024/03/25/DX%E5%90%8E%E5%8F%B0%E6%88%AA%E5%9B%BEC-%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="DX后台截图C-实现代码"><a href="#DX后台截图C-实现代码" class="headerlink" title="DX后台截图C++实现代码"></a>DX后台截图C++实现代码</h1><blockquote><p>传统的GDI API (BitBlt)虽然可以完美的完成后台截图的任务，但是归根结底效率还是太低。</p><p>直接使用DXGI方法截图只能完成前台窗口的截图，而DX HOOK的截图方法平添风险，以及很多场景不现实。</p><p>本文讲介绍使用 DwmGetDxSharedSurface 函数，优雅的完成后台截图的工作。</p></blockquote><h4 id="API介绍"><a href="#API介绍" class="headerlink" title="API介绍"></a>API介绍</h4><h5 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL WINAPI <span class="title">DwmGetDxSharedSurface</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hwnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE* phSurface,</span></span></span><br><span class="line"><span class="params"><span class="function">    LUID* pAdapterLuid,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG* pFmtWindow,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG* pPresentFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONGLONG* pWin32kUpdateId</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure><p>$DwmGetDxSharedSurface$来自于user32.dll（很离谱是吧，DwmApi不在DwmApi.dll里）。由于是ms没有公开的API，需要使用动态方法加载。</p><h5 id="调用函数方法"><a href="#调用函数方法" class="headerlink" title="调用函数方法"></a>调用函数方法</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态载入该函数</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">HRESULT</span><span class="params">(WINAPI* DwmGetDxSharedSurface_t)</span><span class="params">(HWND, HANDLE*, LUID*, ULONG*, ULONG*, ULONGLONG*)</span></span>;</span><br><span class="line">DwmGetDxSharedSurface_t DwmGetDxSharedSurface = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//获取地址</span></span><br><span class="line">HMODULE hUser32 = <span class="built_in">LoadLibraryA</span>(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (hUser32 == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;LoadLibraryA failed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">DwmGetDxSharedSurface = (DwmGetDxSharedSurface_t)<span class="built_in">GetProcAddress</span>(hUser32, <span class="string">&quot;DwmGetDxSharedSurface&quot;</span>);</span><br><span class="line"><span class="comment">//Dwm函数 在 user32.dll 中，真是离谱</span></span><br><span class="line"><span class="keyword">if</span> (DwmGetDxSharedSurface == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;GetProcAddress failed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; DwmGetDxSharedSurface &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><h5 id="参数含义"><a href="#参数含义" class="headerlink" title="参数含义"></a>参数含义</h5><ul><li>hwnd 被截图窗口的句柄</li><li>phSurface 被截图窗口的共享画面的句柄（应该是这么翻译吧）</li><li>其他，暂时还没了解。</li></ul><h4 id="API调用"><a href="#API调用" class="headerlink" title="API调用"></a>API调用</h4><h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>显然这个API不能一步到位获得到BMP或者其他类型的图像数据。和BitBlt一样，这个API只是拿到了对应画面的副本（？，不清楚这样描述是否准确）。参照唯一有官方信息的API$DwmDxGetWindowSharedSurface$，得到的是DX的一个对象，那就应该从DX下手。</p><h5 id="初始化DX"><a href="#初始化DX" class="headerlink" title="初始化DX"></a>初始化DX</h5><blockquote><p>这里讲个遇到的坑，DX设备的初始化不能在dllmain里进行，否则会失败。</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">HRESULT hr = S_OK;</span><br><span class="line"></span><br><span class="line">hr = <span class="built_in">CreateDXGIFactory1</span>(__uuidof(IDXGIFactory1), (<span class="type">void</span>**)(&amp;pFactory));</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;CreateDXGIFactory1 failed&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">pFactory-&gt;<span class="built_in">EnumAdapters</span>(<span class="number">0</span>, &amp;pAdapter);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> D3D_FEATURE_LEVEL featureLevels[] = &#123;</span><br><span class="line">D3D_FEATURE_LEVEL_11_0,</span><br><span class="line">D3D_FEATURE_LEVEL_10_1,</span><br><span class="line">D3D_FEATURE_LEVEL_10_0,</span><br><span class="line">D3D_FEATURE_LEVEL_9_3,</span><br><span class="line">D3D_FEATURE_LEVEL_9_2,</span><br><span class="line">D3D_FEATURE_LEVEL_9_1</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">D3D11CreateDevice</span>(pAdapter, D3D_DRIVER_TYPE_UNKNOWN, <span class="literal">NULL</span>, D3D11_CREATE_DEVICE_BGRA_SUPPORT, featureLevels, <span class="number">6</span>, D3D11_SDK_VERSION, &amp;device, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (device == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;D3D11CreateDevice failed&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="获取phSurface"><a href="#获取phSurface" class="headerlink" title="获取phSurface"></a>获取phSurface</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HANDLE phSurface = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">// 使用DWM截取屏幕</span></span><br><span class="line"><span class="built_in">DwmGetDxSharedSurface</span>(hWnd, &amp;phSurface, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (phSurface == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;Get Shared Surface Failded&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="将数据载入"><a href="#将数据载入" class="headerlink" title="将数据载入"></a>将数据载入</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">HRESULT hr = S_OK;</span><br><span class="line"></span><br><span class="line">ID3D11Texture2D* sharedSurface = <span class="literal">NULL</span>;</span><br><span class="line">hr = device-&gt;<span class="built_in">OpenSharedResource</span>(phSurface, __uuidof(ID3D11Texture2D), (<span class="type">void</span>**)&amp;sharedSurface);<span class="comment">//打开对应资源</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;OpenSharedResource failed&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">D3D11_TEXTURE2D_DESC shared_desc;</span><br><span class="line">sharedSurface-&gt;<span class="built_in">GetDesc</span>(&amp;shared_desc);</span><br><span class="line"></span><br><span class="line">D3D11_TEXTURE2D_DESC description;</span><br><span class="line"></span><br><span class="line">description.ArraySize = <span class="number">1</span>;</span><br><span class="line">description.BindFlags = <span class="number">0</span>;</span><br><span class="line">description.CPUAccessFlags = D3D11_CPU_ACCESS_READ;</span><br><span class="line">description.Format = DXGI_FORMAT_B8G8R8A8_UNORM;</span><br><span class="line">description.Height = shared_desc.Height;</span><br><span class="line">description.MipLevels = <span class="number">1</span>;</span><br><span class="line">description.SampleDesc = &#123; <span class="number">1</span>, <span class="number">0</span> &#125;;</span><br><span class="line">description.Usage = D3D11_USAGE_STAGING;</span><br><span class="line">description.Width = shared_desc.Width;</span><br><span class="line">description.MiscFlags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">hr = S_OK;</span><br><span class="line"></span><br><span class="line">ID3D11Texture2D* texture = <span class="literal">NULL</span>;</span><br><span class="line">hr = device-&gt;<span class="built_in">CreateTexture2D</span>(&amp;description, <span class="literal">NULL</span>, &amp;texture);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr))</span><br><span class="line">&#123;</span><br><span class="line">sharedSurface-&gt;<span class="built_in">Release</span>();</span><br><span class="line"><span class="keyword">throw</span> <span class="string">&quot;CreateTexture2D failed&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ID3D11DeviceContext* context = <span class="literal">NULL</span>;</span><br><span class="line">device-&gt;<span class="built_in">GetImmediateContext</span>(&amp;context);</span><br><span class="line">context-&gt;<span class="built_in">CopyResource</span>(texture, sharedSurface);</span><br><span class="line"></span><br><span class="line">D3D11_MAPPED_SUBRESOURCE mappedResource;</span><br><span class="line">context-&gt;<span class="built_in">Map</span>(texture, <span class="number">0</span>, D3D11_MAP_READ, <span class="number">0</span>, &amp;mappedResource);</span><br></pre></td></tr></table></figure><blockquote><p>这里我们其实就已经拿到了对应的图片资源</p></blockquote><h5 id="数据转化"><a href="#数据转化" class="headerlink" title="数据转化"></a>数据转化</h5><p>根据DX设备填入的D3D11_CREATE_DEVICE_BGRA_SUPPORT。可以知</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">D3D11_MAPPED_SUBRESOURCE</span> &#123;</span><br><span class="line">  <span class="type">void</span> *pData;</span><br><span class="line">  UINT RowPitch;</span><br><span class="line">  UINT DepthPitch;</span><br><span class="line">&#125; D3D11_MAPPED_SUBRESOURCE;</span><br></pre></td></tr></table></figure><p>其中的pData应该是一段对应像素排列位BGRA的位图。RowPitch是每行数据站的字长。为了方便我采用的是用OpenCV直接读入这段数据</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::Mat <span class="title">mat</span><span class="params">(shared_desc.Height, shared_desc.Width, CV_8UC4, mappedResource.pData, mappedResource.RowPitch)</span></span>;</span><br><span class="line">cv::<span class="built_in">imshow</span>(<span class="string">&quot;mat&quot;</span>, mat);</span><br><span class="line">cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//转BMP写出</span></span><br><span class="line">std::vector&lt;uchar&gt; buffer;</span><br><span class="line">cv::<span class="built_in">imencode</span>(<span class="string">&quot;.bmp&quot;</span>, mat, buffer);</span><br></pre></td></tr></table></figure><p>当然也能用MFC</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HBITMAP hbmp = <span class="built_in">CreateBitmap</span>(shared desc.Width, shared desc.Height, <span class="number">1</span> <span class="number">32</span>, mappedResource.pData);</span><br><span class="line">CImage img;</span><br><span class="line">img.<span class="built_in">Attach</span>(hbmp);</span><br><span class="line">img.<span class="built_in">Save</span>(<span class="string">L&quot;233.bmp&quot;</span>);</span><br><span class="line">img.<span class="built_in">Detach</span>();</span><br><span class="line"><span class="built_in">DeleteObject</span>(hbmp);</span><br></pre></td></tr></table></figure><h4 id="资源释放"><a href="#资源释放" class="headerlink" title="资源释放"></a>资源释放</h4><p>最后别忘记了</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">context-&gt;<span class="built_in">Release</span>();</span><br><span class="line">texture-&gt;<span class="built_in">Release</span>();</span><br><span class="line">sharedSurface-&gt;<span class="built_in">Release</span>();</span><br><span class="line"></span><br><span class="line">device-&gt;<span class="built_in">Release</span>();</span><br><span class="line">pAdapter-&gt;<span class="built_in">Release</span>();</span><br><span class="line">pFactory-&gt;<span class="built_in">Release</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">FreeLibrary</span>(hUser32);</span><br></pre></td></tr></table></figure><blockquote><p>采用CloseHandle没法正常关掉phSurface，暂时不知道什么解决或方法，或是需不需要关掉</p></blockquote><h4 id="库的链接"><a href="#库的链接" class="headerlink" title="库的链接"></a>库的链接</h4><blockquote><p>用到了DX方面的库，当然要把他们的lib给链接上，在cpp文件中添加以下代码</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;d3d11.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;dxgi.lib&quot;</span>)</span></span><br></pre></td></tr></table></figure><h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><blockquote><p>这个API截取不到标题栏。另外也可能是本人对API和DX的理解水平还不到位D2D&#x2F;D3D渲染的窗口截图是全黑的。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> DXGI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远程Call 32位远程多参数带返回调用</title>
      <link href="/2024/03/25/%E8%BF%9C%E7%A8%8BCall-32%E4%BD%8D%E8%BF%9C%E7%A8%8B%E5%A4%9A%E5%8F%82%E6%95%B0%E5%B8%A6%E8%BF%94%E5%9B%9E%E8%B0%83%E7%94%A8/"/>
      <url>/2024/03/25/%E8%BF%9C%E7%A8%8BCall-32%E4%BD%8D%E8%BF%9C%E7%A8%8B%E5%A4%9A%E5%8F%82%E6%95%B0%E5%B8%A6%E8%BF%94%E5%9B%9E%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="远程Call-32位远程多参数带返回调用"><a href="#远程Call-32位远程多参数带返回调用" class="headerlink" title="[远程Call]32位远程多参数带返回调用"></a>[远程Call]32位远程多参数带返回调用</h1><h5 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h5><blockquote><p>在Windows上可以使用CreateRemoteThread实现远程Call，但是有不带返回值且只能传递一个参数的限制。</p></blockquote><h5 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h5><blockquote><p>将多个参数利用VirtualAllocEx和WriteProcessMemory写入目标程序，再通过此方法注入一段shellcode，通过shellcode完成多参数的调用。</p></blockquote><h5 id="核心shellcode"><a href="#核心shellcode" class="headerlink" title="核心shellcode"></a>核心shellcode</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">push var_1</span><br><span class="line">...</span><br><span class="line">push var_n</span><br><span class="line">mov eax,function_addr</span><br><span class="line">/*</span><br><span class="line">如果为 cdcel则需要平栈</span><br><span class="line">add esp,count_param</span><br><span class="line">*/</span><br><span class="line">call eax</span><br></pre></td></tr></table></figure><h5 id="实现c-代码"><a href="#实现c-代码" class="headerlink" title="实现c++代码"></a>实现c++代码</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">LPVOID <span class="title">RemoteNew</span><span class="params">(HANDLE hProcess, PUCHAR data,<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> hMem=<span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, size, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (hMem == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WriteProcessMemory</span>(hProcess, hMem, data, size,<span class="literal">NULL</span>) == FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">VirtualFreeEx</span>(hProcess, hMem, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hMem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">RemoteCall</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID remoteFuncAddr,</span></span></span><br><span class="line"><span class="params"><span class="function">    vector&lt;LPVOID&gt; param,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">bool</span> cdcelCall,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">bool</span> waitRemoteThread </span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (remoteFuncAddr == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">    vector&lt;UCHAR&gt; shellcode;</span><br><span class="line">    <span class="comment">//push 结构</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = param.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)<span class="comment">//调用栈是个栈</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (((UINT)param[i]) &lt;= <span class="number">255</span>) <span class="comment">//小参数可以只传低位</span></span><br><span class="line">            shellcode.<span class="built_in">push_back</span>(<span class="number">106</span>), shellcode.<span class="built_in">push_back</span>((UCHAR)param[i]); <span class="comment">//push byte</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            shellcode.<span class="built_in">push_back</span>(<span class="number">104</span>), shellcode.<span class="built_in">insert</span>(shellcode.<span class="built_in">end</span>(), (PUCHAR)&amp;param[i], (PUCHAR)(&amp;param[i] + <span class="number">1</span>)); <span class="comment">//push dword</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把addr塞入寄存器</span></span><br><span class="line">    shellcode.<span class="built_in">push_back</span>(<span class="number">184</span>); <span class="comment">//mov</span></span><br><span class="line">    shellcode.<span class="built_in">insert</span>(shellcode.<span class="built_in">end</span>(), (PUCHAR)&amp;remoteFuncAddr, (PUCHAR)(&amp;remoteFuncAddr + <span class="number">1</span>)); <span class="comment">//eax,addr</span></span><br><span class="line">    shellcode.<span class="built_in">push_back</span>(<span class="number">255</span>),shellcode.<span class="built_in">push_back</span>(<span class="number">208</span>);<span class="comment">//call eax</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (cdcelCall)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">size_t</span> paramSize = param.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(LPVOID);</span><br><span class="line">        <span class="comment">//cdcel是函数调用后平栈，stdcall是函数自己平</span></span><br><span class="line">        shellcode.<span class="built_in">push_back</span>(<span class="number">129</span>), shellcode.<span class="built_in">push_back</span>(<span class="number">196</span>);<span class="comment">//add esp</span></span><br><span class="line">        shellcode.<span class="built_in">insert</span>(shellcode.<span class="built_in">end</span>(), (PUCHAR)&amp;paramSize, (PUCHAR)(&amp;paramSize + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    shellcode.<span class="built_in">push_back</span>(<span class="number">195</span>);<span class="comment">//ret</span></span><br><span class="line">    <span class="keyword">auto</span> shellcodeAddr=<span class="built_in">RemoteNew</span>(hProcess, shellcode.<span class="built_in">data</span>(), shellcode.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(UCHAR));</span><br><span class="line">    <span class="keyword">if</span> (shellcodeAddr == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">auto</span> hThread=<span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)shellcodeAddr, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hThread == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">VirtualFreeEx</span>(hProcess, shellcodeAddr, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">thread <span class="title">waiter</span><span class="params">([hThread, hProcess, shellcodeAddr] &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        WaitForSingleObject(hThread, INFINITE);</span></span></span><br><span class="line"><span class="params"><span class="function">        VirtualFreeEx(hProcess, shellcodeAddr, <span class="number">0</span>, MEM_RELEASE);</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD retCode;</span></span></span><br><span class="line"><span class="params"><span class="function">        GetExitCodeThread(hThread, &amp;retCode);</span></span></span><br><span class="line"><span class="params"><span class="function">        cout &lt;&lt;<span class="string">&quot;Ret: &quot;</span> &lt;&lt; retCode &lt;&lt; endl;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (waitRemoteThread)</span><br><span class="line">        waiter.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        waiter.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> a[] = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    <span class="type">char</span> b[] = <span class="string">&quot;C++ YES&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-1是自己</span></span><br><span class="line">    <span class="built_in">RemoteCall</span>((HANDLE)<span class="number">-1</span>, add, &#123; (LPVOID)<span class="number">1</span>,(LPVOID)<span class="number">3</span> &#125;, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> p1 = <span class="built_in">RemoteNew</span>((HANDLE)<span class="number">-1</span>, (PUCHAR)a, <span class="built_in">sizeof</span>(a));</span><br><span class="line">    <span class="keyword">auto</span> p2 = <span class="built_in">RemoteNew</span>((HANDLE)<span class="number">-1</span>, (PUCHAR)b, <span class="built_in">sizeof</span>(b));</span><br><span class="line">    <span class="built_in">RemoteCall</span>((HANDLE)<span class="number">-1</span>, MessageBoxA, &#123; <span class="number">0</span>, p1,p2,(LPVOID)<span class="number">64</span> &#125;, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="实现缺陷"><a href="#实现缺陷" class="headerlink" title="实现缺陷"></a>实现缺陷</h5><ol><li><p>目前只能实现32位的远程调用，64位新增了内存的可执行权限，这样注入的shellcode没法执行。</p></li><li><p>返回值只能接受32位整数，其实实现64位整数和浮点的方法也不复杂，都可以用汇编把对应寄存器的值写到内存里，但是情况比较多，懒得写了。</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
            <tag> Windows </tag>
            
            <tag> 远程调用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自适应辛普森法积分算法推导</title>
      <link href="/2024/03/25/%E8%87%AA%E9%80%82%E5%BA%94%E8%BE%9B%E6%99%AE%E6%A3%AE%E6%B3%95%E7%A7%AF%E5%88%86%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/"/>
      <url>/2024/03/25/%E8%87%AA%E9%80%82%E5%BA%94%E8%BE%9B%E6%99%AE%E6%A3%AE%E6%B3%95%E7%A7%AF%E5%88%86%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/</url>
      
        <content type="html"><![CDATA[<h1 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h1><p>有时候我们需要计算一个函数的定积分，粗略上可以使用估算的方法。如图所示，将原本的曲线粗略地看成一个梯形。这个方法叫<strong>梯形法则（Trapezoidal Rule）</strong>。也叫做一阶<strong>牛顿-柯特斯闭型积分公式。</strong></p><p><img src="/graph/2.png" alt="img"><img src="/graph/3.png" alt="img"></p><p>其中</p><p><img src="/graph/4.png" alt="img"></p><p>所谓一阶，指的就是n&#x3D;1的情况。</p><p>最理想的情况就是把这个图像分割成 无数 个梯形，便可求出对应的定积分。</p><p>但是在实际操作的情况下，梯形法则为了保证速度无法取极多的点，这样照成梯形法则误差较大。</p><p>  分割成无限个梯形其实就等效于</p><p><img src="/graph/5.png" alt="img"></p><p>因此我们将考虑更高阶的公式，本文将要介绍的便是二阶<strong>牛顿-柯特斯闭型积分公式（辛普森法）。</strong> 即将函数近似看成一条抛物线。显然一阶牛顿-柯特斯闭型积分公式需要在首尾取两个点方可得到f(x)的解析式。而二阶要得到一个抛物线方程则需要取三个点，才能得到解析式。而牛顿-柯特斯闭型积分公式都采用等距取点的方法，所以辛普森法需要取首尾点以及中间点。</p><p>推导方法</p><p><img src="/graph/6.png" alt="img"></p><p>通过辛普森法，只需要计算出边界和中点的函数值就可以得到估算的函数的积分</p><p>绿色是被积函数，红线是使用梯形法则得到的，蓝线是辛普森法得到的。可以发现相对梯形法则，辛普森法相对而言更符合被积函数。继续提<img src="/graph/7.png" alt="img">高n的值可以提高估算的准确度，但显然也会提高计算的复杂性，而二阶的对于图中的函数基本上可以达到要求。</p><p><img src="/graph/8.png" alt="img">　　对于一段基本符合二次函数的函数，辛普森法可以得到较为准确的结果，然而当函数变得复杂时。辛普森将出现明显的误差。这时候该怎么计算积分。</p><p>​    摆在面前的有两条路，一个是不断细分区间，再将区间求和，另一条是增加n的值，使得函数更加符合被积函数。本文主要讨论第一种方法。</p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>  走第一条路，如果采用将区间平均细分为若干份，求得各个区间的积分后再统一求和，这样在计算量上和梯形法则上相等，但是精度提升不了多少。</p><p><img src="/graph/9.png" alt="img">　　然而，不得不承认，对于一个函数而言，存在二次拟合比较好的地方，也存在比较差的地方。如果在拟合比较好的地方细分就会浪费计算资源，而统一的平均细分，也导致在拟合比较差的地方达不到想要的精度。</p><p>因此，如何在拟合好的地方降低细分程度，拟合差的地方提高细分进度成了重中之重。</p><p>  而本文想介绍的关键<strong>自适应辛普森积分法</strong>，就是解决这个问题的。</p><p><img src="/graph/10.png" alt="img"></p><p>  上式是自适应辛普森积分法是否对一个区间进行细分的判定条件。</p><p>其实是根据这个结论：</p><p><img src="/graph/11.png" alt="img"><a href="https://files-cdn.cnblogs.com/files/pks-t/AdaptiveQuadProof.pdf">来源</a></p><p>原理其实很简单，首先将这个区间进行二分为两个区间肯定能得到更为精准的结果，如果这个结果和直接计算该区间的辛普森积分得到的结果差距大于某一个值，则认为对这个区间继续细分是有意义的，反之差距小于该值则说明继续细分对提高精度没有什么帮助，就不进行下一步的细分，以降低计算的复杂度。这个值一般是esp的15倍（至于为什么是15倍可以看看这篇文章<a href="https://dl.acm.org/doi/10.1145/321526.321537">Notes on the Adaptive Simpson Quadrature Routine</a>），调节esp可以控制估计值和精确值在多少位前是一样的。</p><p>  扩展：为什么二分一个区间能够得到一个更精确的结果，从图像上很好理解，两个函数要比一个函数拟合得更紧密。从数值上说明是因为辛普森算法的误差公式为</p><p><img src="/graph/12.png" alt="img"></p><p>  p是f(x)在[l,r]区间内使得f(x)四阶导数取得最大值的值。具体证明可以参考<a href="https://arxiv.org/abs/1708.07727">A short proof of the error term in Simpson’s rule</a>（看不懂？本笔者也看不懂）。根据琴生不等式可以推导出区间一分为二后的误差和小于不一分为二的误差（大概可以证明吧，以后有时间证明一下QAQ）。</p><p>  据说（美）萨奥尔（Sauer, T.）著；裴玉茹，马赓宇译.数值分析（原书第2版），机械工业出版社，第240页。 有相对完善的介绍，以后买一本看看。</p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;iomanip&gt;</span><br><span class="line">#include &lt;cmath&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">double F(double x)</span><br><span class="line">&#123;</span><br><span class="line">    return x * log(x);</span><br><span class="line">&#125;</span><br><span class="line">double PF(double x)</span><br><span class="line">&#123;</span><br><span class="line">    return 1.0 / 2.0 * x * x * log(x) - 1.0 / 4.0 * x * x;</span><br><span class="line">&#125;</span><br><span class="line">//primitive function: 1/2xlnx-1/4x</span><br><span class="line"></span><br><span class="line">int count_simpson =0;</span><br><span class="line"></span><br><span class="line">double simpson(double l,double r)</span><br><span class="line">&#123;</span><br><span class="line">    count_simpson++;</span><br><span class="line">    return (r - l) / 6.0 * (F(l) + F(r) + 4 * F((r + l) / 2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">double asr(</span><br><span class="line">    double l,//区间左边界</span><br><span class="line">    double r,//区间右边界</span><br><span class="line">    double integral,//该区间的辛普森积分</span><br><span class="line">    double esp</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line">    double mid = (l + r) / 2;</span><br><span class="line">    double in_l = simpson(l, mid), in_r = simpson(mid, r);</span><br><span class="line">    if (fabs(in_l + in_r - integral) &gt; esp * 15) //细分有价值</span><br><span class="line">        return asr(l, mid, in_l, esp) + asr(mid, r, in_r, esp);</span><br><span class="line">    else</span><br><span class="line">        return in_l + in_r + (in_l + in_r - integral) / 15.0;//返回这个肯定比返回integral精度更高</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; setprecision(16)&lt;&lt;&quot;估算&quot; &lt;&lt; asr(1, 8, simpson(1, 8), 1e-7) &lt;&lt; &quot;  &amp;&amp;  精确&quot; &lt;&lt; PF(8) - PF(1) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;计算次数:&quot; &lt;&lt; count_simpson &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="/img/2468061-20230707001045659-1101198528.png" alt="img"></p><h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><p>  为什么我非要用辛普森，这个算法为什么不能用梯形法则代替辛普森的作用？其实是可以用梯形法则代替辛普森的。</p><p><img src="/img/2468061-20230707001045992-1820087692.png" alt="img"></p><p>  但是无论是计算量还是精度来说效果都不是很好（QAQ）。不用更高阶的原因也很简单，提高阶增加编码难度同时提高的精度难以弥补耗时。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>  高考和强基计划审核结束，笔者如愿以偿地被理想的大学录取，由于录取专业与数学强相关，日后更新的文件也将高度围绕数学方面展开。这个排版调了我半天，emm，以后还是老老实实用markdown吧。</p><p>再用mathtype我就是小丑。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 微积分 </tag>
            
            <tag> 计算数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈OpenCV的多对象匹配图像的实现，以及如何匹配半透明控件，不规则图像</title>
      <link href="/2024/03/25/%E6%B5%85%E8%B0%88OpenCV%E7%9A%84%E5%A4%9A%E5%AF%B9%E8%B1%A1%E5%8C%B9%E9%85%8D%E5%9B%BE%E5%83%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%8C%B9%E9%85%8D%E5%8D%8A%E9%80%8F%E6%98%8E%E6%8E%A7%E4%BB%B6%EF%BC%8C%E4%B8%8D%E8%A7%84%E5%88%99%E5%9B%BE%E5%83%8F/"/>
      <url>/2024/03/25/%E6%B5%85%E8%B0%88OpenCV%E7%9A%84%E5%A4%9A%E5%AF%B9%E8%B1%A1%E5%8C%B9%E9%85%8D%E5%9B%BE%E5%83%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%8C%B9%E9%85%8D%E5%8D%8A%E9%80%8F%E6%98%8E%E6%8E%A7%E4%BB%B6%EF%BC%8C%E4%B8%8D%E8%A7%84%E5%88%99%E5%9B%BE%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="浅谈OpenCV的多对象匹配透明图像的实现，以及如何匹配半透明控件"><a href="#浅谈OpenCV的多对象匹配透明图像的实现，以及如何匹配半透明控件" class="headerlink" title="浅谈OpenCV的多对象匹配透明图像的实现，以及如何匹配半透明控件"></a>浅谈OpenCV的多对象匹配透明图像的实现，以及如何匹配半透明控件</h1><h3 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h3><blockquote><ol><li>OpenCV提供的templateMatch只负责将（相关性等）计算出来，并不会直接提供目标的对应坐标，一般来说我们直接遍历最高的相关度，就可以得到匹配度最高的坐标。但是这样一般只能得到一个坐标。</li><li>在实际操作中，我们可能需要匹配一个不规则的图像，把这个不规则的图像放进矩形Mat里，会出现很多不应该参与匹配的地方参与结果的计算，导致识别率下降。</li><li>有时候面对半透明控件，其后的背景完全不一样，传统的匹配方法直接歇菜了，怎么办？</li></ol></blockquote><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><h4 id="1-解决多对象匹配的问题"><a href="#1-解决多对象匹配的问题" class="headerlink" title="1. 解决多对象匹配的问题"></a>1. 解决多对象匹配的问题</h4><p>通过templateMatch算法，可以得到目标与原图像中等大子图像对应归一化的相关系数，这个归一化的相关系数可以看作是对于的概率（其实不是这样），可以设定一个阈值，把大于这个阈值的坐标都筛选出来。但是这样在一个成功匹配的坐标附近也会存在许多相关性稍小的坐标也大于这个阈值，我们无法区分这些坐标对于的图像是原来的图像还是其他的图像，这样就把这个问题转化为了怎么把这些副产物给去除。有cv经验的应该很快会想到<a href="%5B%E9%9D%9E%E6%9E%81%E5%A4%A7%E5%80%BC%E6%8A%91%E5%88%B6(NMS">&#x3D;&#x3D;nms算法&#x3D;&#x3D;</a>算法讲解|理论+代码 - 知乎 (zhihu.com)](<a href="https://zhuanlan.zhihu.com/p/382831616))%E3%80%82%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E5%90%8C%E5%AD%A6%E5%8F%AF%E4%BB%A5%E7%82%B9%E8%BF%9B%E5%8E%BB%E7%9C%8B%E7%9C%8B%E3%80%82%E4%B8%8B%E9%9D%A2%E5%B0%B1%E5%8F%AA%E6%8F%90%E4%BE%9B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E3%80%82">https://zhuanlan.zhihu.com/p/382831616))。想了解的同学可以点进去看看。下面就只提供代码实现。</a></p><h4 id="2-解决不规则图像匹配问题"><a href="#2-解决不规则图像匹配问题" class="headerlink" title="2. 解决不规则图像匹配问题"></a>2. 解决不规则图像匹配问题</h4><p>OpenCV的templateMatch中提供了一个可选的参数&#x3D;&#x3D;mask&#x3D;&#x3D;，这个mask是和目标等大的一张图，可以是U8C1也可以是FP32，其中U8C1对于每个点的含义是为0则放弃匹配该点，非0就会匹配，FP32是会将这个点像素在计算相关性时赋予对于的权重。要求比较简单，只需要不匹配不规则图像中的空白部分就好了，可以在mask中把这里涂黑，要匹配的地方涂白就好了（绿幕抠像？）。</p><h4 id="3-解决半透明控件的匹配问题"><a href="#3-解决半透明控件的匹配问题" class="headerlink" title="3. 解决半透明控件的匹配问题"></a>3. 解决半透明控件的匹配问题</h4><p>对于半透明控件，某个坐标对应的像素值就是会随着背景变化而变化的。templateMatch这种通过计算字节上相似度的算法会因为背景变化而导致整个图像的像素发生整体性的大规模变化而受到影响。但是即便整个图像的像素发生变化，寻找目标颜色与坐标的相对关系是基本不变的（目标具有某种特征，这也就是人为什么可以对这种控件进行识别）。可以用&#x3D;&#x3D;特征匹配&#x3D;&#x3D;的方法，利用这个特性对透明控件进行匹配。</p><blockquote><p>需要注意的是部分算法来自于nonfree的xfeature，使用时请注意避免纠纷，当然也需要使用者手动打开这个编译开关，相关代码Fork自<a href="https://docs.opencv.org/4.x/d7/dff/tutorial_feature_homography.html">OpenCV: Features2D + Homography to find a known object</a></p></blockquote><h3 id="最终代码实现"><a href="#最终代码实现" class="headerlink" title="最终代码实现"></a>最终代码实现</h3><h4 id="libmatch-h"><a href="#libmatch-h" class="headerlink" title="libmatch.h"></a>libmatch.h</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> LIBMATCH_EXPORTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIBMATCH_API extern <span class="string">&quot;C&quot;</span> __declspec(dllexport)</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">objectEx</span></span><br><span class="line">&#123;</span><br><span class="line">    cv::Rect_&lt;<span class="type">float</span>&gt; rect;</span><br><span class="line">    <span class="type">float</span> prob;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">objectEx2</span></span><br><span class="line">&#123;</span><br><span class="line">    cv::Point2f dots[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">qsort_descent_inplace</span><span class="params">(std::vector&lt;objectEx&gt;&amp; objects)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (objects.<span class="built_in">empty</span>())</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    std::<span class="built_in">sort</span>(objects.<span class="built_in">begin</span>(), objects.<span class="built_in">end</span>(), [](<span class="type">const</span> objectEx&amp; a, <span class="type">const</span> objectEx&amp; b) &#123;<span class="keyword">return</span> a.prob &gt; b.prob; &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">float</span> <span class="title">intersection_area</span><span class="params">(<span class="type">const</span> objectEx&amp; a, <span class="type">const</span> objectEx&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Rect_&lt;<span class="type">float</span>&gt; inter = a.rect &amp; b.rect;</span><br><span class="line">    <span class="keyword">return</span> inter.<span class="built_in">area</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">nms_sorted_bboxes</span><span class="params">(<span class="type">const</span> std::vector&lt;objectEx&gt;&amp; faceobjects, std::vector&lt;<span class="type">int</span>&gt;&amp; picked, <span class="type">float</span> nms_threshold)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    picked.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n = faceobjects.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">areas</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        areas[i] = faceobjects[i].rect.<span class="built_in">area</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> objectEx&amp; a = faceobjects[i];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> keep = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; (<span class="type">int</span>)picked.<span class="built_in">size</span>(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">const</span> objectEx&amp; b = faceobjects[picked[j]];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// intersection over union</span></span><br><span class="line">            <span class="type">float</span> inter_area = <span class="built_in">intersection_area</span>(a, b);</span><br><span class="line">            <span class="type">float</span> union_area = areas[i] + areas[picked[j]] - inter_area;</span><br><span class="line">            <span class="comment">// float IoU = inter_area / union_area</span></span><br><span class="line">            <span class="keyword">if</span> (inter_area / union_area &gt; nms_threshold)</span><br><span class="line">                keep = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (keep)</span><br><span class="line">            picked.<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> version = <span class="number">230622</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIBMATCH_API extern <span class="string">&quot;C&quot;</span> __declspec(dllimport)</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">objectEx</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Rect</span>&#123;</span><br><span class="line">        <span class="type">float</span> x, y, width, height;</span><br><span class="line">    &#125; rect;</span><br><span class="line">    <span class="type">float</span> prob;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">objectEx2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float</span> x, y;</span><br><span class="line">    &#125;dots[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">int</span> <span class="title">match_get_version</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">size_t</span> <span class="title">match_scan</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* src_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> src_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* target_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> target_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">float</span> prob_threshold,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">float</span> nms_threshold,</span></span></span><br><span class="line"><span class="params"><span class="function">    objectEx* RetObejectArr,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> maxRetCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">uint32_t</span> MaskColor <span class="comment">//Just For BGR,if high 2bit isn`t zero,mask will be disabled</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">bool</span> <span class="title">match_feat</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* src_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> src_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* target_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> target_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    objectEx2 &amp;result</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><h4 id="libmatch-cpp"><a href="#libmatch-cpp" class="headerlink" title="libmatch.cpp"></a>libmatch.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// libmatch.cpp : 定义 DLL 的导出函数。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;framework.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libmatch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">int</span> <span class="title">match_get_version</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> version;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">size_t</span> <span class="title">match_scan</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* src_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> src_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* target_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> target_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">float</span> prob_threshold,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">float</span> nms_threshold,</span></span></span><br><span class="line"><span class="params"><span class="function">    objectEx* RetObejectArr,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> maxRetCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">uint32_t</span> MaskColor <span class="comment">//Just For BGR,if high 2bit isn`t zero,mask will be disabled</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//Read and Process img Start</span></span><br><span class="line"></span><br><span class="line">    <span class="function">cv::_InputArray <span class="title">src_img_arr</span><span class="params">(src_img_data, src_img_size)</span></span>;</span><br><span class="line">    cv::Mat src_mat = cv::<span class="built_in">imdecode</span>(src_img_arr, cv::IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (src_mat.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[Match] Err Can`t Read src_img&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::_InputArray <span class="title">target_img_arr</span><span class="params">(target_img_data, target_img_size)</span></span>;</span><br><span class="line">    cv::Mat target_mat = cv::<span class="built_in">imdecode</span>(target_img_arr, cv::IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target_mat.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[Match] Err Can`t Read target_img&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target_mat.cols &gt; src_mat.cols || target_mat.rows &gt; src_mat.rows)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[Match]ERR Target is too large&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Read Over</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Template Match Start</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">result</span><span class="params">(src_mat.cols - target_mat.cols + <span class="number">1</span>, src_mat.rows - target_mat.rows + <span class="number">1</span>, CV_32FC1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((MaskColor &amp; <span class="number">0xff000000</span>) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::<span class="built_in">matchTemplate</span>(src_mat, target_mat, result, cv::TM_CCOEFF_NORMED);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cv::Mat temp_target_mat = cv::<span class="built_in">imdecode</span>(target_img_arr, cv::IMREAD_COLOR);</span><br><span class="line">        cv::Mat maks_mat = cv::Mat::<span class="built_in">zeros</span>(target_mat.rows, target_mat.cols, CV_8U);</span><br><span class="line">        <span class="comment">//Replace MaskColor</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; temp_target_mat.rows; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; temp_target_mat.cols; j++) &#123;</span><br><span class="line">                cv::Vec3b temp_color=temp_target_mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(cv::<span class="built_in">Point</span>(j, i));</span><br><span class="line">                <span class="keyword">if</span> (((temp_color[<span class="number">0</span>] &lt;&lt; <span class="number">16</span>) | (temp_color[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | temp_color[<span class="number">2</span>]) != MaskColor) &#123;</span><br><span class="line"><span class="comment">//                    std::cout &lt;&lt; ((temp_color[0] &lt;&lt; 16) | (temp_color[1] &lt;&lt; 8) | temp_color[2]) &lt;&lt; std::endl;</span></span><br><span class="line">                    maks_mat.<span class="built_in">at</span>&lt;<span class="type">uint8_t</span>&gt;(cv::<span class="built_in">Point</span>(j, i)) = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//      cv::imshow(&quot;result&quot;, maks_mat);</span></span><br><span class="line"><span class="comment">//      cv::waitKey();</span></span><br><span class="line">        cv::<span class="built_in">matchTemplate</span>(src_mat, target_mat, result, cv::TM_CCOEFF_NORMED, maks_mat);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Template Match Over</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//BackEnd Process</span></span><br><span class="line">    std::vector &lt;objectEx&gt; proposals;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; result.rows; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; result.cols; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(cv::<span class="built_in">Point</span>(j, i)) &gt;= prob_threshold)</span><br><span class="line">            &#123;</span><br><span class="line">                objectEx buf;</span><br><span class="line">                buf.prob = result.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(cv::<span class="built_in">Point</span>(j, i));</span><br><span class="line">                buf.rect.x = j;</span><br><span class="line">                buf.rect.y = i;</span><br><span class="line">                buf.rect.height = target_mat.rows;</span><br><span class="line">                buf.rect.width = target_mat.cols;</span><br><span class="line">                proposals.<span class="built_in">push_back</span>(buf);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; picked;</span><br><span class="line">    <span class="built_in">qsort_descent_inplace</span>(proposals);</span><br><span class="line">    <span class="built_in">nms_sorted_bboxes</span>(proposals, picked, nms_threshold);</span><br><span class="line"></span><br><span class="line">    std::vector &lt;objectEx&gt; objects;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : picked)</span><br><span class="line">        objects.<span class="built_in">emplace_back</span>(proposals[x]);</span><br><span class="line">    <span class="comment">//BackEnd Over</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(RetObejectArr, objects.<span class="built_in">data</span>(), <span class="built_in">sizeof</span>(objectEx) * std::<span class="built_in">min</span>(objects.<span class="built_in">size</span>(), maxRetCount));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objects.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LIBMATCH_API <span class="type">bool</span> <span class="title">match_feat</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* src_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> src_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint8_t</span>* target_img_data,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">size_t</span> target_img_size,</span></span></span><br><span class="line"><span class="params"><span class="function">    objectEx2 &amp;result</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//Read and Process img Start</span></span><br><span class="line"></span><br><span class="line">    <span class="function">cv::_InputArray <span class="title">src_img_arr</span><span class="params">(src_img_data, src_img_size)</span></span>;</span><br><span class="line">    cv::Mat src_mat = cv::<span class="built_in">imdecode</span>(src_img_arr, cv::IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (src_mat.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[Match] Err Can`t Read src_img&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::_InputArray <span class="title">target_img_arr</span><span class="params">(target_img_data, target_img_size)</span></span>;</span><br><span class="line">    cv::Mat target_mat = cv::<span class="built_in">imdecode</span>(target_img_arr, cv::IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target_mat.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[Match] Err Can`t Read target_img&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Read Over</span></span><br><span class="line">    <span class="comment">//-- Step 1: Detect the keypoints using SURF Detector, compute the descriptors</span></span><br><span class="line">    <span class="type">int</span> minHessian = <span class="number">400</span>;</span><br><span class="line">    cv::Ptr&lt;cv::xfeatures2d::SURF&gt; detector = cv::xfeatures2d::SURF::<span class="built_in">create</span>(minHessian);</span><br><span class="line">    std::vector&lt;cv::KeyPoint&gt; keypoints_object, keypoints_scene;</span><br><span class="line">    cv::Mat descriptors_object, descriptors_scene;</span><br><span class="line">    detector-&gt;<span class="built_in">detectAndCompute</span>(target_mat, cv::<span class="built_in">noArray</span>(), keypoints_object, descriptors_object);</span><br><span class="line">    detector-&gt;<span class="built_in">detectAndCompute</span>(src_mat,cv::<span class="built_in">noArray</span>(), keypoints_scene, descriptors_scene);</span><br><span class="line">    <span class="comment">//-- Step 2: Matching descriptor vectors with a FLANN based matcher</span></span><br><span class="line">    <span class="comment">// Since SURF is a floating-point descriptor NORM_L2 is used</span></span><br><span class="line">    cv::Ptr&lt;cv::DescriptorMatcher&gt; matcher = cv::DescriptorMatcher::<span class="built_in">create</span>(cv::DescriptorMatcher::FLANNBASED);</span><br><span class="line">    std::vector&lt; std::vector&lt;cv::DMatch&gt; &gt; knn_matches;</span><br><span class="line">    matcher-&gt;<span class="built_in">knnMatch</span>(descriptors_object, descriptors_scene, knn_matches, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">//-- Filter matches using the Lowe&#x27;s ratio test</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> ratio_thresh = <span class="number">0.75f</span>;</span><br><span class="line">    std::vector&lt;cv::DMatch&gt; good_matches;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; knn_matches.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (knn_matches[i][<span class="number">0</span>].distance &lt; ratio_thresh * knn_matches[i][<span class="number">1</span>].distance)</span><br><span class="line">        &#123;</span><br><span class="line">            good_matches.<span class="built_in">push_back</span>(knn_matches[i][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        OpenCV(4.7.0) D:\opencv-4.7.0\modules\calib3d\src\fundam.cpp:385. error:.</span></span><br><span class="line"><span class="comment">        (-28:Unknown error code -28) The input arrays should have at least 4</span></span><br><span class="line"><span class="comment">        corresponding point sets to calculate Homography in function</span></span><br><span class="line"><span class="comment">        &#x27;cv:findHomography&#x27;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> (good_matches.<span class="built_in">size</span>() &lt; <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//-- Draw matches</span></span><br><span class="line">    <span class="comment">//Mat img_matches;</span></span><br><span class="line">    <span class="comment">//drawMatches(img_object, keypoints_object, img_scene, keypoints_scene, good_matches, img_matches, Scalar::all(-1),</span></span><br><span class="line">    <span class="comment">//  Scalar::all(-1), std::vector&lt;char&gt;(), DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS);</span></span><br><span class="line">    <span class="comment">//-- Localize the object</span></span><br><span class="line">    std::vector&lt;cv::Point2f&gt; obj;</span><br><span class="line">    std::vector&lt;cv::Point2f&gt; scene;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; good_matches.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//-- Get the keypoints from the good matches</span></span><br><span class="line">        obj.<span class="built_in">push_back</span>(keypoints_object[good_matches[i].queryIdx].pt);</span><br><span class="line">        scene.<span class="built_in">push_back</span>(keypoints_scene[good_matches[i].trainIdx].pt);</span><br><span class="line">    &#125;</span><br><span class="line">    cv::Mat H = <span class="built_in">findHomography</span>(obj, scene, cv::RANSAC);</span><br><span class="line">    <span class="comment">//-- Get the corners from the image_1 ( the object to be &quot;detected&quot; )</span></span><br><span class="line">    <span class="function">std::vector&lt;cv::Point2f&gt; <span class="title">obj_corners</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    obj_corners[<span class="number">0</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    obj_corners[<span class="number">1</span>] = cv::<span class="built_in">Point2f</span>((<span class="type">float</span>)target_mat.cols, <span class="number">0</span>);</span><br><span class="line">    obj_corners[<span class="number">2</span>] = cv::<span class="built_in">Point2f</span>((<span class="type">float</span>)target_mat.cols, (<span class="type">float</span>)target_mat.rows);</span><br><span class="line">    obj_corners[<span class="number">3</span>] = cv::<span class="built_in">Point2f</span>(<span class="number">0</span>, (<span class="type">float</span>)target_mat.rows);</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;cv::Point2f&gt; <span class="title">buf_corners</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    cv::<span class="built_in">perspectiveTransform</span>(obj_corners, buf_corners, H);</span><br><span class="line">    <span class="built_in">memcpy</span>(result.dots, buf_corners.<span class="built_in">data</span>(), buf_corners.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(cv::Point2f));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h3><h4 id="多对象匹配-不规则匹配"><a href="#多对象匹配-不规则匹配" class="headerlink" title="多对象匹配+不规则匹配"></a>多对象匹配+不规则匹配</h4><p><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_230624090624_1.png" alt="效果演示"></p><h4 id="半透明控件匹配"><a href="#半透明控件匹配" class="headerlink" title="半透明控件匹配"></a>半透明控件匹配</h4><p><img src="https://images.cnblogs.com/cnblogs_com/blogs/694685/galleries/2013924/o_230624090624_2.png" alt="效果演示"></p><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><p>紧张而刺激的高考在本月落下了帷幕，结束了长达12年的通识教育，笔者终于能够潜下心来研究这些东西背后的数学原理。由于笔者的能力有限，本文存在不严谨的部分，希望读者可以谅解。</p><p>经验之谈：特征匹配不要出现过量的重复元素</p><p>算法交流群：904511841，143858000</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> OpenCV </tag>
            
            <tag> 计算机视觉 </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++判断某进程是否有管理员权限</title>
      <link href="/2024/03/25/C-%E5%88%A4%E6%96%AD%E6%9F%90%E8%BF%9B%E7%A8%8B%E6%98%AF%E5%90%A6%E6%9C%89%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/"/>
      <url>/2024/03/25/C-%E5%88%A4%E6%96%AD%E6%9F%90%E8%BF%9B%E7%A8%8B%E6%98%AF%E5%90%A6%E6%9C%89%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<p>本文只发布于：<a href="https://www.cnblogs.com/Icys/p/IsAdminProcess.html">https://www.cnblogs.com/Icys/p/IsAdminProcess.html</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">IsAdminProcess</span><span class="params">(UINT PID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (PID &lt;= <span class="number">0</span>)</span><br><span class="line">        PID = <span class="built_in">GetCurrentProcessId</span>();</span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION, FALSE, PID);</span><br><span class="line">    <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>) &#123;<span class="comment">//要么没这个进程，要么也有可能是ADMIN权限无法打开</span></span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    HANDLE hToken;</span><br><span class="line">    DWORD dwAttributes;</span><br><span class="line">    <span class="function">DWORD <span class="title">isAdmin</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">OpenProcessToken</span>(hProcess, TOKEN_QUERY, &amp;hToken))</span><br><span class="line">    &#123;</span><br><span class="line">        SID_IDENTIFIER_AUTHORITY Authority;</span><br><span class="line">        Authority.Value[<span class="number">5</span>] = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">        PSID psidAdmin = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">AllocateAndInitializeSid</span>(&amp;Authority, <span class="number">2</span>, SECURITY_BUILTIN_DOMAIN_RID, DOMAIN_ALIAS_RID_ADMINS, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;psidAdmin))</span><br><span class="line">        &#123;</span><br><span class="line">            DWORD dwCount = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">GetTokenInformation</span>(hToken, TokenGroups, <span class="literal">NULL</span>, <span class="number">0</span>, &amp;dwCount);</span><br><span class="line">            TOKEN_GROUPS *pTokenGroups = (TOKEN_GROUPS *)<span class="keyword">new</span> BYTE[dwCount];</span><br><span class="line">            <span class="built_in">GetTokenInformation</span>(hToken, TokenGroups, pTokenGroups, dwCount, &amp;dwCount);</span><br><span class="line">            DWORD dwGroupCount = pTokenGroups-&gt;GroupCount;</span><br><span class="line">            <span class="keyword">for</span> (DWORD i = <span class="number">0</span>; i &lt; dwGroupCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">EqualSid</span>(psidAdmin, pTokenGroups-&gt;Groups[i].Sid))</span><br><span class="line">                &#123;</span><br><span class="line">                    dwAttributes = pTokenGroups-&gt;Groups[i].Attributes;</span><br><span class="line">                    isAdmin = (dwAttributes &amp; SE_GROUP_USE_FOR_DENY_ONLY) != SE_GROUP_USE_FOR_DENY_ONLY;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">delete</span>[] pTokenGroups;</span><br><span class="line">            <span class="built_in">FreeSid</span>(psidAdmin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="keyword">return</span> isAdmin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++判断操作系统位数</title>
      <link href="/2024/03/25/C-%E5%88%A4%E6%96%AD%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BD%8D%E6%95%B0/"/>
      <url>/2024/03/25/C-%E5%88%A4%E6%96%AD%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BD%8D%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断当前系统是否为64位</span></span><br><span class="line"><span class="function">BOOL <span class="title">Is64BitSystem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> _WIN32</span></span><br><span class="line">    HMODULE hModule = <span class="built_in">LoadLibrary</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;kernel32.dll&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">UINT</span><span class="params">(WINAPI * _pGetSystemWow64DirectoryA)</span><span class="params">(LPSTR, UINT)</span></span>;</span><br><span class="line"></span><br><span class="line">    _pGetSystemWow64DirectoryA funcaddr = (_pGetSystemWow64DirectoryA)<span class="built_in">GetProcAddress</span>(hModule, <span class="string">&quot;GetSystemWow64DirectoryA&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (funcaddr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">FreeLibrary</span>(hModule);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        LPSTR lpBuffer = <span class="keyword">new</span> <span class="type">char</span>[MAX_PATH];</span><br><span class="line">        UINT ret = <span class="built_in">funcaddr</span>(lpBuffer, MAX_PATH);</span><br><span class="line">        <span class="built_in">FreeLibrary</span>(hModule);</span><br><span class="line">        <span class="keyword">delete</span>[] lpBuffer;</span><br><span class="line">        <span class="keyword">return</span> ret &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> <span class="string">&quot;我草泥马，别人都编译32位64位，就你这个孤儿非要特立独行。&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>32位程序获取32/64位进程文件地址通用方法</title>
      <link href="/2024/03/25/32%E4%BD%8D%E7%A8%8B%E5%BA%8F%E8%8E%B7%E5%8F%9632-64%E4%BD%8D%E8%BF%9B%E7%A8%8B%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95/"/>
      <url>/2024/03/25/32%E4%BD%8D%E7%A8%8B%E5%BA%8F%E8%8E%B7%E5%8F%9632-64%E4%BD%8D%E8%BF%9B%E7%A8%8B%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="32位程序获取32-64位进程文件地址通用方法"><a href="#32位程序获取32-64位进程文件地址通用方法" class="headerlink" title="32位程序获取32&#x2F;64位进程文件地址通用方法"></a>32位程序获取32&#x2F;64位进程文件地址通用方法</h1><h3 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h3><p>一般来说,限于32位程序<strong>GetModuleFileNameEx</strong>对于64位程序来说是不管用的,我们如果需要在32位程序获得64位进程的运行目录可能需要用到<strong>wow64</strong>或者是<strong>QueryFullProcessImageName</strong>。</p><p>但是</p><p>前者虽然通用，但是实现起来过于复杂，还需要用到汇编，后者</p><table><thead><tr><th><strong>Minimum supported client</strong></th><th>Windows Vista [desktop apps only]</th></tr></thead><tbody><tr><td><strong>Minimum supported server</strong></td><td>Windows Server 2008 [desktop apps only]</td></tr></tbody></table><blockquote><p>上为ms docs给出的限制条件，显然无法支持到诸如XP之类的系统</p></blockquote><p>显然这个API不是通用的，那么如果我们需要一个通用且方便的方法怎么办呢？</p><p>这时候就可以祭出我们的<strong>GetProcessImageFileNameA</strong></p><table><thead><tr><th><strong>Minimum supported client</strong></th><th>Windows XP [desktop apps only]</th></tr></thead><tbody><tr><td><strong>Minimum supported server</strong></td><td>Windows Server 2003 [desktop apps only]</td></tr><tr><td><strong>Target Platform</strong></td><td>Windows</td></tr><tr><td><strong>Header</strong></td><td>psapi.h</td></tr><tr><td><strong>Library</strong></td><td>Kernel32.lib on Windows 7 and Windows  Server 2008 R2; Psapi.lib (if PSAPI_VERSION&#x3D;1) on Windows 7 and Windows  Server 2008 R2; Psapi.lib on Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP</td></tr><tr><td><strong>DLL</strong></td><td>Kernel32.dll on Windows 7 and Windows  Server 2008 R2; Psapi.dll (if PSAPI_VERSION&#x3D;1) on Windows 7 and Windows  Server 2008 R2; Psapi.dll on Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP</td></tr></tbody></table><blockquote><p>支持还是蛮全的</p></blockquote><p>但是注意到这个API返回的是<strong>Native Path</strong>(\\**\****)，而不是我们熟悉的<strong>Dos Path</strong>(X:\**\***)</p><p>所以我们还需要<strong>QueryDosDeviceA</strong>进行转换</p><blockquote><p><del>值得一提的是，根据这个API所属DLL的变更，我们有理由认为<strong>QueryFullProcessImageName</strong>实际上就是这个API的封装</del></p></blockquote><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Created on: 2022-02-01</span></span><br><span class="line"><span class="comment">    Created by: Icys</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;psapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将Nt文件路径转为Dos文件路径</span></span><br><span class="line"><span class="function">std::string <span class="title">NTFilePath2DosFilePath</span><span class="params">(std::string name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> szDriveStr[MAX_PATH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> szDeviceStr[MAX_PATH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> szDrive[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> cchDevName = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">GetLogicalDriveStringsA</span>(<span class="built_in">sizeof</span>(szDriveStr), szDriveStr) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; szDriveStr[i]; i += <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(szDrive, szDriveStr + i, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">QueryDosDeviceA</span>(szDrive, szDeviceStr, <span class="built_in">sizeof</span>(szDeviceStr)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cchDevName = <span class="built_in">lstrlenA</span>(szDeviceStr);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strnicmp</span>(szDeviceStr, name.<span class="built_in">c_str</span>(), cchDevName) == <span class="number">0</span>) <span class="comment">//比较前缀</span></span><br><span class="line">        &#123;</span><br><span class="line">            name.<span class="built_in">replace</span>(<span class="number">0</span>, cchDevName, szDrive);</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">GetProcessPath</span><span class="params">(<span class="type">int</span> PID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, PID);</span><br><span class="line">    <span class="keyword">if</span> (!hProcess)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *FileNativePath = <span class="keyword">new</span> <span class="type">char</span>[MAX_PATH + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">GetProcessImageFileNameA</span>(hProcess, FileNativePath, MAX_PATH + <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    std::string FilePath = <span class="built_in">NTFilePath2DosFilePath</span>(FileNativePath);</span><br><span class="line">    <span class="keyword">delete</span>[] FileNativePath;</span><br><span class="line">    <span class="keyword">return</span> FilePath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">GetProcessPath</span>(<span class="number">15572</span>) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈可持久化Trie与线段树的原理以及实现(带图)</title>
      <link href="/2024/03/25/%E6%B5%85%E8%B0%88%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96Trie%E4%B8%8E%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0-%E5%B8%A6%E5%9B%BE/"/>
      <url>/2024/03/25/%E6%B5%85%E8%B0%88%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96Trie%E4%B8%8E%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0-%E5%B8%A6%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="浅谈可持久化Trie与线段树的原理以及实现"><a href="#浅谈可持久化Trie与线段树的原理以及实现" class="headerlink" title="浅谈可持久化Trie与线段树的原理以及实现"></a>浅谈可持久化Trie与线段树的原理以及实现</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>当我们需要保存一个数据结构不同时间的每个版本,最朴素的方法就是每个时间都创建一个独立的数据结构,单独储存。</p><p>但是这种方法不仅每次复制新的数据结构需要<strong>时间</strong>，<strong>空间</strong>上也受不了储存这么多版本的数据结构。</p><p>然而有一种叫<strong>git</strong>的工具，可以维护工程代码的各个版本，而空间上也不至于十分爆炸。怎么做到呢？</p><p>答案是<strong>版本分支</strong>，即每次创建新的版本不完全复制老的数据结构，而是在老的数据结构上加入不同版本的分支。</p><p>下面以链表为例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A--&gt;B</span><br><span class="line">B--&gt;C</span><br><span class="line">C--&gt;D</span><br><span class="line">D--&gt;E</span><br><span class="line">E--&gt;F</span><br><span class="line">F--&gt;G</span><br><span class="line">B--&gt;Z[C_新版本]</span><br><span class="line">Z--&gt;Y[D_新版本]</span><br><span class="line">Y--&gt;E</span><br></pre></td></tr></table></figure><p>新的版本是部分建立在老的版本之上的。不变的地方不变，有编号的地方就加入新版本的分支。</p><h2 id="实现可持久化Trie"><a href="#实现可持久化Trie" class="headerlink" title="实现可持久化Trie"></a>实现可持久化Trie</h2><p>基于<strong>版本分支</strong>的思想，我们怎么建立一个<strong>可持久化Trie</strong>呢？</p><p>其次我们注意到在上面那张链表图中进入下一个节点的时候，每次都要判断有没有我们要进入的新版本的分支，十分麻烦。有没有方法可以保证我们向下找的节点全部是我们要的版本呢？</p><p>有方法，我们只需要记录修改过的Trie的<strong>关键路径</strong>就好了。</p><p>什么叫<strong>关键路径</strong>呢？</p><p>这里先假设我们只修改Trie上的一个节点。而所谓<strong>关键路径</strong>就是从Trie的根节点到修改节点的路径，我们只创建这路径上的节点，其余节点全部继承一个老版本的节点。</p><p>如图</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">ROOT-.c.-&gt;c</span><br><span class="line">ROOT-.m.-&gt;m</span><br><span class="line">c--a--&gt;ca</span><br><span class="line">ca--t--&gt;cat</span><br><span class="line">m--a--&gt;ma</span><br><span class="line">ma--p--&gt;map</span><br><span class="line">ROOT_NEW--c--&gt;c;</span><br><span class="line">ROOT_NEW--m--&gt;m_NEW</span><br><span class="line">m_NEW--a--&gt;ma_NEW</span><br><span class="line">ma_NEW--p--&gt;map</span><br><span class="line">ma_NEW--r--&gt;mar_NEW</span><br><span class="line">mar_NEW--k--&gt;mark_NEW</span><br></pre></td></tr></table></figure><p>这是一个向有{cat,map}的Trie里插入mark的新单词的例子。</p><p>不难发现，在ROOT_NEW可以到达的节点构成的树中，凡是不在mark这个单词的路径上的节点统统用的是老版本树的节点。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p><del>由于可持久化Trie不是我们的主题，代码就不放了</del></p><p>代码很简单，就不多做解释了</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e1</span> + <span class="number">128</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> his[<span class="number">128</span>];</span><br><span class="line"><span class="type">int</span> h;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> to[N][<span class="number">26</span>];</span><br><span class="line"><span class="type">int</span> p;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(string &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> old = p; <span class="comment">//老树的节点</span></span><br><span class="line">    his[++h] = ++p;</span><br><span class="line">    <span class="type">int</span> now = p; <span class="comment">//新树的</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i : s)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++)</span><br><span class="line">            <span class="keyword">if</span> (i - <span class="string">&#x27;A&#x27;</span> != j) <span class="comment">//非关键路径上的节点继承老树</span></span><br><span class="line">                to[now][j] = to[old][j];</span><br><span class="line">        to[now][i - <span class="string">&#x27;A&#x27;</span>] = ++p; <span class="comment">//关键路径上的节点就新建</span></span><br><span class="line">        now = p;</span><br><span class="line">        old = to[now][i - <span class="string">&#x27;A&#x27;</span>]; <span class="comment">//老树也要跟下去</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ask</span><span class="params">(<span class="type">int</span> h, string &amp;s)</span> <span class="comment">//询问某个版本的Trie里,是否有对应的单词</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> now = his[h];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i : s)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (to[now][i - <span class="string">&#x27;A&#x27;</span>] == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        now = to[now][i - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> opt;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; opt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) <span class="comment">//插入</span></span><br><span class="line">        &#123;</span><br><span class="line">            string str;</span><br><span class="line">            cin &gt;&gt; str;</span><br><span class="line">            <span class="built_in">insert</span>(str);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            string str;</span><br><span class="line">            <span class="type">int</span> h;</span><br><span class="line">            cin &gt;&gt; str &gt;&gt; h;</span><br><span class="line">            cout &lt;&lt; ((<span class="built_in">ask</span>(h, str)) ? <span class="string">&#x27;Y&#x27;</span> : <span class="string">&#x27;N&#x27;</span>) &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="可持久化线段树"><a href="#可持久化线段树" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h2><p>终于到了我们的主题了。<del>可持久化线段树顾名思义就是可持久化的线段树</del></p><p>存在的意义首先是满足部分线段树的要求，然后也能根据线段树的特性解决一部分可持久化Trie的弊端。</p><p><del>聪明的</del>小伙伴可以发现在一个Trie中，我们要把一条完整的子链完全复制下来，如果我们老版本的Trie本来就是一条链，这种操作无异于把Trie重新复制一遍，还是相当慢，怎么办？</p><p>在维护一个Trie的时候，这种问题可能会让人头疼。但是线段树可以完全避免，因为线段树的树高是完全有限的[$Log (n)$级别]。</p><p>基本思路还是只记录修改过的<strong>关键路径</strong>，不在关键路径上的节点继承老版本的子树。</p><p><del>基本原理还是和可持久化Trie差不多，看图和代码基本也能理解了</del></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A([1-&gt;4]).-&gt;B([1-&gt;2])</span><br><span class="line">A.-&gt;C([3-&gt;4])</span><br><span class="line">B--&gt;D([1])</span><br><span class="line">B--&gt;E([2])</span><br><span class="line">C.-&gt;F([3])</span><br><span class="line">C.-&gt;G([4])</span><br><span class="line">H([1-&gt;4_new])--&gt;B</span><br><span class="line">H--&gt;I([3-&gt;4_new])</span><br><span class="line">I--&gt;F</span><br><span class="line">I--&gt;J([4_new])</span><br></pre></td></tr></table></figure><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><p>有一点要注意的是,这个线段树的节点关系已经是一个有向图了,不能用满二叉树的性质去计算他的左右儿子。需要手动记录。</p><p><del>其实就是<a href="https://www.luogu.com.cn/problem/P3919">P3919 【模板】可持久化线段树 1（可持久化数组）</a>的题解</del></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e7</span> + <span class="number">128</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> num[N / <span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> his[N / <span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> h_ptr;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> lc[N], rc[N], val[N];</span><br><span class="line"><span class="type">int</span> p;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r)</span> <span class="comment">//和常规的线段树建立差不多,就是要左右儿子不能用满二叉树性质算出来了,所以要手动存</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">    &#123;</span><br><span class="line">        val[u] = num[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    lc[u] = ++p;</span><br><span class="line">    rc[u] = ++p;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lc[u], l, mid);</span><br><span class="line">    <span class="built_in">build</span>(rc[u], mid + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fork_only</span><span class="params">(<span class="type">int</span> h)</span> <span class="comment">//仅仅只复制一个历史版本</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    his[h_ptr++] = his[h];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fork_and_edit</span><span class="params">(<span class="type">int</span> h, <span class="type">int</span> addr, <span class="type">int</span> val_)</span> <span class="comment">//复制一个带修改的版本为h的历史版本到最新版本中(把addr这里的数修改为val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> old = his[h];</span><br><span class="line">    <span class="type">int</span> now = ++p;</span><br><span class="line">    his[h_ptr++] = p;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = n;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (addr &lt;= mid) <span class="comment">//关键路径在左儿子</span></span><br><span class="line">        &#123;</span><br><span class="line">            rc[now] = rc[old]; <span class="comment">//所以右儿子直接继承</span></span><br><span class="line">            lc[now] = ++p;     <span class="comment">//新建一个左儿子</span></span><br><span class="line">            now = lc[now];</span><br><span class="line">            old = lc[old];</span><br><span class="line">            r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            lc[now] = lc[old]; <span class="comment">//反之继承左儿子</span></span><br><span class="line">            rc[now] = ++p;</span><br><span class="line">            now = rc[now];</span><br><span class="line">            old = rc[old];</span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    val[now] = val_;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = n;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (addr &lt;= mid)</span><br><span class="line">            u = lc[u], r = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            u = rc[u], l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val[u];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        cin &gt;&gt; num[i];</span><br><span class="line">    his[h_ptr++] = ++p;</span><br><span class="line">    <span class="built_in">build</span>(p, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v, opt, loc;</span><br><span class="line">        cin &gt;&gt; v &gt;&gt; opt &gt;&gt; loc;</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> value;</span><br><span class="line">            cin &gt;&gt; value;</span><br><span class="line">            fork_and_edit(v, loc, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(his[v], loc) &lt;&lt; endl;</span><br><span class="line">            fork_only(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果对代码有问题欢迎评论斧正。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> Trie </tag>
            
            <tag> 可持久化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>平衡树不好打?试试Trie字典树！</title>
      <link href="/2024/03/25/%E5%B9%B3%E8%A1%A1%E6%A0%91%E4%B8%8D%E5%A5%BD%E6%89%93-%E8%AF%95%E8%AF%95Trie%E5%AD%97%E5%85%B8%E6%A0%91%EF%BC%81/"/>
      <url>/2024/03/25/%E5%B9%B3%E8%A1%A1%E6%A0%91%E4%B8%8D%E5%A5%BD%E6%89%93-%E8%AF%95%E8%AF%95Trie%E5%AD%97%E5%85%B8%E6%A0%91%EF%BC%81/</url>
      
        <content type="html"><![CDATA[<h1 id="Woc-考场-面试-忘记打平衡树怎么办-Trie救你命"><a href="#Woc-考场-面试-忘记打平衡树怎么办-Trie救你命" class="headerlink" title="Woc,考场(面试)忘记打平衡树怎么办,Trie救你命"></a>Woc,考场(面试)忘记打平衡树怎么办,Trie救你命</h1><h2 id="算法导入"><a href="#算法导入" class="headerlink" title="算法导入"></a>算法导入</h2><p>众所周知平衡树很难打(大佬除外),还老是调错。万一这种事情发生在关键时刻你就GG了。那我们怎么办呢？</p><p>从本质上介绍,平衡树作用就是维护一个有序的序列(关系)。很多操作我们用vector(数组)+lower_bound(二分查找),都可以实现。但是vector插入不便,导致序列维护不便。如果用list(链表)代替vector,那么查找又很慢。怎么办呢？</p><p>考虑到我们一般都是维护一个整数的排序，那么我能不能找到一种支持动态排序的数据结构。堆可以进行动态处理，但是只有第一个是有序的，他的子节点只能满足比他小(大)。</p><p>难道除了平衡树我们就没有别的方法了吗？答案是有的。看看下面的树。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">Root--&gt;A[&quot;0&quot;]</span><br><span class="line">Root--&gt;B[&quot;1&quot;]</span><br><span class="line">A[&quot;0&quot;]--&gt;C[&quot;0&quot;]</span><br><span class="line">A[&quot;0&quot;]--&gt;D[&quot;1&quot;]</span><br><span class="line">B[&quot;1&quot;]--&gt;E[&quot;0&quot;]</span><br><span class="line">B[&quot;1&quot;]--&gt;F[&quot;1&quot;]</span><br><span class="line">C[&quot;0&quot;].-&gt;G[&quot;0&quot;]</span><br><span class="line">D[&quot;1&quot;].-&gt;H[&quot;1&quot;]</span><br><span class="line">E[&quot;0&quot;].-&gt;I[&quot;2&quot;]</span><br><span class="line">F[&quot;1&quot;].-&gt;K[&quot;3&quot;]</span><br></pre></td></tr></table></figure><blockquote><p>这不是01Trie(字典树)吗？这能当平衡树？？？？</p></blockquote><p>别急，仔细看看。</p><p>这个Trie是不是左子树小于右子树？</p><blockquote><p>好像是啊</p></blockquote><p>再想想为什么？</p><blockquote><p>应该是二进制关系,左边的节点当前这一位是0,后面更小的位再大,也不可能比当前这一位是1的大了。</p></blockquote><p>没错</p><p>你再想想，Trie字典树是不是可以动态插入？</p><blockquote><p>好像是</p></blockquote><p>所以我们可以利用这种关系实现平衡了。<strong>甚至我们还能很简单的实现可持久化</strong>。</p><p>但是不难看出有几个缺点。</p><ol><li><p>空间要比一般平衡树大，一个int32最坏情况需要32个int32去记录他。当然实际情况也不可能都是这样。实际运用中有许多的重复节点，可以重复利用的。知道数字范围的时候也能调整树高解决。在一道平衡树的模板题，内存是FHQ_Treap的1.7倍,速度更快，内存是Splay的2&#x2F;3，速度差不多。是红黑树的4&#x2F;5，速度是1&#x2F;2。</p></li><li><p>不能直接输入负数(除非你建树的时候把符号位也建立进去，不过这样你也不好解决大小查找，毕竟负数是补码，情况和正数相反)。你需要加一个比较大的数值使得负数变为正数。</p></li><li><p>不能进行序列操作(不过支持这个操作的平衡树也不多)。</p></li></ol><p>当然直接用Trie也不行，你还需要维护几个信息,否则你没法实现一些功能。<br>你需要维护</p><ol><li>每个节点对应子树大小</li><li>每个叶子节点的值的数量(为了支持重复值插入)</li></ol><hr><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="提前定义"><a href="#提前定义" class="headerlink" title="提前定义"></a>提前定义</h3><p>这里我定义树高为25层</p><p><code>const int MAXLOG=25;</code></p><h3 id="节点信息"><a href="#节点信息" class="headerlink" title="节点信息"></a>节点信息</h3><p>需要保存两个儿子，节点子树大小，叶子节点计数</p><p>代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ch[<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> sze, cnt;</span><br><span class="line">&#125; Tree[MAXLOG];</span><br><span class="line"><span class="type">int</span> p; <span class="comment">//模拟一个内存池,这是对应的顶。</span></span><br></pre></td></tr></table></figure><h3 id="插入-删除-操作"><a href="#插入-删除-操作" class="headerlink" title="插入&amp;删除 操作"></a>插入&amp;删除 操作</h3><p>插入操作其实和一般树没什么区别，唯一不同的地方就是你需要维护节点的sze和cnt信息。</p><p>删除操作和插入操作其实一样，区别就是一个做加法，一个做减法。</p><p>代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">updata</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> offset)</span> <span class="comment">// 插入/删除 offset个x,插入正,删除负</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> now = <span class="number">0</span>; <span class="comment">//0是根</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXLOG - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> now_bit = (x &amp; (<span class="number">1</span> &lt;&lt; i) != <span class="number">0</span>); <span class="comment">//第i位的数值</span></span><br><span class="line">        <span class="keyword">if</span> (!Tree[now].ch[now_bit] == <span class="number">0</span>)    <span class="comment">//指向空,需要分配子节点</span></span><br><span class="line">            Tree[now].ch[now_bit] = ++p;</span><br><span class="line">        now = Tree[now].ch[now_bit];</span><br><span class="line">        Tree[now].sze += offset; <span class="comment">//这条子树链上的节点都需要</span></span><br><span class="line">    &#125;</span><br><span class="line">    Tree[now].cnt += offset; <span class="comment">//跑到叶子节点了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数取排名"><a href="#数取排名" class="headerlink" title="数取排名"></a>数取排名</h3><p>代码也是比较简单,就是注意当节点为NULL的时候就可以退出了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_rank</span><span class="params">(<span class="type">int</span> x)</span> <span class="comment">//获取比x小的数的数量,不包括本身</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> now = <span class="number">0</span>; <span class="comment">//0是根</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXLOG - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> now_bit = ((x &amp; (<span class="number">1</span> &lt;&lt; i)) != <span class="number">0</span>); <span class="comment">//第i位的数值</span></span><br><span class="line">        <span class="keyword">if</span> (now_bit == <span class="number">1</span>)                     <span class="comment">//处于大的那一边</span></span><br><span class="line">            ans += Tree[Tree[now].ch[<span class="number">0</span>]].sze; <span class="comment">//把比自己小的那些加上</span></span><br><span class="line">        now = Tree[now].ch[now_bit];</span><br><span class="line">        <span class="keyword">if</span> (now == <span class="number">0</span>) <span class="comment">//别忘了,这里的0是空的意思</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="排名取数"><a href="#排名取数" class="headerlink" title="排名取数"></a>排名取数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_kth</span><span class="params">(<span class="type">int</span> k)</span> <span class="comment">//通过排名大小</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> now = <span class="number">0</span>; <span class="comment">//0是根</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXLOG - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> temp = Tree[Tree[now].ch[<span class="number">0</span>]].sze; <span class="comment">//看看自己前面有多少</span></span><br><span class="line">        <span class="keyword">if</span> (k &lt;= temp)                        <span class="comment">//还在更前面</span></span><br><span class="line">            now = Tree[now].ch[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//在自己后面</span></span><br><span class="line">        &#123;</span><br><span class="line">            k -= temp; <span class="comment">//更新相对在右子树的位置</span></span><br><span class="line">            now = Tree[now].ch[<span class="number">1</span>];</span><br><span class="line">            ans |= (<span class="number">1</span> &lt;&lt; i); <span class="comment">//可以确定这一位是1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (now == <span class="number">0</span>) <span class="comment">//别忘了,这里的0是空的意思</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="求前驱-后继"><a href="#求前驱-后继" class="headerlink" title="求前驱&amp;后继"></a>求前驱&amp;后继</h3><p>这个也是草鸡简单</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">get_kth</span>(<span class="built_in">get_rank</span>(x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">get_kth</span>(<span class="built_in">get_rank</span>(x + <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p>由于这个树是基于Trie的,Trie能可持久化,这个也能。不过可持久化我们以后再讲。</p><hr><p>完整代码下载地址:<a href="https://files.cnblogs.com/files/blogs/694685/TrieBST.7z">https://files.cnblogs.com/files/blogs/694685/TrieBST.7z</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> C </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 平衡树 </tag>
            
            <tag> Trie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随机数计算法比较,更好的随机数对于程序是否真的值得</title>
      <link href="/2024/03/25/%E9%9A%8F%E6%9C%BA%E6%95%B0%E8%AE%A1%E7%AE%97%E6%B3%95%E6%AF%94%E8%BE%83-%E6%9B%B4%E5%A5%BD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AF%B9%E4%BA%8E%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%90%A6%E7%9C%9F%E7%9A%84%E5%80%BC%E5%BE%97/"/>
      <url>/2024/03/25/%E9%9A%8F%E6%9C%BA%E6%95%B0%E8%AE%A1%E7%AE%97%E6%B3%95%E6%AF%94%E8%BE%83-%E6%9B%B4%E5%A5%BD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AF%B9%E4%BA%8E%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%90%A6%E7%9C%9F%E7%9A%84%E5%80%BC%E5%BE%97/</url>
      
        <content type="html"><![CDATA[<p>#随机数计算法比较,更好的随机数对于程序是否真的值得。</p><blockquote><p>本次,我们将评测四种随机数生成法<br>测试语言为C++<br>测试有不严谨的地方欢迎提出。<br>本文仅仅发布于<a href="https://www.cnblogs.com/Icys/p/Rand.html">博客园</a></p></blockquote><p>下面是他们时间表现</p><table><thead><tr><th>名称</th><th>生成$1\times 10^9$个随机数耗时(ms)</th></tr></thead><tbody><tr><td>库函数rand耗时</td><td>8634</td></tr><tr><td>mt19937</td><td>8176</td></tr><tr><td>xorshift32耗时</td><td>6724</td></tr><tr><td>modrand耗时</td><td>6116</td></tr></tbody></table><h2 id="算法介绍"><a href="#算法介绍" class="headerlink" title="算法介绍"></a>算法介绍</h2><h3 id="库函数rand"><a href="#库函数rand" class="headerlink" title="库函数rand"></a>库函数rand</h3><p>这个不用多说，cstdlib里的库函数。</p><p>用的就是LCG(linear congruential generator)算法</p><p>基于$X(n+1) &#x3D; (a * X(n) + c) \mod m$​这样的公式</p><p>下面的modrand就是手写实现的这种算法。</p><h3 id="mt19937"><a href="#mt19937" class="headerlink" title="mt19937"></a>mt19937</h3><p>也就是Mersenne Twister MT19937(马特赛特旋转演算法)的实现。</p><p>基于有限二进制字段上的矩阵线性再生。可以快速产生高质量的伪随机数，修正了古老随机数产生算法的很多缺陷。</p><blockquote><p>转载自百度百科：</p><p>Mersenne Twister算法的原理：Mersenne Twister算法是利用<a href="https://baike.baidu.com/item/%E7%BA%BF%E6%80%A7%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8/12731198">线性反馈移位寄存器</a>(LFSR)产生随机数的，LFSR的反馈函数是寄存器中某些位的简单异或，这些位也称之为抽头序列。一个$n$位的LFSR能够在重复之前产生$2^n-1$位长的<a href="https://baike.baidu.com/item/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E5%BA%8F%E5%88%97/4932210">伪随机序列</a>。只有具有一定抽头序列的LFSR才能通过所有$2^n-1$个内部状态，产生$2^n - 1$位长的伪随机序列，这个输出的序列就称之为m序列。为了使LFSR成为最大周期的LFSR，由抽头序列加上常数1形成的多项式必须是<a href="https://baike.baidu.com/item/%E6%9C%AC%E5%8E%9F%E5%A4%9A%E9%A1%B9%E5%BC%8F/3246261">本原多项式</a>。一个n阶本原多项式是不可约多项式，它能整除$x^(2*n-1)+1$而不能整除$x^d+1$，其中d能整除$2^n-1$。例如$(32,7,5,3,2,1,0)$是指本原多项式$x^32+x^7+x^5+x^3+x^2+x+1$，把它转化为最大周期LFSR就是在LFSR的第$32，7，5，2，1$位抽头。利用上述两种方法产生周期为$m$的伪随机序列后，只需要将产生的伪随机序列除以序列的周期，就可以得到$(0，1)$上均匀分布的伪随机序列了。</p><p>Mersenne Twister有以下优点：随机性好，在计算机上容易实现，占用内存较少(mt19937的C程式码执行仅需$624$个字的工作区域)，与其它已使用的<a href="https://baike.baidu.com/item/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0">伪随机数</a>发生器相比，产生随机数的速度快、周期长，可达到2^19937-1，且具有623维均匀分布的性质，对于一般的应用来说，足够大了，序列关联比较小，能通过很多随机性测试。</p></blockquote><h3 id="xorshift32"><a href="#xorshift32" class="headerlink" title="xorshift32"></a>xorshift32</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">xorshift32</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">x</span><span class="params">(<span class="number">13147</span>)</span></span>;</span><br><span class="line">    x ^= x &lt;&lt; <span class="number">13</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="number">17</span>;</span><br><span class="line">    x ^= x &lt;&lt; <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>是一个比较复杂的数论问题,作者也不会。</p><h3 id="modrand"><a href="#modrand" class="headerlink" title="modrand"></a>modrand</h3><p>看代码就知道是什么原理了</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">modrand</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">seed</span><span class="params">(<span class="number">13147</span>)</span></span>;</span><br><span class="line">    seed = (seed * <span class="number">31</span> + <span class="number">13</span>) % ((<span class="number">1</span> &lt;&lt; <span class="number">31</span>) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> seed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实际表现"><a href="#实际表现" class="headerlink" title="实际表现"></a>实际表现</h2><p>上面的算法,有的实现快,但是生成的质量不一定高，有的质量高，生成就更慢。</p><p>所以实际表现到底怎么样呢？</p><p>我将对下面的项目进行测试</p><table><thead><tr><th>序号</th><th>项目名</th></tr></thead><tbody><tr><td>1</td><td>FHQ_Treap实现<a href="https://www.luogu.com.cn/problem/P6136">普通平衡树（数据加强版）</a></td></tr></tbody></table><p>上面两个应该是随机函数比较常见的应用了。</p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><h4 id="FHQ-Treap-Rand生成速度将影响总时间-而随机数的质量将影响树高-也会影响总时间"><a href="#FHQ-Treap-Rand生成速度将影响总时间-而随机数的质量将影响树高-也会影响总时间" class="headerlink" title="FHQ_Treap(Rand生成速度将影响总时间,而随机数的质量将影响树高,也会影响总时间)"></a>FHQ_Treap(Rand生成速度将影响总时间,而随机数的质量将影响树高,也会影响总时间)</h4><table><thead><tr><th>名称</th><th>耗时(s)</th></tr></thead><tbody><tr><td>库函数rand耗时</td><td><strong>8.33s</strong></td></tr><tr><td>mt19937</td><td><strong>8.72s</strong></td></tr><tr><td>xorshift32耗时</td><td><strong>8.34s</strong></td></tr><tr><td>modrand耗时</td><td><strong>8.72s</strong></td></tr></tbody></table><p>可以发现rand本身就够用了,除非有特殊要求没必要换用其他的函数。更没必要自己手写。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 测试 </tag>
            
            <tag> 随机数 </tag>
            
            <tag> 性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ODT(珂朵莉树)实现及其应用，带图</title>
      <link href="/2024/03/25/ODT-%E7%8F%82%E6%9C%B5%E8%8E%89%E6%A0%91-%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%8C%E5%B8%A6%E5%9B%BE/"/>
      <url>/2024/03/25/ODT-%E7%8F%82%E6%9C%B5%E8%8E%89%E6%A0%91-%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%8C%E5%B8%A6%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h3 id="数据结构-ODT-珂朵莉树-实现及其应用，带图"><a href="#数据结构-ODT-珂朵莉树-实现及其应用，带图" class="headerlink" title="[数据结构]ODT(珂朵莉树)实现及其应用，带图"></a>[数据结构]ODT(珂朵莉树)实现及其应用，带图</h3><h3 id="算法引入"><a href="#算法引入" class="headerlink" title="算法引入"></a>算法引入</h3><p>需要一种这样的数据结构,需要支持区间的修改,区间不同值的分别操作。</p><p>一般的，我们会想到用线段树或者Splay等支持序列操作的数据结构。但是我们这里讲引入一种更加简单的数据结构。</p><h3 id="算法介绍"><a href="#算法介绍" class="headerlink" title="算法介绍"></a>算法介绍</h3><h4 id="节点信息"><a href="#节点信息" class="headerlink" title="节点信息"></a>节点信息</h4><h5 id="节点定义"><a href="#节点定义" class="headerlink" title="节点定义"></a>节点定义</h5><p>ODT的基本节点将保存如下信息。</p><ol><li><p>该节点所代表序列的左右区间</p></li><li><p>该节点所代码的区间的值</p><p>C++代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Odt_Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l, r;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><p>可以发现一个ODT节点需要代表的是一块值全部相同的区间</p><h5 id="节点信息维护"><a href="#节点信息维护" class="headerlink" title="节点信息维护"></a>节点信息维护</h5><p>ODT基本节点可以由各种数据结构进行维护，一般我们使用C++自带的数据结构std::set。</p><p>按节点的左端点进行升序排序。这样我们就可以完整的保存一个1~n的序列信息了。</p><p>C++代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Odt_Node &amp;a, <span class="type">const</span> Odt_Node &amp;b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a.l &lt; b.l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><table><thead><tr><th>操作名</th><th>含义</th></tr></thead><tbody><tr><td>split(x)</td><td>把ODT节点(区间)单独分开，使得有一个子节点(区间)的左端点为x。(在x之前把区间分裂开)</td></tr><tr><td>assign(l,r,val)</td><td>把区间[l,r]全部赋值为val</td></tr></tbody></table><h5 id="Split实现"><a href="#Split实现" class="headerlink" title="Split实现"></a>Split实现</h5><p>首先我们需要找到x点的位置。这里我们使用的是set的upper_bound函数,利用这个函数我们可以轻松的找到第一个开头大于x的区间,而x就在这个区间的前一个区间里面。</p><p>当然如果前一个区间开头刚好是x,那就可以直接返回这个区间节点对应的迭代器。</p><ol><li><p>如果区间开头不是x,那就说明x在这个区间里面,我们要做的就是把这个区间分裂开。</p></li><li><p>首先我们记录我们要分裂的这个区间的左右端点，以及数值。</p></li><li><p>然后我们就可以把要分裂的这个区间节点从set里删除了。</p></li><li><p>再插入两个新节点(一个是 “L-&gt;(x-1)” 另一个是 “x-&gt;R”)。</p></li><li><p>直接返回x开头的那个元素的迭代器就好了</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">A[&quot;L-&gt;R&quot;]--&gt;B[&quot;L-&gt;(x-1)&quot;]</span><br><span class="line">A[&quot;L-&gt;R&quot;]--&gt;C[&quot;x-&gt;R&quot;]</span><br></pre></td></tr></table></figure><p>差不多就上面这个样子。</p><p>代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">auto</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; n)</span><br><span class="line">        <span class="keyword">return</span> S.<span class="built_in">end</span>();</span><br><span class="line">    <span class="keyword">auto</span> iter = --S.<span class="built_in">upper_bound</span>(&#123;x, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (iter-&gt;l == x)</span><br><span class="line">        <span class="keyword">return</span> iter;</span><br><span class="line">    <span class="type">int</span> l = iter-&gt;l, r = iter-&gt;r;</span><br><span class="line">    <span class="type">char</span> v = iter-&gt;v;</span><br><span class="line">    S.<span class="built_in">erase</span>(iter);</span><br><span class="line">    S.<span class="built_in">insert</span>(&#123;l, x - <span class="number">1</span>, v&#125;);</span><br><span class="line">    <span class="keyword">return</span> S.<span class="built_in">insert</span>(&#123;x, r, v&#125;).first;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Assign实现"><a href="#Assign实现" class="headerlink" title="Assign实现"></a>Assign实现</h5><p>Assign的作用就是区间赋值。既然我们需要进行区间赋值，那么我们就要把这个区间整出来。我们把区间的左右端点分割开了</p><p>如果从区间上看就是这样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[&quot;...&quot;]--&gt;B[&quot;L-...&quot;].-&gt;C[&quot;...&quot;].-&gt;D[&quot;...-(R-1)&quot;]--&gt;E[&quot;R-....&quot;]--&gt;F[&quot;...&quot;]</span><br></pre></td></tr></table></figure><p>这时候我们只需要把[L,R)之间的节点删除就好了。</p><p>然后插入一个新的直接[L,R)的区间节点。</p><p><strong>有点像是把这些零零碎碎的节点直接推平重整</strong></p><p>代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">assign</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">char</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> itr = <span class="built_in">split</span>(r + <span class="number">1</span>), itl = <span class="built_in">split</span>(l);</span><br><span class="line">    S.<span class="built_in">erase</span>(itl, itr);</span><br><span class="line">    S.<span class="built_in">insert</span>(&#123;l, r, v&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="特殊操作"><a href="#特殊操作" class="headerlink" title="特殊操作"></a>特殊操作</h4><h5 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h5><p>有时候我们不仅仅需要满足区间修改这个操作。我们可能还需要进行区间排序。</p><p>怎么实现呢？我们当然不可能在ODT里跑一个数组里的那样的排序算法，难写，而且浪费时间</p><p>我们考虑到排序操作的影响结果——就是把第几小的放到前面。</p><p>这和ODT的区间修改不谋而合。我们只需要统计出各个数的数量，然后从小到大依次修改对应的区间就好了。</p><p>至于统计出现数的数量，你可以使用桶排序(数组或者map都行)。</p><p>一般题目也是要求给一个字符串排序。</p><p>代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cnt[<span class="string">&#x27;Z&#x27;</span> + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">conut</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="keyword">sizeof</span> cnt);</span><br><span class="line">    <span class="keyword">auto</span> itr = <span class="built_in">split</span>(r + <span class="number">1</span>), itl = <span class="built_in">split</span>(l);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = itl; i != itr; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cnt[i-&gt;v] += i-&gt;r - i-&gt;l + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">conut</span>(l, r);</span><br><span class="line">    <span class="type">int</span> nl = l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="string">&#x27;A&#x27;</span>; i &lt;= <span class="string">&#x27;Z&#x27;</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">assign</span>(nl, nl + cnt[i] - <span class="number">1</span>, i);</span><br><span class="line">        nl += cnt[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> C </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> ODT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FHQ_Treap从入门到精通(注释比代码多系列)</title>
      <link href="/2024/03/25/FHQ-Treap%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E6%B3%A8%E9%87%8A%E6%AF%94%E4%BB%A3%E7%A0%81%E5%A4%9A%E7%B3%BB%E5%88%97/"/>
      <url>/2024/03/25/FHQ-Treap%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E6%B3%A8%E9%87%8A%E6%AF%94%E4%BB%A3%E7%A0%81%E5%A4%9A%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="普通-FHQ-Treap从入门到精通-注释比代码多系列"><a href="#普通-FHQ-Treap从入门到精通-注释比代码多系列" class="headerlink" title="普通 FHQ_Treap从入门到精通(注释比代码多系列)"></a>普通 FHQ_Treap从入门到精通(注释比代码多系列)</h1><h2 id="芝士前置"><a href="#芝士前置" class="headerlink" title="芝士前置"></a>芝士前置</h2><table><thead><tr><th>知识名</th><th>内容</th></tr></thead><tbody><tr><td><a href="https://oi-wiki.org/ds/bst/">二叉搜索树</a></td><td>一颗每个节点的左儿子val都比自己小,右儿子val都比自己大的树</td></tr><tr><td>Treap</td><td>堆和平衡树的结合(Tree+Heap),其中的pri变量满足堆的性质(父亲的比自己大),val变量满足平衡树的性质</td></tr></tbody></table><h2 id="芝士引入"><a href="#芝士引入" class="headerlink" title="芝士引入"></a>芝士引入</h2><h3 id="节点定义"><a href="#节点定义" class="headerlink" title="节点定义"></a>节点定义</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FHQ_Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> sze, val, pri;</span><br><span class="line">    <span class="type">int</span> lc, rc;</span><br><span class="line">    <span class="built_in">FHQ_Node</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        sze = <span class="number">1</span>; <span class="comment">//注意0号节点不能这样</span></span><br><span class="line">        pri = <span class="built_in">rand</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; FHQ_Tree[N];</span><br></pre></td></tr></table></figure><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>FHQ_Treap不同于传统Treap，FHQ_Treap是基于以下两个基本操作<strong>分裂</strong>，<strong>合并</strong>，而不是旋转。所以也有叫<strong>无旋Treap</strong>。</p><p>基本思路很简单</p><table><thead><tr><th>操作</th><th>含义</th></tr></thead><tbody><tr><td>分裂</td><td>把一个树按一个界限分裂，通常是按val值分裂。小于val的节点放一颗树，大于val的节点放另一棵树。</td></tr><tr><td>合并</td><td>把两个树合并，通常情况下合并的两树有严格的大小关系（一般是A树的每个节点值，均小于B树）。</td></tr></tbody></table><h3 id="操作解释"><a href="#操作解释" class="headerlink" title="操作解释"></a>操作解释</h3><h4 id="分裂"><a href="#分裂" class="headerlink" title="分裂"></a>分裂</h4><p>分裂操作是基于递归实现的。</p><p>分裂过程接受两个参数：根指针$u$​ 、关键值$key$​ 。结果为将根指针指向的 treap 分裂为两个 treap，第一个 treap 所有结点的关键值小于$key $​，第二个 treap 所有结点的关键值大于等于$key $​。该过程首先判断$key$​ 是否大于 $u$​的关键值，若大于，则说明 $u$​及其左子树全部属于第一个 treap(<strong>当然也有一部分右子树属于,一部分不属于,所以需要递归进去</strong>)，否则说明$u$​及其右子树全部属于第二个 treap(<strong>同理,也需要递归进去</strong>)。根据此判断决定应向左子树递归还是应向右子树递归，继续分裂子树。待子树分裂完成后按刚刚的判断情况连接 的左子树或右子树到递归分裂所得的子树中。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">split</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> _key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">//如果我是个空节点，那我就算分割后的节点也是空的</span></span><br><span class="line">    <span class="keyword">if</span> (FHQ_Tree[u].val &lt; _key) <span class="comment">//当前节点小于临界key，右儿子比我大，说不定有比key大（或者等于）的，左儿子比我小，一定不可能大于等于key了</span></span><br><span class="line">    &#123;</span><br><span class="line">        pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(FHQ_Tree[u].rc, _key); <span class="comment">//但是右儿子里可能有比我大的（甚至是大于key）</span></span><br><span class="line">        FHQ_Tree[u].rc = ret.first;                       <span class="comment">//没有key的那作为的的新右儿子，随我一起被切出去</span></span><br><span class="line">        <span class="built_in">updata</span>(u);                                        <span class="comment">//我被切了，需要维护一下大小信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(u, ret.second);                  <span class="comment">//我属于小于key的部分，而被切除了小于key节点的右儿子当然就完全都是大于等于key了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">//当前节点大于等于临界key，右儿子比我还大，肯定是也大于key的，不用管。</span></span><br><span class="line">    &#123;</span><br><span class="line">        pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(FHQ_Tree[u].lc, _key); <span class="comment">//同理左儿子也有可能小于我的（甚至是小于key）</span></span><br><span class="line">        FHQ_Tree[u].lc = ret.second;                      <span class="comment">//比大于等于key的作为我的新左儿子，和我一起走</span></span><br><span class="line">        <span class="built_in">updata</span>(u);                                        <span class="comment">//我被切了，需要维护一下大小信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(ret.first, u);                   <span class="comment">//我清除掉了小于key的子树，这部分小于key，而和我在一起的都要比key大</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h4><p>合并操作也是基于递归的</p><p>合并过程接受两个参数：左 treap 的根指针$x$ 、右 treap $y$的根指针 。必须满足$u$中所有结点的关键值小于$y$中所有结点的关键值。因为两个 treap 已经有序，我们只需要考虑$pri$​来决定哪个 treap 应与另一个 treap 的儿子合并。若$x$的根结点的$pri$大于$y$的，那么 即为新根结点，$y$应与$x$的右子树合并；反之，则$y$作为新根结点，然后让$x$与$y$的左子树合并。不难发现，这样合并所得的树依然满足$pri$的大根堆性质。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> <span class="comment">//把x和y拼在一起(前提是x里所有节点都要比y所有节点小)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!x || !y) <span class="comment">//如果其中有一个节点是空的，那就别合并了，直接返回非空的那个就好了</span></span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    <span class="keyword">if</span> (FHQ_Tree[x].pri &gt; FHQ_Tree[y].pri) <span class="comment">//采用大根堆，x现在应该在y上面</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//由于x都比y小，那么y只能挂在x的右儿子上</span></span><br><span class="line">        <span class="comment">//                      x全部小于y,这里顺序别搞错了</span></span><br><span class="line">        FHQ_Tree[x].rc = <span class="built_in">merge</span>(FHQ_Tree[x].rc, y); <span class="comment">//考虑到x原本可能就有右儿子，先把x的右儿子和y拼在一起再说</span></span><br><span class="line">        <span class="built_in">updata</span>(x);                                 <span class="comment">//y挂在了我身上，我肯定变大了，需要维护一些大小信息</span></span><br><span class="line">        <span class="keyword">return</span> x;                                  <span class="comment">//y在我下面，我才是这棵树的老大</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">//现在x应该在y下面了</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//由于x都比y小，那么y只能考虑挂在y的左儿子上</span></span><br><span class="line">        <span class="comment">//                      x全部小于y,这里顺序别搞错了</span></span><br><span class="line">        FHQ_Tree[y].lc = <span class="built_in">merge</span>(x, FHQ_Tree[y].lc); <span class="comment">//考虑到y原本可能就有左儿子，先把x和y的左儿子拼在一起再说</span></span><br><span class="line">        <span class="built_in">updata</span>(y);                                 <span class="comment">//x挂在了我身上，我肯定变大了，需要维护一些大小信息</span></span><br><span class="line">        <span class="keyword">return</span> y;                                  <span class="comment">//x在我下面，我才是这棵树的老大</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="功能操作"><a href="#功能操作" class="headerlink" title="功能操作"></a>功能操作</h3><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><p>先在待插入的关键值处将整棵 treap 分裂，判断关键值是否已插入过之后新建一个结点，包含待插入的关键值，然后进行两次合并操作即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> _val)</span> <span class="comment">//插入一个点</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FHQ_Tree[++p].val = _val;               <span class="comment">//先是创建一个这个样的节点</span></span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(root, _val); <span class="comment">//以val为分界线,把这棵树分裂成两部分</span></span><br><span class="line">    <span class="comment">//现在我们尝试把这个新节点插入到树里</span></span><br><span class="line">    <span class="type">int</span> _new = <span class="built_in">merge</span>(ret.first, p); <span class="comment">//上文说道，split返回的第一个树的每个节点一定比val小,这个时候就可以把这个比val小的树和新的那个节点合并了</span></span><br><span class="line">    root = <span class="built_in">merge</span>(_new, ret.second); <span class="comment">//由于新加入的节点的优先级我们是未知的,有可能比原来的根节点大,导致在原来根节点上面,发生换根</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>将具有待删除的关键值的结点从整棵 treap 中孤立出来（进行两侧分裂操作），删除中间的一段（具有待删除关键值），再将左右两端合并即可。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> _val)</span> <span class="comment">//删除一个</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(root, _val);            <span class="comment">//按val为分界线,现在含有val的树一定是ret.second了;</span></span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret2 = <span class="built_in">split</span>(ret.second, _val + <span class="number">1</span>); <span class="comment">//再把ret.second里的节点再分一遍,现在ret2.first里的节点一定全是数为val的点</span></span><br><span class="line">    <span class="comment">//通常情况下,我们只删除一个节点</span></span><br><span class="line">    <span class="type">int</span> _new = <span class="built_in">merge</span>(FHQ_Tree[ret2.first].lc, FHQ_Tree[ret2.first].rc); <span class="comment">//左儿子和右边儿子合并,其实是其中一个优先级较大的,跑出来当爹,原来的父亲就会被孤立</span></span><br><span class="line">    root = <span class="built_in">merge</span>(<span class="built_in">merge</span>(ret.first, _new), ret2.second);                  <span class="comment">//同样的,我们删除的有可能就是原来的根,导致发生换根</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取排名"><a href="#获取排名" class="headerlink" title="获取排名"></a>获取排名</h4><p>把一个树按分为小于$val$的，和大于等于$val$的，$val$的排名自然就是小于$val$的节点的数量+1了</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getrank</span><span class="params">(<span class="type">int</span> _val)</span> <span class="comment">//获取排名</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(root, _val); <span class="comment">//以val为分界线,这样ret.first里的东西都要比val小</span></span><br><span class="line">    <span class="type">int</span> rank = FHQ_Tree[ret.first].sze + <span class="number">1</span>; <span class="comment">//比val小的树节点全在里面,val的排名自然就是他们的数量+1了</span></span><br><span class="line">    root = <span class="built_in">merge</span>(ret.first, ret.second);    <span class="comment">//别忘了把原来拆分的树合起来</span></span><br><span class="line">    <span class="keyword">return</span> rank;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过排名取数字"><a href="#通过排名取数字" class="headerlink" title="通过排名取数字"></a>通过排名取数字</h4><p>和二叉搜索树一样，不再赘述。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getnum</span><span class="params">(<span class="type">int</span> _rank)</span> <span class="comment">//通过排名取出这个数来,返回节点的编号</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> now = root; <span class="comment">//同平衡二叉树的方法一样,从根节点向下找</span></span><br><span class="line">    <span class="keyword">while</span> (now)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//now的左节点全是比now小的,所以比now小的数量加上1(now自己),如果正好是我们要求的点的排名,那么now就是我们要的点了</span></span><br><span class="line">        <span class="keyword">if</span> (FHQ_Tree[FHQ_Tree[now].lc].sze + <span class="number">1</span> == _rank)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (FHQ_Tree[FHQ_Tree[now].lc].sze &gt;= _rank) <span class="comment">//同理,如果比now小的数的数量大于等于我们的rank,那么排名为rand的数必须要更小,只能在now的左子树上</span></span><br><span class="line">            now = FHQ_Tree[now].lc;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//rank的位置在now的后面,说明rank的数要比now还大,我们就要去右节点找</span></span><br><span class="line">        &#123;</span><br><span class="line">            _rank -= FHQ_Tree[FHQ_Tree[now].lc].sze + <span class="number">1</span>; <span class="comment">//由于我们要找到节点在now右节点上,右节点的排名是相对于now的排名,所以我们需要把now的排名减掉</span></span><br><span class="line">            now = FHQ_Tree[now].rc;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> now;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="求前驱"><a href="#求前驱" class="headerlink" title="求前驱"></a>求前驱</h4><p>用把原来的二叉树分裂开，一部分全是小于$val$的，另一部分全是大于等于$val$。而前驱就是前一个二叉树里最大的，用二叉搜索树的性质就能得到。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> _val)</span> <span class="comment">//求前驱,返回节点的值</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(root, _val); <span class="comment">//以val为分界线分裂</span></span><br><span class="line">    <span class="type">int</span> now = ret.first;                    <span class="comment">//ret.first的数值都比val小</span></span><br><span class="line">    <span class="keyword">while</span> (FHQ_Tree[now].rc)                <span class="comment">//找比val小的数里最大的,就是前驱了</span></span><br><span class="line">        now = FHQ_Tree[now].rc;</span><br><span class="line">    <span class="type">int</span> ans = FHQ_Tree[now].val;</span><br><span class="line">    root = <span class="built_in">merge</span>(ret.first, ret.second); <span class="comment">//别忘了把他俩合并了</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="求后继"><a href="#求后继" class="headerlink" title="求后继"></a>求后继</h4><p>用把原来的二叉树分裂开，一部分全是小于$val+1$的，另一部分全是大于等于$val+1$。而后继就是后一个二叉树里最小的，用二叉搜索树的性质就能得到。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> _val)</span> <span class="comment">//求后继,返回节点的值</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ret = <span class="built_in">split</span>(root, _val + <span class="number">1</span>); <span class="comment">//以val+1为分界线分裂,所有比val大的数全在ret.second里</span></span><br><span class="line">    <span class="type">int</span> now = ret.second;                       <span class="comment">//在比val的数里找</span></span><br><span class="line">    <span class="keyword">while</span> (FHQ_Tree[now].lc)                    <span class="comment">//找比val大的数里最小了的,就是后继了</span></span><br><span class="line">        now = FHQ_Tree[now].lc;</span><br><span class="line">    <span class="type">int</span> ans = FHQ_Tree[now].val;</span><br><span class="line">    root = <span class="built_in">merge</span>(ret.first, ret.second); <span class="comment">//别忘了把他俩合并了</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h3><p><a href="https://www.luogu.com.cn/problem/P3369">洛谷3369</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FHQ_Tree[<span class="number">0</span>].sze = <span class="number">0</span>; <span class="comment">//0号节点作为溢出点,不能有大小</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span> (n--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> opt, val;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; val;</span><br><span class="line">        <span class="keyword">switch</span> (opt)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">ins</span>(val);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">del</span>(val);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            cout &lt;&lt; <span class="built_in">getrank</span>(val) &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            cout &lt;&lt; FHQ_Tree[<span class="built_in">getnum</span>(val)].val &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            cout &lt;&lt; <span class="built_in">pre</span>(val) &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            cout &lt;&lt; <span class="built_in">nxt</span>(val) &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完整代码下载地址:<a href="https://files.cnblogs.com/files/blogs/694685/FHQ.7z">https://files.cnblogs.com/files/blogs/694685/FHQ.7z</a></p><blockquote><p>如果未来有时间我将会出一个支持序列的FHQTreap教程。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> C </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>国产Linux发行版 Deepin 评价与主观展望 我与Deepin的故事</title>
      <link href="/2024/03/25/%E5%9B%BD%E4%BA%A7Linux%E5%8F%91%E8%A1%8C%E7%89%88-Deepin-%E8%AF%84%E4%BB%B7%E4%B8%8E%E4%B8%BB%E8%A7%82%E5%B1%95%E6%9C%9B-%E6%88%91%E4%B8%8EDeepin%E7%9A%84%E6%95%85%E4%BA%8B/"/>
      <url>/2024/03/25/%E5%9B%BD%E4%BA%A7Linux%E5%8F%91%E8%A1%8C%E7%89%88-Deepin-%E8%AF%84%E4%BB%B7%E4%B8%8E%E4%B8%BB%E8%A7%82%E5%B1%95%E6%9C%9B-%E6%88%91%E4%B8%8EDeepin%E7%9A%84%E6%95%85%E4%BA%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>全文皆属于up自己的主观臆断，有不到之处可以进行批评，共同成长。</p></blockquote><hr><h3 id="P1-编辑时间-2021-2-20"><a href="#P1-编辑时间-2021-2-20" class="headerlink" title="P1 编辑时间(2021-2-20)"></a>P1 编辑时间(2021-2-20)</h3><p>   昨天，我刷b站的时候见到一则旧闻，关于我国操作系统的。原本只是想写个1000字左右的评论的，没想到写了这么多。</p><p>​从了解Deepin开始到现在差不多也有了5年时间，其实Deepin不是我最早了解的国产Linux发行版，我最早了解的一个叫优麒麟的操作系统。我大概是从4年级开始接触到了虚拟机，接下来差不多5年级我就开始接触Linux了，还是要感谢国产Linux发行版，否则我都不知道Linux系统。一开始我接触Linux只能在虚拟机上，那时候Linux适配做的不是很好，尤其是那时候我用的一张山寨显卡，导致在非windows下显卡驱动加载不了。</p><p>​还记得我5年级的时候，为了在Ubuntu上面打一把minecraft，下午一放学回到家就开始琢磨在电脑上安装java。那时候我还很菜，网络社区也不如现在怎么发达，我也不知道linux有apt啊yum这些东西，搞得我一连好几天都在搞，从编译java，配置环境变量，发现显卡驱动不对劲，换显卡驱动（同理，那时候我也不知道驱动管理器，安装网上的教程一步一步来，关掉窗口服务，进纯命令行模式，执行nvidia的那个显卡驱动安装）。就这样过了好几天我终于才在linux吃上了minecraft。</p><p>​好了，废话少说。我第一次使用的Deepin是2016年的时候，具体版本号已经忘记了。我印象中深度不是做盗版windows系统的吗（up的第一个xp安装镜像就是深度的），怎么做起自己的操作系统了。不过那时候Deepin给我留下的印象很好，UI简洁大方，应用商店简单易用。就是那时候我电脑显卡支持不如Ubuntu好，在Ubuntu上面选对版本号我的山寨显卡起码还能驱动，在deepin上面我就只能用开源驱动了。就这样我差不多用了一个月，实在忍不了动不动就卡个花屏后，无奈换回了Windows系统。这就是我与Deepin的第一次邂逅。</p><p>​在后来，我的那张山寨显卡终于在一次渲染视频的时候烧毁了，于是我换上了我现在所用的电脑。而我也总于有条件用上我热爱的Deepin。那时候电脑的各个硬件基本都能正常驱动，网页也流畅，没有出现花屏的现象了。我在那台Deepin上体验了人生第一个开源游戏，第一次使用apt，第一次使用Deepin提供的crossover安装QQ，第一次用lvm给自己磁盘上了个锁。每次都不亦乐乎，还时不时向朋友吹嘘自己使用的是国产操作系统。我那时候刚上初中，有一次阅读文章中出现了deep的派生词，全班就我一个人翻译对了，我那时候真的很感谢深度，让我这个英语白痴有机会在班上崭露头角。😂️</p><p>​但是这种快乐的生活随着一次版本更新终结了，那个版本是深度首发显卡驱动管理器的版本。更新前我热泪盈眶，更新后800x600的分辨率把我恶心的老泪纵横（nvidia wdnmd）。我尝试把之前手动安装的nv驱动清理掉后再用深度官方的显卡驱动管理器安装新驱动，结果还是涛声依旧，于是我告别了我所用的Deepin。</p><p>​过了不知道多久，大概是在18年。我不知道是被Windows下的垃圾广告流氓程序恶心到了，还是收到了linux大法的真切呼唤（主要是中美贸易战），我又回来了。我为了完完全全的体验deepin，以及了解到普通用户对deepin的感受，我还给我妈的电脑上安装了deepin。不管怎么说安装是真的比以前顺利了很多。我妈那时候喜欢看电视连续剧，所以我打算用wine给他装个优酷或者是pps爱奇艺（那时候PPS和爱奇艺好像才刚刚合并）。但是无论怎么样都安装不了，忌惮于鸡毛掸子的威力，我又给我妈的电脑安装回了Windows，而我的电脑仍是Deepin。后来由于那时候我一直在学习一种小众的编程语言（易语言），且该编程语言ide只支持Windows，我又放弃了Deepin。</p><p>​我有一次心血来潮玩起了caffe深度学习这些东西，鉴于在windows上面配置太麻烦，我换成了Linux，我一开始是打算在Deepin上面搭建环境的。但是还是那个该死的显卡驱动，我电脑是开了raid 0的，为了快速启动（开机时候不会显示那个远古的raid配置界面）我把安全启动打开了（uefi的那个）。但是Deepin死活是没有支持安全启动，导致我安装不上显卡驱动，raid的盘显示加载也不正常。主要还是不支持cuda加速。我换成了Ubuntu，据我所知，Ubuntu在18.04的时候就对我的电脑的安全启动支持比较好（在最新的版本中已经可以像Windows那样把logo换成主板的制造商logo，而不是Ubuntu logo了），我曾经也向Deepin官方反馈过，但是始终没有答复。</p><p>‍‍ 上一次看见Deepin的官方b站账号说迅雷将要发布在Linux上，我二话没说回来了，Deepin已是v20了。我显卡也换成Vega56并且刷好了wx8200的BIOS，但是amd的Pro的最新显卡驱动只支持Ubuntu18.04。我没能打上官方驱动。但我还是这样坚持用了下来，不管怎么说Deepin的生态是越来越好了。wps用起来也不错，剪辑视频用Blender（还是没有显卡加速），对于我来说基本也够。steam上面对linux有支持的游戏挺多的，再不济也能开个wine玩，整体感觉还是不错的。但是依然存在严重的兼容性BUG，运行时间长了之后，屏幕会异常白屏（就是整个屏幕变白，系统没有反应）。可能是系统休眠上面的BUG不吧。</p><p> 总结一下，Deepin近几年的发展势头是越来越好了，有国内大厂的支持（虽然力度不够，但是远比以前要好），有更多的技术成熟的人才。但是我觉得Deepin还是太年轻了，就拿最近的说，最近的UI那个圆角太圆了，我用qt的窗口甚至出现了一些轻微的bug（比如圆角的附近窗口底色覆盖不到）。不知道是Deepin的开发人员认为这么圆是很好看还是怎么样，目前就我所知的一些操作系统都没有这么圆的圆角。而且这ui莫名的像MacOS（Deepin UI走点心吧）。</p><p>​还有就是作为一个小的个人开发者对Deepin的评价，鉴于Deepin本身就是个Linux，开发环境没什么好说的，Linux有什么Deepin就有什么。但是作为一个长期使用Windows API的开发者来说，在Deepin上面开发是真的难受（虽然比MacOS上面 malloc.h 不叫 malloc.h ，还少几个函数好） ，但是要实现一些实用功能，我认为我不太习惯。比如抓取窗口截图，在Windows上面我思路十分清晰，可是在不熟悉的Deepin上面一筹莫展。我觉得Windows之所以受到大量开发者的青睐，不仅仅是因为原有的软件生态，关键是他的完好的开发者社区以及官方提供的开发工具和知识库（比如vs msdn）。深度既然能为普通用户做妥协，为什么不能为开发者妥协呢。Windows系统庞大的生态链里更多的难道不是个人开发者开发的小工具吗。期待有一天，我打开我的Deepin 能看到一个 deepin studio，include的时候能看见一个 deepin.h。我知道，这样将与Linux的开源精神背道而驰，但是不这样相对其它Linux也没竞争优势。</p><p>   所以我更觉得Deepin不应该局限于Linux,为什么不看看bsd，虽然我没有用过诸如freebsd这类系统，但是据我所知，他们也是可以兼容Linux应用的。为什么Deepin不借助bsd呢。我希望Deepin在借助Linux带来的生态环境，也可以摆脱原有Linux的生态链，走自己的路。</p><p> 我用Deepin差不多也有5年了，这5年我看到了Deepin的成长，Deepin也见证了我的成长。鉴于现在的时代大背景下，Deepin一定会迎来春天。</p><p>希望Deepin能越做越好。</p><p>由于本up主的阅历还很浅薄，本文章使用手机码字。有不到之处，请各位读者多多包涵。</p><hr><h3 id="P2-编辑时间-2021-8-14"><a href="#P2-编辑时间-2021-8-14" class="headerlink" title="P2 编辑时间(2021-8-14)"></a>P2 编辑时间(2021-8-14)</h3><p>​这是笔者第二次写关于Deepin的文章。这半年发生了很多事情。首先是越来越多的软件选择支持Linux。其次是Deepin拿到了安全启动的证书。终于把笔者期盼了几年的东西盼着了。然后就是Deepin开始可以支持安卓应用，其实这是笔者见怪不怪的，说实话Inetl的开源项目，不能给我i一种耳目一新的感觉。</p><p>​但是笔者使用看来还是有很多不足之处的。</p><ol><li>首先还是驱动问题，我的wx8200还是无法正常驱动。在笔者笔记本上安装甚至遇到了不可逆的BUG（这个笔者尚不确定）。</li><li>接着就是一些稳定性问题，说实话，稳定性还是不行。</li><li>UI也是一个问题，过于妖艳了。不知道是走的谷歌风还是苹果风，虽然UI很漂亮，但是实用性不强。再加上部分软件的UI老是改来改去的。操作逻辑别老是换行不行啊。</li><li>老生长谈，API，SDK问题。用Deepin开发就给我一种用Qt的感觉，而不是一种开发一种成熟系统的感觉。首先Deepin是基于LInux的没错，API用LInux的，或者用开源Lib固然是没错的，但是我还是希望Deepin能够作出自己的风格（这也是我希望的国产系统可以用Bsd的原因）。</li></ol><p>还有一件比较大的事情，就是鸿蒙OS大面积铺开使用。</p><p>现在鸿蒙OS在非移动端的平台尚未公开，发布会也没有给出细节，与其听信某些业内人士的话，不如先不说话，多想。如果鸿蒙OS在其发布会上面所说的架构可以实现，那还是相当不错的。说实话，华为入局，对国产系统影响蛮大的。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 感悟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Map 与 unordered_map 横向与纵向测试，附带原始数据与测试程序</title>
      <link href="/2024/03/25/Map-%E4%B8%8E-unordered-map-%E6%A8%AA%E5%90%91%E4%B8%8E%E7%BA%B5%E5%90%91%E6%B5%8B%E8%AF%95%EF%BC%8C%E9%99%84%E5%B8%A6%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F/"/>
      <url>/2024/03/25/Map-%E4%B8%8E-unordered-map-%E6%A8%AA%E5%90%91%E4%B8%8E%E7%BA%B5%E5%90%91%E6%B5%8B%E8%AF%95%EF%BC%8C%E9%99%84%E5%B8%A6%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>写程序时，面临用Map还是unordered_map，总是很纠结，于是写了个程序进行测试</p></blockquote><h1 id="Map-与-unordered-map-横向与纵向测试，附带原始数据与测试程序"><a href="#Map-与-unordered-map-横向与纵向测试，附带原始数据与测试程序" class="headerlink" title="Map 与 unordered_map 横向与纵向测试，附带原始数据与测试程序"></a>Map 与 unordered_map 横向与纵向测试，附带原始数据与测试程序</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><table><thead><tr><th>配件</th><th>信息</th></tr></thead><tbody><tr><td>CPU</td><td>Intel® Pentium(R) CPU G3260 @ 3.30GHz × 2</td></tr><tr><td>内存</td><td>7.6 GiB</td></tr><tr><td>系统</td><td>Ubuntu 20.04.1 LTS</td></tr><tr><td>编译器</td><td>g++-9</td></tr><tr><td>编译选项</td><td>-O2</td></tr></tbody></table><h2 id="简单数据-4-Byte"><a href="#简单数据-4-Byte" class="headerlink" title="简单数据(4 Byte)"></a>简单数据(4 Byte)</h2><p>首先先上一组小数据</p><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>Map写入</td><td>1000</td><td>94</td></tr><tr><td>——Map读取</td><td>1000</td><td>62</td></tr><tr><td>unordered_map写入</td><td>1000</td><td>101</td></tr><tr><td>——unordered_map读取</td><td>1000</td><td>61</td></tr></tbody></table><p><strong>可以看到数据较小时候是Map占优势</strong></p><p>再来一组中等数据</p><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>Map写入</td><td>10000</td><td>1682</td></tr><tr><td>——Map读取</td><td>10000</td><td>2703</td></tr><tr><td>unordered_map写入</td><td>10000</td><td>1160</td></tr><tr><td>——unordered_map读取</td><td>10000</td><td>677</td></tr></tbody></table><p><strong>大于1000后就是unordered_map优势更大</strong></p><p>特大数据下情况是</p><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>Map写入</td><td>1000000</td><td>855782</td></tr><tr><td>——Map读取</td><td>1000000</td><td>811670</td></tr><tr><td>unordered_map写入</td><td>1000000</td><td>267515</td></tr><tr><td>——unordered_map读取</td><td>1000000</td><td>118495</td></tr></tbody></table><p><strong>大数据便是unordered_map</strong>完全碾压</p><h2 id="复杂数据-32-Byte"><a href="#复杂数据-32-Byte" class="headerlink" title="复杂数据(32 Byte)"></a>复杂数据(32 Byte)</h2><p>有人可能会说当数据很复杂时unordered_map容易引发冲突</p><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>Map写入</td><td>10000</td><td>4064</td></tr><tr><td>——Map读取</td><td>10000</td><td>4569</td></tr><tr><td>unordered_map写入</td><td>10000</td><td>2139</td></tr><tr><td>——unordered_map读取</td><td>10000</td><td>1716</td></tr></tbody></table><p>和上面比较，发现数据变得更复杂时，Map更不如unordered_map了 </p><h2 id="重载和函数的速度"><a href="#重载和函数的速度" class="headerlink" title="重载和函数的速度"></a>重载和函数的速度</h2><p>另外测试还发现，无论是写入还是读取，用重载方法都要比函数慢，其中读取慢的更多。</p><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>Map重载写入</td><td>1000000</td><td>906477</td></tr><tr><td>——Map重载读取</td><td>1000000</td><td>1115637</td></tr><tr><td>Map函数写入</td><td>1000000</td><td>855782</td></tr><tr><td>——Map函数读取</td><td>1000000</td><td>811670</td></tr></tbody></table><table><thead><tr><th>测试项目</th><th>数据范围</th><th>耗时(us)</th></tr></thead><tbody><tr><td>unordered_map重载写入</td><td>1000000</td><td>284470</td></tr><tr><td>——unordered_map重载读取</td><td>1000000</td><td>276208</td></tr><tr><td>unordered_map函数写入</td><td>1000000</td><td>267515</td></tr><tr><td>——unordered_map函数读取</td><td>1000000</td><td>118495</td></tr></tbody></table><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据上面的数据可以分析出</p><p>在数据小于1000时，可以采取Map。大于1000，小于10000时，如果需要排序，选用Map，不需要就unordered_map。大于10000的时候没有特殊要求，采用Map。</p><p>另外，插入和读取如果有<strong>时间</strong>刚需，<strong>应该采用函数，而不是重载</strong>。</p><h1 id="原始数据与测试程序"><a href="#原始数据与测试程序" class="headerlink" title="原始数据与测试程序"></a>原始数据与测试程序</h1><p>如果有人需要原始数据，可以看看。</p><h2 id="int-4"><a href="#int-4" class="headerlink" title="int 4"></a>int 4</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><h4 id="operator"><a href="#operator" class="headerlink" title="operator"></a>operator</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M[<span class="built_in">rand</span>()] = <span class="built_in">rand</span>();</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M[<span class="built_in">rand</span>()];</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>26</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>3</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>0</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>15</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>134</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>1781</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>4</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>48145</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>7</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>823069</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>7</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>13</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>217</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>2971</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>5</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>119565</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>9</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>947049</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>10</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>9</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>17</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>8</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>231</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>11</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>3457</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>14</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>86540</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>24</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>1350311</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>166</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>147</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>133</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>24</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>132</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>245</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>143</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>3755</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>200</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>115802</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>219</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>950769</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>2963</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>2988</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>6</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>2905</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>43</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>4573</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>1448</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>3492</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>12881</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>2880</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>101483</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>2951</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>935608</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>49535</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>70612</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>8</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>76232</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>76</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>80457</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>790</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>84432</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>9677</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>78376</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>97320</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>69574</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>965508</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>903613</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>3</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>907309</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>12</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>916617</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>119</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>917360</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>1177</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>904860</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>12960</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>905297</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>127472</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>906477</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>1115637</td><td>1000000</td><td>1000000</td></tr></tbody></table><h4 id="insert-find"><a href="#insert-find" class="headerlink" title="insert &amp; find"></a>insert &amp; find</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand</span>(), <span class="built_in">rand</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M.<span class="built_in">find</span>(<span class="built_in">rand</span>());</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>26</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>0</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>0</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>12</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>109</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>1086</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>10757</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>3</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>3</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>19</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>187</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>1813</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>18350</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>19</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>4</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>12</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>7</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>5</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>7</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>37</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>7</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>367</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>11</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>3599</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>11</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>35590</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>259</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>107</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>99</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>94</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>62</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>95</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>565</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>99</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>5584</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>101</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>55971</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>1732</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>2230</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>4</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>2644</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>28</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>1633</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>188</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>1682</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>2703</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>1638</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>14327</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>1546</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>142330</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>67350</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>69654</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>4</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>64137</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>39</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>67940</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>436</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>63069</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>4709</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>86477</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>64116</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>67929</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>370789</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>768626</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>850479</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>12</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>857980</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>84</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>854080</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>899</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>856615</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>9960</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>871467</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>111029</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>855782</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>811670</td><td>1000000</td><td>1000000</td></tr></tbody></table><h3 id="unordered-map"><a href="#unordered-map" class="headerlink" title="unordered_map"></a>unordered_map</h3><h4 id="operator-1"><a href="#operator-1" class="headerlink" title="operator"></a>operator</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tr1/unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tr1;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M[<span class="built_in">rand</span>()] = <span class="built_in">rand</span>();</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M[<span class="built_in">rand</span>()];</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>22</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>3</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>15</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>98</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>973</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>18905</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>7</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>304928</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>6</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>0</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>211558</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>83</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>816</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>18775</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>9</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>331476</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>10</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>9</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>10</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>10</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>84</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>21</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>856</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>16</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>19406</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>20</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>344753</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>93</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>98</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>95</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>5</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>94</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>81</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>106</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>749</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>97</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>20981</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>110</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>330149</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>858</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>858</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>837</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>7</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>841</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>59</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>850</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>950</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>849</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>27480</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>919</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>338245</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>33755</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>29546</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>31192</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>97</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>30126</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>216</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>37193</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>1996</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>32065</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>39717</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>17520</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>473755</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>480733</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>345884</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>44</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>284269</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>24</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>283844</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>223</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>278945</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>2068</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>280158</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>189937</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>284470</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>376208</td><td>1000000</td><td>1000000</td></tr></tbody></table><h4 id="insert-find-1"><a href="#insert-find-1" class="headerlink" title="insert &amp; find"></a>insert &amp; find</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tr1/unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tr1;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand</span>(), <span class="built_in">rand</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M.<span class="built_in">find</span>(<span class="built_in">rand</span>());</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>24</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>18</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>174</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>1720</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>17160</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>4</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>25</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>238</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>2361</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>23766</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>6</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>12</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>4</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>13</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>13</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>17</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>45</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>14</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>251</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>12</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>2390</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>12</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>24286</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>126</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>98</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>93</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>3</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>101</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>61</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>104</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>259</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>97</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>2492</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>96</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>25507</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>1587</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>1013</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>823</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>8</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>840</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>54</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>1160</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>677</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>813</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>4968</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>808</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>38649</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>28790</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>11</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>45300</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>5</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>34463</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>14</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>35388</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>113</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>32767</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>2677</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>31524</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>13741</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>33473</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>100586</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>300962</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>442759</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>270830</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>10</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>270029</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>124</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>268652</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>1192</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>269445</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>12717</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>267515</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>118495</td><td>1000000</td><td>1000000</td></tr></tbody></table><h2 id="Btye-32"><a href="#Btye-32" class="headerlink" title="Btye 32"></a>Btye 32</h2><h4 id="map-1"><a href="#map-1" class="headerlink" title="map"></a>map</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">__uint128_t</span> <span class="title">rand128</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">rand</span>() | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">32</span>) | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">64</span>) | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">96</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            map&lt;pair&lt;<span class="type">__uint128_t</span>, <span class="type">__uint128_t</span>&gt;, <span class="type">int</span>&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand128</span>(), <span class="built_in">rand128</span>()), <span class="built_in">rand</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand128</span>(), <span class="built_in">rand128</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>24</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>0</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>70</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>693</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>7061</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>70166</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>4</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>3</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>83</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>802</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>7936</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>3</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>81096</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>26</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>13</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>18</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>103</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>17</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>996</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>20</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>9949</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>19</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>100397</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>226</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>166</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>164</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>15</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>164</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>133</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>167</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>1278</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>168</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>12895</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>174</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>127273</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>2917</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>2730</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>4</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>3344</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>36</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>5555</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>670</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>4300</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>4064</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>4569</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>35972</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>3696</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>235334</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>80213</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>75975</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>7</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>72787</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>61</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>72727</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>620</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>78175</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>6618</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>85278</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>74804</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>69928</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>541858</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>937039</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>996383</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>12</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>997665</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>116</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>1001405</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>1115</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>994444</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>11241</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>1009323</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>126125</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>998410</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>1002439</td><td>1000000</td><td>1000000</td></tr></tbody></table><h4 id="unordered-map-1"><a href="#unordered-map-1" class="headerlink" title="unordered_map"></a>unordered_map</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tr1/unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tr1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">hashfunc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> pair&lt;<span class="type">__uint128_t</span>, <span class="type">__uint128_t</span>&gt; &amp;i)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tr1::<span class="built_in">hash</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;()((<span class="type">long</span> <span class="type">long</span>)i.first) ^ tr1::<span class="built_in">hash</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;()((<span class="type">long</span> <span class="type">long</span>)(i.first &gt;&gt; <span class="number">64</span>)) ^ tr1::<span class="built_in">hash</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;()((<span class="type">long</span> <span class="type">long</span>)i.second) ^ tr1::<span class="built_in">hash</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;()((<span class="type">long</span> <span class="type">long</span>)(i.second &gt;&gt; <span class="number">64</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">__uint128_t</span> <span class="title">rand128</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">rand</span>() | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">32</span>) | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">64</span>) | ((<span class="type">__uint128_t</span>)<span class="built_in">rand</span>() &lt;&lt; <span class="number">96</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10000</span>; i++)</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">1</span>; n &lt;= <span class="number">1e6</span>; n *= <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">1</span>; m &lt;= <span class="number">1e6</span>; m *= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            unordered_map&lt;pair&lt;<span class="type">__uint128_t</span>, <span class="type">__uint128_t</span>&gt;, <span class="type">int</span>, hashfunc&gt; M;</span><br><span class="line">            <span class="built_in">srand</span>(<span class="number">233</span>);</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                M.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand128</span>(), <span class="built_in">rand128</span>()), <span class="built_in">rand</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Writing spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">            start = <span class="built_in">clock</span>();</span><br><span class="line">            <span class="type">int</span> temp;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">                M.<span class="built_in">find</span>(<span class="built_in">make_pair</span>(<span class="built_in">rand128</span>(), <span class="built_in">rand128</span>()));</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|Reading spends |&quot;</span> &lt;&lt; <span class="built_in">clock</span>() - start &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; n &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; m &lt;&lt; <span class="string">&#x27;|&#x27;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>耗时(微秒)</th><th>写入次数</th><th>读取次数</th></tr></thead><tbody><tr><td>Writing spends</td><td>21</td><td>1</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1</td><td>1</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Reading spends</td><td>1</td><td>1</td><td>10</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>1</td><td>100</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>1000</td></tr><tr><td>Reading spends</td><td>76</td><td>1</td><td>1000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>10000</td></tr><tr><td>Reading spends</td><td>744</td><td>1</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>1</td><td>100000</td></tr><tr><td>Reading spends</td><td>7466</td><td>1</td><td>100000</td></tr><tr><td>Writing spends</td><td>2</td><td>1</td><td>1000000</td></tr><tr><td>Reading spends</td><td>74453</td><td>1</td><td>1000000</td></tr><tr><td>Writing spends</td><td>3</td><td>10</td><td>1</td></tr><tr><td>Reading spends</td><td>0</td><td>10</td><td>1</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>10</td><td>10</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>10</td><td>100</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>1000</td></tr><tr><td>Reading spends</td><td>85</td><td>10</td><td>1000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>10000</td></tr><tr><td>Reading spends</td><td>836</td><td>10</td><td>10000</td></tr><tr><td>Writing spends</td><td>1</td><td>10</td><td>100000</td></tr><tr><td>Reading spends</td><td>8370</td><td>10</td><td>100000</td></tr><tr><td>Writing spends</td><td>2</td><td>10</td><td>1000000</td></tr><tr><td>Reading spends</td><td>84176</td><td>10</td><td>1000000</td></tr><tr><td>Writing spends</td><td>27</td><td>100</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100</td><td>1</td></tr><tr><td>Writing spends</td><td>17</td><td>100</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>100</td><td>10</td></tr><tr><td>Writing spends</td><td>15</td><td>100</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>100</td><td>100</td></tr><tr><td>Writing spends</td><td>14</td><td>100</td><td>1000</td></tr><tr><td>Reading spends</td><td>83</td><td>100</td><td>1000</td></tr><tr><td>Writing spends</td><td>14</td><td>100</td><td>10000</td></tr><tr><td>Reading spends</td><td>825</td><td>100</td><td>10000</td></tr><tr><td>Writing spends</td><td>15</td><td>100</td><td>100000</td></tr><tr><td>Reading spends</td><td>8127</td><td>100</td><td>100000</td></tr><tr><td>Writing spends</td><td>20</td><td>100</td><td>1000000</td></tr><tr><td>Reading spends</td><td>81937</td><td>100</td><td>1000000</td></tr><tr><td>Writing spends</td><td>211</td><td>1000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>1000</td><td>1</td></tr><tr><td>Writing spends</td><td>164</td><td>1000</td><td>10</td></tr><tr><td>Reading spends</td><td>2</td><td>1000</td><td>10</td></tr><tr><td>Writing spends</td><td>143</td><td>1000</td><td>100</td></tr><tr><td>Reading spends</td><td>9</td><td>1000</td><td>100</td></tr><tr><td>Writing spends</td><td>160</td><td>1000</td><td>1000</td></tr><tr><td>Reading spends</td><td>84</td><td>1000</td><td>1000</td></tr><tr><td>Writing spends</td><td>144</td><td>1000</td><td>10000</td></tr><tr><td>Reading spends</td><td>839</td><td>1000</td><td>10000</td></tr><tr><td>Writing spends</td><td>161</td><td>1000</td><td>100000</td></tr><tr><td>Reading spends</td><td>8344</td><td>1000</td><td>100000</td></tr><tr><td>Writing spends</td><td>161</td><td>1000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>84518</td><td>1000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>2609</td><td>10000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>10000</td><td>1</td></tr><tr><td>Writing spends</td><td>2341</td><td>10000</td><td>10</td></tr><tr><td>Reading spends</td><td>8</td><td>10000</td><td>10</td></tr><tr><td>Writing spends</td><td>1959</td><td>10000</td><td>100</td></tr><tr><td>Reading spends</td><td>18</td><td>10000</td><td>100</td></tr><tr><td>Writing spends</td><td>1548</td><td>10000</td><td>1000</td></tr><tr><td>Reading spends</td><td>193</td><td>10000</td><td>1000</td></tr><tr><td>Writing spends</td><td>2139</td><td>10000</td><td>10000</td></tr><tr><td>Reading spends</td><td>1716</td><td>10000</td><td>10000</td></tr><tr><td>Writing spends</td><td>1929</td><td>10000</td><td>100000</td></tr><tr><td>Reading spends</td><td>14391</td><td>10000</td><td>100000</td></tr><tr><td>Writing spends</td><td>1573</td><td>10000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>128671</td><td>10000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>37911</td><td>100000</td><td>1</td></tr><tr><td>Reading spends</td><td>1</td><td>100000</td><td>1</td></tr><tr><td>Writing spends</td><td>64046</td><td>100000</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>100000</td><td>10</td></tr><tr><td>Writing spends</td><td>29753</td><td>100000</td><td>100</td></tr><tr><td>Reading spends</td><td>18</td><td>100000</td><td>100</td></tr><tr><td>Writing spends</td><td>24535</td><td>100000</td><td>1000</td></tr><tr><td>Reading spends</td><td>211</td><td>100000</td><td>1000</td></tr><tr><td>Writing spends</td><td>34458</td><td>100000</td><td>10000</td></tr><tr><td>Reading spends</td><td>1982</td><td>100000</td><td>10000</td></tr><tr><td>Writing spends</td><td>41840</td><td>100000</td><td>100000</td></tr><tr><td>Reading spends</td><td>30702</td><td>100000</td><td>100000</td></tr><tr><td>Writing spends</td><td>44858</td><td>100000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>195389</td><td>100000</td><td>1000000</td></tr><tr><td>Writing spends</td><td>426814</td><td>1000000</td><td>1</td></tr><tr><td>Reading spends</td><td>2</td><td>1000000</td><td>1</td></tr><tr><td>Writing spends</td><td>637874</td><td>1000000</td><td>10</td></tr><tr><td>Reading spends</td><td>3</td><td>1000000</td><td>10</td></tr><tr><td>Writing spends</td><td>405023</td><td>1000000</td><td>100</td></tr><tr><td>Reading spends</td><td>28</td><td>1000000</td><td>100</td></tr><tr><td>Writing spends</td><td>388910</td><td>1000000</td><td>1000</td></tr><tr><td>Reading spends</td><td>301</td><td>1000000</td><td>1000</td></tr><tr><td>Writing spends</td><td>402672</td><td>1000000</td><td>10000</td></tr><tr><td>Reading spends</td><td>2515</td><td>1000000</td><td>10000</td></tr><tr><td>Writing spends</td><td>393968</td><td>1000000</td><td>100000</td></tr><tr><td>Reading spends</td><td>29590</td><td>1000000</td><td>100000</td></tr><tr><td>Writing spends</td><td>395403</td><td>1000000</td><td>1000000</td></tr><tr><td>Reading spends</td><td>250795</td><td>1000000</td><td>1000000</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法测试 </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简洁，快速的bv号转av号 c++实现</title>
      <link href="/2024/03/25/%E7%AE%80%E6%B4%81%EF%BC%8C%E5%BF%AB%E9%80%9F%E7%9A%84bv%E5%8F%B7%E8%BD%ACav%E5%8F%B7-c-%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/03/25/%E7%AE%80%E6%B4%81%EF%BC%8C%E5%BF%AB%E9%80%9F%E7%9A%84bv%E5%8F%B7%E8%BD%ACav%E5%8F%B7-c-%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>加了一部分预处理，变得更高效了<br>继承自<a href="https://blog.csdn.net/baidu_38494049/article/details/118789487">朋友</a>这里</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> map[<span class="number">58</span>] =</span><br><span class="line">    &#123;<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;F&#x27;</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numlist[<span class="number">10</span>] = &#123;<span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> power[<span class="number">10</span>] = &#123;<span class="number">1LLU</span>, <span class="number">58LLU</span>, <span class="number">3364LLU</span>, <span class="number">195112LLU</span>, <span class="number">11316496LLU</span>, <span class="number">656356768LLU</span>, <span class="number">38068692544LLU</span>, <span class="number">2207984167552LLU</span>, <span class="number">128063081718016LLU</span>, <span class="number">7427658739644928LLU</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string bv;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;请输入:&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cin &gt;&gt; bv;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">58</span>; j++)</span><br><span class="line">            <span class="keyword">if</span> (map[j] == bv[i])</span><br><span class="line">                sum += j * power[numlist[i]];</span><br><span class="line">    sum -= <span class="number">100618342136696320LLU</span>;</span><br><span class="line">    sum ^= <span class="number">177451812LLU</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;结果是&quot;</span> &lt;&lt; sum &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++利用模板在Windows上快速调用DLL函数</title>
      <link href="/2024/03/25/C-%E5%88%A9%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%9C%A8Windows%E4%B8%8A%E5%BF%AB%E9%80%9F%E8%B0%83%E7%94%A8DLL%E5%87%BD%E6%95%B0/"/>
      <url>/2024/03/25/C-%E5%88%A9%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%9C%A8Windows%E4%B8%8A%E5%BF%AB%E9%80%9F%E8%B0%83%E7%94%A8DLL%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>更新日志 —————————<br>2021&#x2F;08&#x2F;01 更新V2.2 增加 GetHmodule 函数 - 允许用户获取HMODULE以验证加载DLL是否成功。<br>2021&#x2F;08&#x2F;03 更新V2.3 增加 GetProcAddress_XXXX 函数 - 允许用户快捷地、在无需显式类型转换的情况下获取某个DLL函数的地址，以便为单个函数的频繁调用节省时间和代码，提高程序效率。</p></blockquote><p>一直觉得用winapi动态调用dll很麻烦，所以干脆利用c++的模板函数等功能，写了一个类，用以快速调用DLL函数、快速获取函数地址。</p><p>　　此类的代码都在一个头文件中。当前版本有三大功能：调用DLL函数、快捷获取DLL函数地址、根据原函数信息生成C++方式修饰的函数名（即用C++方式导出到DLL中的函数名，类似这种：?XXX@YAHHJ@Z）。第二个功能尚不完善，目前不支持类成员函数名的生成、不支持参数中有结构体(struct)、枚举(enum）、引用（reference）（只是不支持生成名字，但支持调用，可以用dumpbin工具可获取dll中的函数列表）。</p><p>　　头文件完整代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************</span></span><br><span class="line"><span class="comment">*  Fast Dll Runner V2.3 for CPP11+  *</span></span><br><span class="line"><span class="comment">*         Author: szx0427           *</span></span><br><span class="line"><span class="comment">*         Date: 2021/08/03          *</span></span><br><span class="line"><span class="comment">************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#include &quot;pch.h&quot;    /* Uncomment this line if your project has a pch.h (VS2017+) */</span></span><br><span class="line"><span class="comment">//#include &quot;stdafx.h&quot; /* Uncomment this line if your project has a stdafx.h (Old version) */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSzxRunDll2</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>: <span class="comment">// Public data types</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CallingConventions</span></span><br><span class="line">&#123;</span><br><span class="line">Stdcall,</span><br><span class="line">Cdecl,</span><br><span class="line">Fastcall</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> std::string m_Prefix[<span class="number">3</span>];</span><br><span class="line"><span class="type">static</span> std::map&lt;std::string, std::string&gt; m_map;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _InitMap()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (m_map.<span class="built_in">size</span>() &gt; <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">m_map[<span class="string">&quot;void&quot;</span>] = <span class="string">&quot;X&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;char&quot;</span>] = <span class="string">&quot;D&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;unsigned char&quot;</span>] = <span class="string">&quot;E&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;short&quot;</span>] = <span class="string">&quot;F&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;unsigned short&quot;</span>] = <span class="string">&quot;G&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;int&quot;</span>] = <span class="string">&quot;H&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;unsigned int&quot;</span>] = <span class="string">&quot;I&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;long&quot;</span>] = <span class="string">&quot;J&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;unsigned long&quot;</span>] = <span class="string">&quot;K&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;__int64&quot;</span>] = <span class="string">&quot;_J&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;unsigned __int64&quot;</span>] = <span class="string">&quot;_K&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;float&quot;</span>] = <span class="string">&quot;M&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;double&quot;</span>] = <span class="string">&quot;N&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;bool&quot;</span>] = <span class="string">&quot;_N&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;*&quot;</span>] = <span class="string">&quot;PA&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;const *&quot;</span>] = <span class="string">&quot;PB&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;2 *&quot;</span>] = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">m_map[<span class="string">&quot;2 const *&quot;</span>] = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>: <span class="comment">// Protected fields and methods</span></span><br><span class="line">HMODULE m_hModule;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span>, <span class="keyword">class</span> <span class="title class_">_FxnType</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line">_ReturnType _basicCallDllFunc2(LPCSTR lpFxnName, <span class="type">const</span> _ParamTypes&amp;... args)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(m_hModule);</span><br><span class="line"><span class="built_in">assert</span>(lpFxnName);</span><br><span class="line">_FxnType _Myfxn = (_FxnType)::<span class="built_in">GetProcAddress</span>(m_hModule, lpFxnName);</span><br><span class="line"><span class="built_in">assert</span>(_Myfxn);</span><br><span class="line"><span class="keyword">return</span> _Myfxn(args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>: <span class="comment">// Public methods</span></span><br><span class="line"><span class="built_in">CSzxRunDll2</span>(LPCTSTR lpDllName = <span class="literal">nullptr</span>)</span><br><span class="line">: <span class="built_in">m_hModule</span>(<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (lpDllName)</span><br><span class="line">m_hModule = <span class="built_in">LoadLibrary</span>(lpDllName);</span><br><span class="line">_InitMap();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">CSzxRunDll2</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">UnloadDll</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">UINT <span class="title">LoadDll</span><span class="params">(LPCTSTR lpDllName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(lpDllName);</span><br><span class="line">HMODULE hMod = <span class="built_in">LoadLibrary</span>(lpDllName);</span><br><span class="line"><span class="keyword">if</span> (hMod)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (m_hModule)</span><br><span class="line"><span class="built_in">UnloadDll</span>();</span><br><span class="line">m_hModule = hMod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">GetLastError</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">UINT <span class="title">UnloadDll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">FreeLibrary</span>(m_hModule);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">GetLastError</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">HMODULE <span class="title">GetHmodule</span><span class="params">()</span> <span class="type">const</span> <span class="comment">// ++ v2.2</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> m_hModule; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line">_ReturnType <span class="built_in">CallDllFunc2_stdcall</span>(LPCSTR lpFxnName, <span class="type">const</span> _ParamTypes &amp;..._Params)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _basicCallDllFunc2&lt;_ReturnType, _ReturnType(__stdcall*)(<span class="type">const</span> _ParamTypes ...), _ParamTypes...&gt;</span><br><span class="line">(lpFxnName, _Params...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line">_ReturnType <span class="built_in">CallDllFunc2_cdecl</span>(LPCSTR lpFxnName, <span class="type">const</span> _ParamTypes &amp;..._Params)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _basicCallDllFunc2&lt;_ReturnType, _ReturnType(__cdecl*)(<span class="type">const</span> _ParamTypes ...), _ParamTypes...&gt;</span><br><span class="line">(lpFxnName, _Params...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line">_ReturnType <span class="built_in">CallDllFunc2_fastcall</span>(LPCSTR lpFxnName, <span class="type">const</span> _ParamTypes &amp;..._Params)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _basicCallDllFunc2&lt;_ReturnType, _ReturnType(__fastcall*)(<span class="type">const</span> _ParamTypes ...), _ParamTypes...&gt;</span><br><span class="line">(lpFxnName, _Params...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line">_ReturnType <span class="built_in">CallDllFunc2_thiscall</span>(LPCSTR lpFxnName, <span class="type">const</span> _ParamTypes &amp;..._Params)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _basicCallDllFunc2&lt;_ReturnType, _ReturnType(__thiscall*)(<span class="type">const</span> _ParamTypes ...), _ParamTypes...&gt;</span><br><span class="line">(lpFxnName, _Params...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetProcAddress_X<span class="doctag">XXX:</span> ++v2.3</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">GetProcAddress_stdcall</span>(LPCSTR lpProcName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(m_hModule);</span><br><span class="line"><span class="keyword">return</span> (_ReturnType(__stdcall*)(_ParamTypes...))::<span class="built_in">GetProcAddress</span>(m_hModule, lpProcName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">GetProcAddress_cdecl</span>(LPCSTR lpProcName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(m_hModule);</span><br><span class="line"><span class="keyword">return</span> (_ReturnType(__cdecl*)(_ParamTypes...))::<span class="built_in">GetProcAddress</span>(m_hModule, lpProcName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">GetProcAddress_fastcall</span>(LPCSTR lpProcName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(m_hModule);</span><br><span class="line"><span class="keyword">return</span> (_ReturnType(__fastcall*)(_ParamTypes...))::<span class="built_in">GetProcAddress</span>(m_hModule, lpProcName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">GetProcAddress_thiscall</span>(LPCSTR lpProcName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(m_hModule);</span><br><span class="line"><span class="keyword">return</span> (_ReturnType(__thiscall*)(_ParamTypes...))::<span class="built_in">GetProcAddress</span>(m_hModule, lpProcName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_ReturnType</span> = <span class="type">void</span>, <span class="keyword">class</span>... _ParamTypes&gt;</span><br><span class="line"><span class="type">static</span> std::string <span class="built_in">BuildCppDecoratedName</span>(<span class="type">const</span> std::string&amp; sFxnName, CallingConventions cc = Cdecl)</span><br><span class="line">&#123;</span><br><span class="line">_InitMap();</span><br><span class="line">std::string ret = <span class="string">&quot;?&quot;</span> + sFxnName + m_Prefix[(<span class="type">int</span>)cc];</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* szTypes[] = &#123; <span class="built_in">typeid</span>(_ReturnType).<span class="built_in">name</span>(), <span class="built_in">typeid</span>(_ParamTypes).<span class="built_in">name</span>()... &#125;;</span><br><span class="line"><span class="type">int</span> nCount = <span class="number">1</span> + <span class="keyword">sizeof</span>...(_ParamTypes);</span><br><span class="line">std::string tmp, par;</span><br><span class="line"><span class="type">int</span> pos1, pos2, sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nCount; i++)</span><br><span class="line">&#123;</span><br><span class="line">tmp = szTypes[i];</span><br><span class="line"><span class="comment">// This version doesn&#x27;t support struct/enum/reference</span></span><br><span class="line"><span class="built_in">assert</span>(tmp.<span class="built_in">find</span>(<span class="string">&quot;struct&quot;</span>) == tmp.npos &amp;&amp; tmp.<span class="built_in">find</span>(<span class="string">&quot;enum&quot;</span>) == tmp.npos &amp;&amp; tmp.<span class="built_in">find</span>(<span class="string">&quot;&amp;&quot;</span>) == tmp.npos);</span><br><span class="line"><span class="built_in">assert</span>(tmp.<span class="built_in">find</span>(<span class="string">&#x27;[&#x27;</span>) == tmp.npos); <span class="comment">// Array(x) Pointer(√)</span></span><br><span class="line"><span class="keyword">if</span> ((pos1 = tmp.<span class="built_in">find</span>(<span class="string">&quot; *&quot;</span>)) != tmp.npos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ((pos2 = tmp.<span class="built_in">find</span>(<span class="string">&quot; const *&quot;</span>)) != tmp.npos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i &gt;= <span class="number">1</span> &amp;&amp; tmp == szTypes[i - <span class="number">1</span>])</span><br><span class="line">par += m_map[<span class="string">&quot;2 const *&quot;</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">par += m_map[<span class="string">&quot;const *&quot;</span>] + m_map[tmp.<span class="built_in">substr</span>(<span class="number">0</span>, pos2)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i &gt;= <span class="number">1</span> &amp;&amp; tmp == szTypes[i - <span class="number">1</span>])</span><br><span class="line">par += m_map[<span class="string">&quot;2 *&quot;</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">par += m_map[<span class="string">&quot;*&quot;</span>] + m_map[tmp.<span class="built_in">substr</span>(<span class="number">0</span>, pos1)];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">par += m_map[tmp];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (par.<span class="built_in">length</span>() == <span class="number">1</span>)</span><br><span class="line">par += <span class="string">&quot;XZ&quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">par += <span class="string">&quot;@Z&quot;</span>;</span><br><span class="line">ret += par;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> std::string CSzxRunDll2::m_Prefix[<span class="number">3</span>] = &#123; <span class="string">&quot;@@YG&quot;</span>,<span class="string">&quot;@@YA&quot;</span>,<span class="string">&quot;@@YI&quot;</span> &#125;;</span><br><span class="line">std::map&lt;std::string, std::string&gt; CSzxRunDll2::m_map;</span><br></pre></td></tr></table></figure><p>要使用此类, 只需要引入包含以上代码的头文件.</p><p>其中：</p><ol><li>构造函数和LoadDll函数可以加载一个DLL文件到类中.</li><li>析构函数和UnloadDll函数可以释放当前类中的DLL.</li><li>GetHmodule函数（v2.2）可以获取当前类中的HMODULE，以验证加载DLL的操作是否成功。</li><li>CallDllFunc2_XXXX可以快速调用当前类中DLL中的函数.下划线后面的部分指定了调用约定(stdcall&#x2F;cdecl&#x2F;fastcall&#x2F;thiscall). 这些函数模板的第一个模板参数为返回值类型,可不填,默认为void. 后面的模板参数为dll函数参数类型列表,无需手动填入, 会根据具体函数参数自动识别. 实例化时,函数的第一个参数为DLL函数名称(注意,如果是C++方式导出的函数,需要填入修饰过的名称), 后面的参数是dll函数的参数列表(本函数模板使用了引用,保证不进行多余的数据复制浪费时间,数据直接传递给dll函数). C语言方式导出函数的调用示例:<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CSzxRunDll2 <span class="title">dll</span><span class="params">(TEXT(<span class="string">&quot;user32.dll&quot;</span>))</span></span>;</span><br><span class="line"><span class="type">int</span> nRet = dll.<span class="built_in">CallDllFunc2_stdcall</span>&lt;<span class="type">int</span>&gt;(<span class="string">&quot;MessageBoxA&quot;</span>, <span class="literal">NULL</span>, <span class="string">&quot;Hello World!&quot;</span>, <span class="string">&quot;Title&quot;</span>, MB_ICONINFORMATION);</span><br></pre></td></tr></table></figure>GetProcAddress_XXXX可以快速获取当前类中某个DLL函数的地址。下划线后面的部分指定了调用约定(stdcall&#x2F;cdecl&#x2F;fastcall&#x2F;thiscall). 这些函数模板的第一个模板参数为返回值类型，默认为void。后面的模板参数是函数从参数类型列表，如函数没有参数，则无需填写。实例化时，第一个函数参数时DLL函数的名称。该函数的返回值类型会自动根据模板参数计算，无需手动填写，代码中使用auto即可。下面是一个示例：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CSzxRunDll2 <span class="title">dll</span><span class="params">(TEXT(<span class="string">&quot;user32.dll&quot;</span>))</span></span>;</span><br><span class="line"><span class="keyword">auto</span> MyMessageBox = dll.<span class="built_in">GetProcAddress_stdcall</span>&lt;<span class="type">int</span>, HWND, LPCSTR, LPCSTR, UINT&gt;(<span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line"><span class="built_in">MyMessageBox</span>(<span class="literal">NULL</span>, <span class="string">&quot;第一次使用MessageBox！&quot;</span>, <span class="string">&quot;11111&quot;</span>, MB_OK);</span><br><span class="line"><span class="built_in">MyMessageBox</span>(<span class="literal">NULL</span>, <span class="string">&quot;第二次使用MessageBox！&quot;</span>, <span class="string">&quot;22222&quot;</span>, MB_ICONASTERISK);</span><br></pre></td></tr></table></figure><blockquote><p>使用GetProcAddress_XXXX函数时请注意：由于本类的析构函数中会自动执行FreeLibrary函数释放DLL库，在一个类对象被析构后，使用它获取的函数地址将可能失效（大概率会失效）。所以，请保证一个对象获取的函数地址不会在它被析构后调用。下面是一个错误示范：</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Fun1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="function">CSzxRunDll2 <span class="title">dll</span><span class="params">(TEXT(<span class="string">&quot;XXX.dll&quot;</span>))</span></span>; <span class="keyword">return</span> dll.<span class="built_in">GetProcAddress_cdecl</span>&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;(<span class="string">&quot;Add&quot;</span>); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> fun = <span class="built_in">Fun1</span>();</span><br><span class="line"><span class="type">int</span> n = <span class="built_in">fun</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 可能崩溃</span></span><br><span class="line">std::cout &lt;&lt; n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此例中，Fun1函数中虽获取了Add函数的地址，但在Fun1函数返回之前，对象“dll”已执行了析构函数，它构造时加载的“XXX.dll”已被析构函数中执行的FreeLibrary释放，导致原有的函数地址失效。之所以说“可能崩溃”，是因为如果在一个类对象加载DLL前，就已加载过该DLL，则使用一次FreeLibrary不会将其释放，只会减少引用次数，所以原函数地址依然有效。如果要在多个函数内调用一个函数地址，请将CSzxRunDll2对象定义为全局变量或静态变量。</p></blockquote></li></ol><p>BuildCppDecoratedName函数BuildCppDecoratedName模板为静态成员函数模板, 作用是根据原函数的信息生成C++方式修饰过的函数名称. 有两种调用方法:</p><ol><li>通过对象调用: 类对象 . BuildCppDecoratedName&lt;…&gt;(…);</li><li>直接调用: CSzxRunDll2::BuildCppDecoratedName&lt;…&gt;(…);</li></ol><p>第一个模板参数为dll函数返回值类型, 后面的是dll函数参数类型列表. 实例化时, 第一个函数参数是dll函数名称, 第二个参数是调用约定, 可以为以下三个值中任意一个: CSzxRunDll2::Stdcall &#x2F; CSzxRunDll2::Cdecl &#x2F; CSzxRunDll2::Fastcall, 可不填, 默认为cdecl. 以下是一个使用该函数调用C++方式导出函数的例子:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CSzxRunDll2 <span class="title">dll</span><span class="params">(TEXT(<span class="string">&quot;math.dll&quot;</span>))</span></span>;</span><br><span class="line"><span class="comment">// 要调用的函数原型: long __cdecl Add(int a, int b);</span></span><br><span class="line">std::string str = dll.<span class="built_in">BuildCppDecoratedName</span>&lt;<span class="type">long</span>, <span class="type">int</span>, <span class="type">int</span>&gt;(<span class="string">&quot;Add&quot;</span>, CSzxRunDll2::Cdecl);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; dll.<span class="built_in">CallDllFunc2_cdecl</span>&lt;<span class="type">long</span>&gt;(str.<span class="built_in">c_str</span>(), <span class="number">111</span>, <span class="number">22</span>);</span><br></pre></td></tr></table></figure><h2 id="已知问题-1-BuildCppDecoratedName不支持DLL函数参数中有结构体-struct-、枚举-enum）、引用（reference）-2-在使用CallDllFunc2-XXX函数调用参数列表中带有引用-reference-的DLL函数时-若按上述的常规方式会出现错误-必须使用结构体传参-如下所示"><a href="#已知问题-1-BuildCppDecoratedName不支持DLL函数参数中有结构体-struct-、枚举-enum）、引用（reference）-2-在使用CallDllFunc2-XXX函数调用参数列表中带有引用-reference-的DLL函数时-若按上述的常规方式会出现错误-必须使用结构体传参-如下所示" class="headerlink" title="已知问题:1. BuildCppDecoratedName不支持DLL函数参数中有结构体(struct)、枚举(enum）、引用（reference）.2. 在使用CallDllFunc2_XXX函数调用参数列表中带有引用(reference)的DLL函数时, 若按上述的常规方式会出现错误, 必须使用结构体传参, 如下所示:"></a>已知问题:<br>1. BuildCppDecoratedName不支持DLL函数参数中有结构体(struct)、枚举(enum）、引用（reference）.<br>2. 在使用CallDllFunc2_XXX函数调用参数列表中带有引用(reference)的DLL函数时, 若按上述的常规方式会出现错误, 必须使用结构体传参, 如下所示:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要调用的函数原型: void Add(const int &amp;a, const int &amp;b, long &amp;result);</span></span><br><span class="line"><span class="type">int</span> re;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyStruct</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; a;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; b;</span><br><span class="line"><span class="type">int</span>&amp; result;</span><br><span class="line">&#125; param = &#123; <span class="number">222</span>, <span class="number">3000</span>, re &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* name = <span class="string">&quot;?Add@@YAXABH0AAJ@Z&quot;</span>; <span class="comment">// 修饰过的函数名, 带引用的目前本类不支持生成，可使用dumpbin工具生成</span></span><br><span class="line">dll.<span class="built_in">CallDllFunc2_cdecl</span>(name, param);</span><br></pre></td></tr></table></figure></h2><p>此类还在继续开发完善中. 若有任何问题, 欢迎指正.</p><p>&hearts;<strong>版权说明</strong><br>本文由szx0427撰写,由Icys获得授权后在CnBlogs代为其发布发布。</p><p><a href="https://zhuanlan.zhihu.com/p/394908594">知乎通道</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> 模板 </tag>
            
            <tag> DLL </tag>
            
            <tag> 动态调用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新版本NOI Linux发布,支持VSCode,Code::Blocks开发C++!!!,内附下载地址。</title>
      <link href="/2024/03/24/%E6%96%B0%E7%89%88%E6%9C%ACNOI-Linux%E5%8F%91%E5%B8%83-%E6%94%AF%E6%8C%81VSCode-Code-Blocks%E5%BC%80%E5%8F%91C-%E5%86%85%E9%99%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82/"/>
      <url>/2024/03/24/%E6%96%B0%E7%89%88%E6%9C%ACNOI-Linux%E5%8F%91%E5%B8%83-%E6%94%AF%E6%8C%81VSCode-Code-Blocks%E5%BC%80%E5%8F%91C-%E5%86%85%E9%99%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>注意VSCODE 虽然有C艹插件,但是在第一次编译的时候必须要有网络,否则用不了</strong><br>  <del>我推荐还是用CODE::BLOCKS</del><br>  作者10月8日补充</p></blockquote><p>有些省份已经开始强制在NOIP的比赛里使用NOI Linux,而今年NOI Linux2.0发布,并在9月1日正式开始使用。</p><p>NOI Linux 2.0 有了如下更新</p><ol><li><p>内核换为Ubuntu20.04</p></li><li><p>由 32Bit 系统换为了 64Bit 系统</p></li><li><p>移除了GUIDE,新增了如Code::Blocks,VSCode等工具</p></li><li><p>增加了零零碎碎的工具</p></li><li><p>G++升级为G++9,默认支持C++14</p></li></ol><p>下面是NOI Linux程序列表</p><table><thead><tr><th>类别</th><th>软件&#x2F;模块</th><th>版本</th><th>备注说明</th></tr></thead><tbody><tr><td>系统</td><td>Kernel</td><td>5.4.0-42-generic</td><td>64位</td></tr><tr><td>语言环境</td><td>GCC</td><td>9.3.0</td><td>C编译器</td></tr><tr><td></td><td>G++</td><td>9.3.0</td><td>C++编译器</td></tr><tr><td></td><td>FPC</td><td>3.0.4</td><td>Pascal编译器</td></tr><tr><td></td><td>Python</td><td>2.7 &amp; 3.8</td><td>非竞赛语言</td></tr><tr><td>调试工具</td><td>GDB</td><td>9.1</td><td></td></tr><tr><td></td><td>DDD</td><td>3.3.12</td><td></td></tr><tr><td>集成开发环境</td><td>Code::Blocks</td><td>20.03</td><td>C&#x2F;C++集成开发环境</td></tr><tr><td></td><td>Lazarus</td><td>2.0.6</td><td>Pascal集成开发环境</td></tr><tr><td></td><td>Geany</td><td>1.36</td><td>C&#x2F;C++&#x2F;Pascal（轻量级）集成开发环境</td></tr><tr><td>文本编辑工具</td><td>VS Code</td><td>1.54.3</td><td></td></tr><tr><td></td><td>Emacs</td><td>26.3</td><td></td></tr><tr><td></td><td>Gedit</td><td>3.36.2</td><td></td></tr><tr><td></td><td>Vim</td><td>8.1</td><td></td></tr><tr><td></td><td>Joe</td><td>4.6</td><td></td></tr><tr><td></td><td>nano</td><td>4.8</td><td></td></tr><tr><td></td><td>sublime text</td><td>3.2.2</td><td></td></tr><tr><td>其他软件</td><td>Firefox</td><td>79.0</td><td>网页浏览器</td></tr><tr><td></td><td>Midnight Commander (mc)</td><td>4.8.24</td><td>终端</td></tr><tr><td></td><td>XTerm (UXTerm)</td><td>3.5.3</td><td>终端</td></tr><tr><td></td><td>Arbiter-local</td><td>1.02</td><td>程序评测工具单机版</td></tr></tbody></table><p>特别说明:虽然VSCode作为文本编辑器出场,但是笔者拿到的NOI Linux 中的VSCode集成了C++ 插件</p><p>下载地址</p><p><a href="https://noiresources.ccf.org.cn/ubuntu-noi-v2.0.iso"><span>在线下载</span><span>在线下载</span></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> OI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>来自上个世纪的传奇 q_math.c 源码展示</title>
      <link href="/2024/03/24/%E6%9D%A5%E8%87%AA%E4%B8%8A%E4%B8%AA%E4%B8%96%E7%BA%AA%E7%9A%84%E4%BC%A0%E5%A5%87-q-math-c-%E6%BA%90%E7%A0%81%E5%B1%95%E7%A4%BA/"/>
      <url>/2024/03/24/%E6%9D%A5%E8%87%AA%E4%B8%8A%E4%B8%AA%E4%B8%96%E7%BA%AA%E7%9A%84%E4%BC%A0%E5%A5%87-q-math-c-%E6%BA%90%E7%A0%81%E5%B1%95%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<p>经典的<strong>快速平方根倒数算法</strong>就在其中<br>此算法首先接收一个32位带符浮点数，然后将之作为一个32位整数看待，将其右移一次（取半），并用十六进制“魔术数字”0x5f3759df减之，如此即可得对输入的浮点数的平方根倒数的首次近似值；而后重新将其作为原来的浮点数，以牛顿迭代法反复迭代，以求出更精确的近似值，直至求出符合精确度要求的近似值。在计算浮点数的平方根倒数的同一精度的近似值时，此算法比直接使用浮点数除法要快四倍。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">===========================================================================</span></span><br><span class="line"><span class="comment">Copyright (C) 1999-2005 Id Software, Inc.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">This file is part of Quake III Arena source code.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Quake III Arena source code is free software; you can redistribute it</span></span><br><span class="line"><span class="comment">and/or modify it under the terms of the GNU General Public License as</span></span><br><span class="line"><span class="comment">published by the Free Software Foundation; either version 2 of the License,</span></span><br><span class="line"><span class="comment">or (at your option) any later version.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Quake III Arena source code is distributed in the hope that it will be</span></span><br><span class="line"><span class="comment">useful, but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="comment">GNU General Public License for more details.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">You should have received a copy of the GNU General Public License</span></span><br><span class="line"><span class="comment">along with Foobar; if not, write to the Free Software</span></span><br><span class="line"><span class="comment">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span></span><br><span class="line"><span class="comment">===========================================================================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// q_math.c -- stateless support routines that are included in each code module</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;q_shared.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">vec3_t</span>vec3_origin = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">vec3_t</span>axisDefault[<span class="number">3</span>] = &#123; &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span> &#125;, &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span> &#125;, &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">vec4_t</span>colorBlack= &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorRed= &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorGreen= &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorBlue= &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorYellow= &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorMagenta= &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorCyan= &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorWhite= &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorLtGrey= &#123;<span class="number">0.75</span>, <span class="number">0.75</span>, <span class="number">0.75</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorMdGrey= &#123;<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">vec4_t</span>colorDkGrey= &#123;<span class="number">0.25</span>, <span class="number">0.25</span>, <span class="number">0.25</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">vec4_t</span>g_color_table[<span class="number">8</span>] =</span><br><span class="line">&#123;</span><br><span class="line">&#123;<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#123;<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">vec3_t</span>bytedirs[NUMVERTEXNORMALS] =</span><br><span class="line">&#123;</span><br><span class="line">&#123;<span class="number">-0.525731f</span>, <span class="number">0.000000f</span>, <span class="number">0.850651f</span>&#125;, &#123;<span class="number">-0.442863f</span>, <span class="number">0.238856f</span>, <span class="number">0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.295242f</span>, <span class="number">0.000000f</span>, <span class="number">0.955423f</span>&#125;, &#123;<span class="number">-0.309017f</span>, <span class="number">0.500000f</span>, <span class="number">0.809017f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.162460f</span>, <span class="number">0.262866f</span>, <span class="number">0.951056f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">0.000000f</span>, <span class="number">1.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">0.850651f</span>, <span class="number">0.525731f</span>&#125;, &#123;<span class="number">-0.147621f</span>, <span class="number">0.716567f</span>, <span class="number">0.681718f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.147621f</span>, <span class="number">0.716567f</span>, <span class="number">0.681718f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">0.525731f</span>, <span class="number">0.850651f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.309017f</span>, <span class="number">0.500000f</span>, <span class="number">0.809017f</span>&#125;, &#123;<span class="number">0.525731f</span>, <span class="number">0.000000f</span>, <span class="number">0.850651f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.295242f</span>, <span class="number">0.000000f</span>, <span class="number">0.955423f</span>&#125;, &#123;<span class="number">0.442863f</span>, <span class="number">0.238856f</span>, <span class="number">0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.162460f</span>, <span class="number">0.262866f</span>, <span class="number">0.951056f</span>&#125;, &#123;<span class="number">-0.681718f</span>, <span class="number">0.147621f</span>, <span class="number">0.716567f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.809017f</span>, <span class="number">0.309017f</span>, <span class="number">0.500000f</span>&#125;,&#123;<span class="number">-0.587785f</span>, <span class="number">0.425325f</span>, <span class="number">0.688191f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.850651f</span>, <span class="number">0.525731f</span>, <span class="number">0.000000f</span>&#125;,&#123;<span class="number">-0.864188f</span>, <span class="number">0.442863f</span>, <span class="number">0.238856f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.716567f</span>, <span class="number">0.681718f</span>, <span class="number">0.147621f</span>&#125;,&#123;<span class="number">-0.688191f</span>, <span class="number">0.587785f</span>, <span class="number">0.425325f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.500000f</span>, <span class="number">0.809017f</span>, <span class="number">0.309017f</span>&#125;, &#123;<span class="number">-0.238856f</span>, <span class="number">0.864188f</span>, <span class="number">0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.425325f</span>, <span class="number">0.688191f</span>, <span class="number">0.587785f</span>&#125;, &#123;<span class="number">-0.716567f</span>, <span class="number">0.681718f</span>, <span class="number">-0.147621f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.500000f</span>, <span class="number">0.809017f</span>, <span class="number">-0.309017f</span>&#125;, &#123;<span class="number">-0.525731f</span>, <span class="number">0.850651f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">0.850651f</span>, <span class="number">-0.525731f</span>&#125;, &#123;<span class="number">-0.238856f</span>, <span class="number">0.864188f</span>, <span class="number">-0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">0.955423f</span>, <span class="number">-0.295242f</span>&#125;, &#123;<span class="number">-0.262866f</span>, <span class="number">0.951056f</span>, <span class="number">-0.162460f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">1.000000f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">0.955423f</span>, <span class="number">0.295242f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.262866f</span>, <span class="number">0.951056f</span>, <span class="number">0.162460f</span>&#125;, &#123;<span class="number">0.238856f</span>, <span class="number">0.864188f</span>, <span class="number">0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.262866f</span>, <span class="number">0.951056f</span>, <span class="number">0.162460f</span>&#125;, &#123;<span class="number">0.500000f</span>, <span class="number">0.809017f</span>, <span class="number">0.309017f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.238856f</span>, <span class="number">0.864188f</span>, <span class="number">-0.442863f</span>&#125;,&#123;<span class="number">0.262866f</span>, <span class="number">0.951056f</span>, <span class="number">-0.162460f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.500000f</span>, <span class="number">0.809017f</span>, <span class="number">-0.309017f</span>&#125;,&#123;<span class="number">0.850651f</span>, <span class="number">0.525731f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.716567f</span>, <span class="number">0.681718f</span>, <span class="number">0.147621f</span>&#125;, &#123;<span class="number">0.716567f</span>, <span class="number">0.681718f</span>, <span class="number">-0.147621f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.525731f</span>, <span class="number">0.850651f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">0.425325f</span>, <span class="number">0.688191f</span>, <span class="number">0.587785f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.864188f</span>, <span class="number">0.442863f</span>, <span class="number">0.238856f</span>&#125;, &#123;<span class="number">0.688191f</span>, <span class="number">0.587785f</span>, <span class="number">0.425325f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.809017f</span>, <span class="number">0.309017f</span>, <span class="number">0.500000f</span>&#125;, &#123;<span class="number">0.681718f</span>, <span class="number">0.147621f</span>, <span class="number">0.716567f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.587785f</span>, <span class="number">0.425325f</span>, <span class="number">0.688191f</span>&#125;, &#123;<span class="number">0.955423f</span>, <span class="number">0.295242f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">1.000000f</span>, <span class="number">0.000000f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">0.951056f</span>, <span class="number">0.162460f</span>, <span class="number">0.262866f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.850651f</span>, <span class="number">-0.525731f</span>, <span class="number">0.000000f</span>&#125;,&#123;<span class="number">0.955423f</span>, <span class="number">-0.295242f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.864188f</span>, <span class="number">-0.442863f</span>, <span class="number">0.238856f</span>&#125;, &#123;<span class="number">0.951056f</span>, <span class="number">-0.162460f</span>, <span class="number">0.262866f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.809017f</span>, <span class="number">-0.309017f</span>, <span class="number">0.500000f</span>&#125;, &#123;<span class="number">0.681718f</span>, <span class="number">-0.147621f</span>, <span class="number">0.716567f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.850651f</span>, <span class="number">0.000000f</span>, <span class="number">0.525731f</span>&#125;, &#123;<span class="number">0.864188f</span>, <span class="number">0.442863f</span>, <span class="number">-0.238856f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.809017f</span>, <span class="number">0.309017f</span>, <span class="number">-0.500000f</span>&#125;, &#123;<span class="number">0.951056f</span>, <span class="number">0.162460f</span>, <span class="number">-0.262866f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.525731f</span>, <span class="number">0.000000f</span>, <span class="number">-0.850651f</span>&#125;, &#123;<span class="number">0.681718f</span>, <span class="number">0.147621f</span>, <span class="number">-0.716567f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.681718f</span>, <span class="number">-0.147621f</span>, <span class="number">-0.716567f</span>&#125;,&#123;<span class="number">0.850651f</span>, <span class="number">0.000000f</span>, <span class="number">-0.525731f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.809017f</span>, <span class="number">-0.309017f</span>, <span class="number">-0.500000f</span>&#125;, &#123;<span class="number">0.864188f</span>, <span class="number">-0.442863f</span>, <span class="number">-0.238856f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.951056f</span>, <span class="number">-0.162460f</span>, <span class="number">-0.262866f</span>&#125;, &#123;<span class="number">0.147621f</span>, <span class="number">0.716567f</span>, <span class="number">-0.681718f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.309017f</span>, <span class="number">0.500000f</span>, <span class="number">-0.809017f</span>&#125;, &#123;<span class="number">0.425325f</span>, <span class="number">0.688191f</span>, <span class="number">-0.587785f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.442863f</span>, <span class="number">0.238856f</span>, <span class="number">-0.864188f</span>&#125;, &#123;<span class="number">0.587785f</span>, <span class="number">0.425325f</span>, <span class="number">-0.688191f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.688191f</span>, <span class="number">0.587785f</span>, <span class="number">-0.425325f</span>&#125;, &#123;<span class="number">-0.147621f</span>, <span class="number">0.716567f</span>, <span class="number">-0.681718f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.309017f</span>, <span class="number">0.500000f</span>, <span class="number">-0.809017f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">0.525731f</span>, <span class="number">-0.850651f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.525731f</span>, <span class="number">0.000000f</span>, <span class="number">-0.850651f</span>&#125;, &#123;<span class="number">-0.442863f</span>, <span class="number">0.238856f</span>, <span class="number">-0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.295242f</span>, <span class="number">0.000000f</span>, <span class="number">-0.955423f</span>&#125;, &#123;<span class="number">-0.162460f</span>, <span class="number">0.262866f</span>, <span class="number">-0.951056f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">0.000000f</span>, <span class="number">-1.000000f</span>&#125;, &#123;<span class="number">0.295242f</span>, <span class="number">0.000000f</span>, <span class="number">-0.955423f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.162460f</span>, <span class="number">0.262866f</span>, <span class="number">-0.951056f</span>&#125;, &#123;<span class="number">-0.442863f</span>, <span class="number">-0.238856f</span>, <span class="number">-0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.309017f</span>, <span class="number">-0.500000f</span>, <span class="number">-0.809017f</span>&#125;, &#123;<span class="number">-0.162460f</span>, <span class="number">-0.262866f</span>, <span class="number">-0.951056f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">-0.850651f</span>, <span class="number">-0.525731f</span>&#125;, &#123;<span class="number">-0.147621f</span>, <span class="number">-0.716567f</span>, <span class="number">-0.681718f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.147621f</span>, <span class="number">-0.716567f</span>, <span class="number">-0.681718f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">-0.525731f</span>, <span class="number">-0.850651f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.309017f</span>, <span class="number">-0.500000f</span>, <span class="number">-0.809017f</span>&#125;, &#123;<span class="number">0.442863f</span>, <span class="number">-0.238856f</span>, <span class="number">-0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.162460f</span>, <span class="number">-0.262866f</span>, <span class="number">-0.951056f</span>&#125;, &#123;<span class="number">0.238856f</span>, <span class="number">-0.864188f</span>, <span class="number">-0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.500000f</span>, <span class="number">-0.809017f</span>, <span class="number">-0.309017f</span>&#125;, &#123;<span class="number">0.425325f</span>, <span class="number">-0.688191f</span>, <span class="number">-0.587785f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.716567f</span>, <span class="number">-0.681718f</span>, <span class="number">-0.147621f</span>&#125;, &#123;<span class="number">0.688191f</span>, <span class="number">-0.587785f</span>, <span class="number">-0.425325f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.587785f</span>, <span class="number">-0.425325f</span>, <span class="number">-0.688191f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">-0.955423f</span>, <span class="number">-0.295242f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">-1.000000f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">0.262866f</span>, <span class="number">-0.951056f</span>, <span class="number">-0.162460f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.000000f</span>, <span class="number">-0.850651f</span>, <span class="number">0.525731f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">-0.955423f</span>, <span class="number">0.295242f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.238856f</span>, <span class="number">-0.864188f</span>, <span class="number">0.442863f</span>&#125;, &#123;<span class="number">0.262866f</span>, <span class="number">-0.951056f</span>, <span class="number">0.162460f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.500000f</span>, <span class="number">-0.809017f</span>, <span class="number">0.309017f</span>&#125;, &#123;<span class="number">0.716567f</span>, <span class="number">-0.681718f</span>, <span class="number">0.147621f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.525731f</span>, <span class="number">-0.850651f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">-0.238856f</span>, <span class="number">-0.864188f</span>, <span class="number">-0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.500000f</span>, <span class="number">-0.809017f</span>, <span class="number">-0.309017f</span>&#125;, &#123;<span class="number">-0.262866f</span>, <span class="number">-0.951056f</span>, <span class="number">-0.162460f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.850651f</span>, <span class="number">-0.525731f</span>, <span class="number">0.000000f</span>&#125;, &#123;<span class="number">-0.716567f</span>, <span class="number">-0.681718f</span>, <span class="number">-0.147621f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.716567f</span>, <span class="number">-0.681718f</span>, <span class="number">0.147621f</span>&#125;, &#123;<span class="number">-0.525731f</span>, <span class="number">-0.850651f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.500000f</span>, <span class="number">-0.809017f</span>, <span class="number">0.309017f</span>&#125;, &#123;<span class="number">-0.238856f</span>, <span class="number">-0.864188f</span>, <span class="number">0.442863f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.262866f</span>, <span class="number">-0.951056f</span>, <span class="number">0.162460f</span>&#125;, &#123;<span class="number">-0.864188f</span>, <span class="number">-0.442863f</span>, <span class="number">0.238856f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.809017f</span>, <span class="number">-0.309017f</span>, <span class="number">0.500000f</span>&#125;, &#123;<span class="number">-0.688191f</span>, <span class="number">-0.587785f</span>, <span class="number">0.425325f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.681718f</span>, <span class="number">-0.147621f</span>, <span class="number">0.716567f</span>&#125;, &#123;<span class="number">-0.442863f</span>, <span class="number">-0.238856f</span>, <span class="number">0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.587785f</span>, <span class="number">-0.425325f</span>, <span class="number">0.688191f</span>&#125;, &#123;<span class="number">-0.309017f</span>, <span class="number">-0.500000f</span>, <span class="number">0.809017f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.147621f</span>, <span class="number">-0.716567f</span>, <span class="number">0.681718f</span>&#125;, &#123;<span class="number">-0.425325f</span>, <span class="number">-0.688191f</span>, <span class="number">0.587785f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.162460f</span>, <span class="number">-0.262866f</span>, <span class="number">0.951056f</span>&#125;, &#123;<span class="number">0.442863f</span>, <span class="number">-0.238856f</span>, <span class="number">0.864188f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.162460f</span>, <span class="number">-0.262866f</span>, <span class="number">0.951056f</span>&#125;, &#123;<span class="number">0.309017f</span>, <span class="number">-0.500000f</span>, <span class="number">0.809017f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.147621f</span>, <span class="number">-0.716567f</span>, <span class="number">0.681718f</span>&#125;, &#123;<span class="number">0.000000f</span>, <span class="number">-0.525731f</span>, <span class="number">0.850651f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.425325f</span>, <span class="number">-0.688191f</span>, <span class="number">0.587785f</span>&#125;, &#123;<span class="number">0.587785f</span>, <span class="number">-0.425325f</span>, <span class="number">0.688191f</span>&#125;, </span><br><span class="line">&#123;<span class="number">0.688191f</span>, <span class="number">-0.587785f</span>, <span class="number">0.425325f</span>&#125;, &#123;<span class="number">-0.955423f</span>, <span class="number">0.295242f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.951056f</span>, <span class="number">0.162460f</span>, <span class="number">0.262866f</span>&#125;, &#123;<span class="number">-1.000000f</span>, <span class="number">0.000000f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.850651f</span>, <span class="number">0.000000f</span>, <span class="number">0.525731f</span>&#125;, &#123;<span class="number">-0.955423f</span>, <span class="number">-0.295242f</span>, <span class="number">0.000000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.951056f</span>, <span class="number">-0.162460f</span>, <span class="number">0.262866f</span>&#125;, &#123;<span class="number">-0.864188f</span>, <span class="number">0.442863f</span>, <span class="number">-0.238856f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.951056f</span>, <span class="number">0.162460f</span>, <span class="number">-0.262866f</span>&#125;, &#123;<span class="number">-0.809017f</span>, <span class="number">0.309017f</span>, <span class="number">-0.500000f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.864188f</span>, <span class="number">-0.442863f</span>, <span class="number">-0.238856f</span>&#125;, &#123;<span class="number">-0.951056f</span>, <span class="number">-0.162460f</span>, <span class="number">-0.262866f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.809017f</span>, <span class="number">-0.309017f</span>, <span class="number">-0.500000f</span>&#125;, &#123;<span class="number">-0.681718f</span>, <span class="number">0.147621f</span>, <span class="number">-0.716567f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.681718f</span>, <span class="number">-0.147621f</span>, <span class="number">-0.716567f</span>&#125;, &#123;<span class="number">-0.850651f</span>, <span class="number">0.000000f</span>, <span class="number">-0.525731f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.688191f</span>, <span class="number">0.587785f</span>, <span class="number">-0.425325f</span>&#125;, &#123;<span class="number">-0.587785f</span>, <span class="number">0.425325f</span>, <span class="number">-0.688191f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.425325f</span>, <span class="number">0.688191f</span>, <span class="number">-0.587785f</span>&#125;, &#123;<span class="number">-0.425325f</span>, <span class="number">-0.688191f</span>, <span class="number">-0.587785f</span>&#125;, </span><br><span class="line">&#123;<span class="number">-0.587785f</span>, <span class="number">-0.425325f</span>, <span class="number">-0.688191f</span>&#125;, &#123;<span class="number">-0.688191f</span>, <span class="number">-0.587785f</span>, <span class="number">-0.425325f</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span><span class="title function_">Q_rand</span><span class="params">( <span class="type">int</span> *seed )</span> &#123;</span><br><span class="line">*seed = (<span class="number">69069</span> * *seed + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> *seed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span><span class="title function_">Q_random</span><span class="params">( <span class="type">int</span> *seed )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> ( Q_rand( seed ) &amp; <span class="number">0xffff</span> ) / (<span class="type">float</span>)<span class="number">0x10000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span><span class="title function_">Q_crandom</span><span class="params">( <span class="type">int</span> *seed )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2.0</span> * ( Q_random( seed ) - <span class="number">0.5</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __LCC__</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">VectorCompare</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v1, <span class="type">const</span> <span class="type">vec3_t</span> v2 )</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (v1[<span class="number">0</span>] != v2[<span class="number">0</span>] || v1[<span class="number">1</span>] != v2[<span class="number">1</span>] || v1[<span class="number">2</span>] != v2[<span class="number">2</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">VectorLength</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">vec_t</span>)<span class="built_in">sqrt</span> (v[<span class="number">0</span>]*v[<span class="number">0</span>] + v[<span class="number">1</span>]*v[<span class="number">1</span>] + v[<span class="number">2</span>]*v[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">VectorLengthSquared</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (v[<span class="number">0</span>]*v[<span class="number">0</span>] + v[<span class="number">1</span>]*v[<span class="number">1</span>] + v[<span class="number">2</span>]*v[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">Distance</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> p1, <span class="type">const</span> <span class="type">vec3_t</span> p2 )</span> &#123;</span><br><span class="line"><span class="type">vec3_t</span>v;</span><br><span class="line"></span><br><span class="line">VectorSubtract (p2, p1, v);</span><br><span class="line"><span class="keyword">return</span> VectorLength( v );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">DistanceSquared</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> p1, <span class="type">const</span> <span class="type">vec3_t</span> p2 )</span> &#123;</span><br><span class="line"><span class="type">vec3_t</span>v;</span><br><span class="line"></span><br><span class="line">VectorSubtract (p2, p1, v);</span><br><span class="line"><span class="keyword">return</span> v[<span class="number">0</span>]*v[<span class="number">0</span>] + v[<span class="number">1</span>]*v[<span class="number">1</span>] + v[<span class="number">2</span>]*v[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fast vector normalize routine that does not check to make sure</span></span><br><span class="line"><span class="comment">// that length != 0, nor does it return length, uses rsqrt approximation</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">VectorNormalizeFast</span><span class="params">( <span class="type">vec3_t</span> v )</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">float</span> ilength;</span><br><span class="line"></span><br><span class="line">ilength = Q_rsqrt( DotProduct( v, v ) );</span><br><span class="line"></span><br><span class="line">v[<span class="number">0</span>] *= ilength;</span><br><span class="line">v[<span class="number">1</span>] *= ilength;</span><br><span class="line">v[<span class="number">2</span>] *= ilength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">VectorInverse</span><span class="params">( <span class="type">vec3_t</span> v )</span>&#123;</span><br><span class="line">v[<span class="number">0</span>] = -v[<span class="number">0</span>];</span><br><span class="line">v[<span class="number">1</span>] = -v[<span class="number">1</span>];</span><br><span class="line">v[<span class="number">2</span>] = -v[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">CrossProduct</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v1, <span class="type">const</span> <span class="type">vec3_t</span> v2, <span class="type">vec3_t</span> cross )</span> &#123;</span><br><span class="line">cross[<span class="number">0</span>] = v1[<span class="number">1</span>]*v2[<span class="number">2</span>] - v1[<span class="number">2</span>]*v2[<span class="number">1</span>];</span><br><span class="line">cross[<span class="number">1</span>] = v1[<span class="number">2</span>]*v2[<span class="number">0</span>] - v1[<span class="number">0</span>]*v2[<span class="number">2</span>];</span><br><span class="line">cross[<span class="number">2</span>] = v1[<span class="number">0</span>]*v2[<span class="number">1</span>] - v1[<span class="number">1</span>]*v2[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//=======================================================</span></span><br><span class="line"></span><br><span class="line"><span class="type">signed</span> <span class="type">char</span> <span class="title function_">ClampChar</span><span class="params">( <span class="type">int</span> i )</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( i &lt; <span class="number">-128</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-128</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( i &gt; <span class="number">127</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">127</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">signed</span> <span class="type">short</span> <span class="title function_">ClampShort</span><span class="params">( <span class="type">int</span> i )</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( i &lt; <span class="number">-32768</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-32768</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( i &gt; <span class="number">0x7fff</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0x7fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// this isn&#x27;t a real cheap function to call!</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">DirToByte</span><span class="params">( <span class="type">vec3_t</span> dir )</span> &#123;</span><br><span class="line"><span class="type">int</span>i, best;</span><br><span class="line"><span class="type">float</span>d, bestd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !dir ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bestd = <span class="number">0</span>;</span><br><span class="line">best = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span> ; i&lt;NUMVERTEXNORMALS ; i++)</span><br><span class="line">&#123;</span><br><span class="line">d = DotProduct (dir, bytedirs[i]);</span><br><span class="line"><span class="keyword">if</span> (d &gt; bestd)</span><br><span class="line">&#123;</span><br><span class="line">bestd = d;</span><br><span class="line">best = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> best;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ByteToDir</span><span class="params">( <span class="type">int</span> b, <span class="type">vec3_t</span> dir )</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( b &lt; <span class="number">0</span> || b &gt;= NUMVERTEXNORMALS ) &#123;</span><br><span class="line">VectorCopy( vec3_origin, dir );</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">VectorCopy (bytedirs[b], dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">ColorBytes3</span> <span class="params">(<span class="type">float</span> r, <span class="type">float</span> g, <span class="type">float</span> b)</span> &#123;</span><br><span class="line"><span class="type">unsigned</span>i;</span><br><span class="line"></span><br><span class="line">( (byte *)&amp;i )[<span class="number">0</span>] = r * <span class="number">255</span>;</span><br><span class="line">( (byte *)&amp;i )[<span class="number">1</span>] = g * <span class="number">255</span>;</span><br><span class="line">( (byte *)&amp;i )[<span class="number">2</span>] = b * <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">ColorBytes4</span> <span class="params">(<span class="type">float</span> r, <span class="type">float</span> g, <span class="type">float</span> b, <span class="type">float</span> a)</span> &#123;</span><br><span class="line"><span class="type">unsigned</span>i;</span><br><span class="line"></span><br><span class="line">( (byte *)&amp;i )[<span class="number">0</span>] = r * <span class="number">255</span>;</span><br><span class="line">( (byte *)&amp;i )[<span class="number">1</span>] = g * <span class="number">255</span>;</span><br><span class="line">( (byte *)&amp;i )[<span class="number">2</span>] = b * <span class="number">255</span>;</span><br><span class="line">( (byte *)&amp;i )[<span class="number">3</span>] = a * <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">NormalizeColor</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> in, <span class="type">vec3_t</span> out )</span> &#123;</span><br><span class="line"><span class="type">float</span>max;</span><br><span class="line"></span><br><span class="line">max = in[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span> ( in[<span class="number">1</span>] &gt; max ) &#123;</span><br><span class="line">max = in[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( in[<span class="number">2</span>] &gt; max ) &#123;</span><br><span class="line">max = in[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !max ) &#123;</span><br><span class="line">VectorClear( out );</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">out[<span class="number">0</span>] = in[<span class="number">0</span>] / max;</span><br><span class="line">out[<span class="number">1</span>] = in[<span class="number">1</span>] / max;</span><br><span class="line">out[<span class="number">2</span>] = in[<span class="number">2</span>] / max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=====================</span></span><br><span class="line"><span class="comment">PlaneFromPoints</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns false if the triangle is degenrate.</span></span><br><span class="line"><span class="comment">The normal will point out of the clock for clockwise ordered points</span></span><br><span class="line"><span class="comment">=====================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">qboolean <span class="title function_">PlaneFromPoints</span><span class="params">( <span class="type">vec4_t</span> plane, <span class="type">const</span> <span class="type">vec3_t</span> a, <span class="type">const</span> <span class="type">vec3_t</span> b, <span class="type">const</span> <span class="type">vec3_t</span> c )</span> &#123;</span><br><span class="line"><span class="type">vec3_t</span>d1, d2;</span><br><span class="line"></span><br><span class="line">VectorSubtract( b, a, d1 );</span><br><span class="line">VectorSubtract( c, a, d2 );</span><br><span class="line">CrossProduct( d2, d1, plane );</span><br><span class="line"><span class="keyword">if</span> ( VectorNormalize( plane ) == <span class="number">0</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> qfalse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plane[<span class="number">3</span>] = DotProduct( a, plane );</span><br><span class="line"><span class="keyword">return</span> qtrue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">RotatePointAroundVector</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">This is not implemented very well...</span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">RotatePointAroundVector</span><span class="params">( <span class="type">vec3_t</span> dst, <span class="type">const</span> <span class="type">vec3_t</span> dir, <span class="type">const</span> <span class="type">vec3_t</span> point,</span></span><br><span class="line"><span class="params"> <span class="type">float</span> degrees )</span> &#123;</span><br><span class="line"><span class="type">float</span>m[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">float</span>im[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">float</span>zrot[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">float</span>tmpmat[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">float</span>rot[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span>i;</span><br><span class="line"><span class="type">vec3_t</span> vr, vup, vf;</span><br><span class="line"><span class="type">float</span>rad;</span><br><span class="line"></span><br><span class="line">vf[<span class="number">0</span>] = dir[<span class="number">0</span>];</span><br><span class="line">vf[<span class="number">1</span>] = dir[<span class="number">1</span>];</span><br><span class="line">vf[<span class="number">2</span>] = dir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">PerpendicularVector( vr, dir );</span><br><span class="line">CrossProduct( vr, vf, vup );</span><br><span class="line"></span><br><span class="line">m[<span class="number">0</span>][<span class="number">0</span>] = vr[<span class="number">0</span>];</span><br><span class="line">m[<span class="number">1</span>][<span class="number">0</span>] = vr[<span class="number">1</span>];</span><br><span class="line">m[<span class="number">2</span>][<span class="number">0</span>] = vr[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">m[<span class="number">0</span>][<span class="number">1</span>] = vup[<span class="number">0</span>];</span><br><span class="line">m[<span class="number">1</span>][<span class="number">1</span>] = vup[<span class="number">1</span>];</span><br><span class="line">m[<span class="number">2</span>][<span class="number">1</span>] = vup[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">m[<span class="number">0</span>][<span class="number">2</span>] = vf[<span class="number">0</span>];</span><br><span class="line">m[<span class="number">1</span>][<span class="number">2</span>] = vf[<span class="number">1</span>];</span><br><span class="line">m[<span class="number">2</span>][<span class="number">2</span>] = vf[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">memcpy</span>( im, m, <span class="keyword">sizeof</span>( im ) );</span><br><span class="line"></span><br><span class="line">im[<span class="number">0</span>][<span class="number">1</span>] = m[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">im[<span class="number">0</span>][<span class="number">2</span>] = m[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">im[<span class="number">1</span>][<span class="number">0</span>] = m[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">im[<span class="number">1</span>][<span class="number">2</span>] = m[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">im[<span class="number">2</span>][<span class="number">0</span>] = m[<span class="number">0</span>][<span class="number">2</span>];</span><br><span class="line">im[<span class="number">2</span>][<span class="number">1</span>] = m[<span class="number">1</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span>( zrot, <span class="number">0</span>, <span class="keyword">sizeof</span>( zrot ) );</span><br><span class="line">zrot[<span class="number">0</span>][<span class="number">0</span>] = zrot[<span class="number">1</span>][<span class="number">1</span>] = zrot[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1.0F</span>;</span><br><span class="line"></span><br><span class="line">rad = DEG2RAD( degrees );</span><br><span class="line">zrot[<span class="number">0</span>][<span class="number">0</span>] = <span class="built_in">cos</span>( rad );</span><br><span class="line">zrot[<span class="number">0</span>][<span class="number">1</span>] = <span class="built_in">sin</span>( rad );</span><br><span class="line">zrot[<span class="number">1</span>][<span class="number">0</span>] = -<span class="built_in">sin</span>( rad );</span><br><span class="line">zrot[<span class="number">1</span>][<span class="number">1</span>] = <span class="built_in">cos</span>( rad );</span><br><span class="line"></span><br><span class="line">MatrixMultiply( m, zrot, tmpmat );</span><br><span class="line">MatrixMultiply( tmpmat, im, rot );</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ ) &#123;</span><br><span class="line">dst[i] = rot[i][<span class="number">0</span>] * point[<span class="number">0</span>] + rot[i][<span class="number">1</span>] * point[<span class="number">1</span>] + rot[i][<span class="number">2</span>] * point[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">RotateAroundDirection</span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">RotateAroundDirection</span><span class="params">( <span class="type">vec3_t</span> axis[<span class="number">3</span>], <span class="type">float</span> yaw )</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an arbitrary axis[1] </span></span><br><span class="line">PerpendicularVector( axis[<span class="number">1</span>], axis[<span class="number">0</span>] );</span><br><span class="line"></span><br><span class="line"><span class="comment">// rotate it around axis[0] by yaw</span></span><br><span class="line"><span class="keyword">if</span> ( yaw ) &#123;</span><br><span class="line"><span class="type">vec3_t</span>temp;</span><br><span class="line"></span><br><span class="line">VectorCopy( axis[<span class="number">1</span>], temp );</span><br><span class="line">RotatePointAroundVector( axis[<span class="number">1</span>], axis[<span class="number">0</span>], temp, yaw );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cross to get axis[2]</span></span><br><span class="line">CrossProduct( axis[<span class="number">0</span>], axis[<span class="number">1</span>], axis[<span class="number">2</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vectoangles</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> value1, <span class="type">vec3_t</span> angles )</span> &#123;</span><br><span class="line"><span class="type">float</span>forward;</span><br><span class="line"><span class="type">float</span>yaw, pitch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( value1[<span class="number">1</span>] == <span class="number">0</span> &amp;&amp; value1[<span class="number">0</span>] == <span class="number">0</span> ) &#123;</span><br><span class="line">yaw = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( value1[<span class="number">2</span>] &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">pitch = <span class="number">90</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">pitch = <span class="number">270</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( value1[<span class="number">0</span>] ) &#123;</span><br><span class="line">yaw = ( <span class="built_in">atan2</span> ( value1[<span class="number">1</span>], value1[<span class="number">0</span>] ) * <span class="number">180</span> / M_PI );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( value1[<span class="number">1</span>] &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">yaw = <span class="number">90</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">yaw = <span class="number">270</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( yaw &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">yaw += <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">forward = <span class="built_in">sqrt</span> ( value1[<span class="number">0</span>]*value1[<span class="number">0</span>] + value1[<span class="number">1</span>]*value1[<span class="number">1</span>] );</span><br><span class="line">pitch = ( <span class="built_in">atan2</span>(value1[<span class="number">2</span>], forward) * <span class="number">180</span> / M_PI );</span><br><span class="line"><span class="keyword">if</span> ( pitch &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">pitch += <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">angles[PITCH] = -pitch;</span><br><span class="line">angles[YAW] = yaw;</span><br><span class="line">angles[ROLL] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">AnglesToAxis</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">AnglesToAxis</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> angles, <span class="type">vec3_t</span> axis[<span class="number">3</span>] )</span> &#123;</span><br><span class="line"><span class="type">vec3_t</span>right;</span><br><span class="line"></span><br><span class="line"><span class="comment">// angle vectors returns &quot;right&quot; instead of &quot;y axis&quot;</span></span><br><span class="line">AngleVectors( angles, axis[<span class="number">0</span>], right, axis[<span class="number">2</span>] );</span><br><span class="line">VectorSubtract( vec3_origin, right, axis[<span class="number">1</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AxisClear</span><span class="params">( <span class="type">vec3_t</span> axis[<span class="number">3</span>] )</span> &#123;</span><br><span class="line">axis[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">axis[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">axis[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">axis[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AxisCopy</span><span class="params">( <span class="type">vec3_t</span> in[<span class="number">3</span>], <span class="type">vec3_t</span> out[<span class="number">3</span>] )</span> &#123;</span><br><span class="line">VectorCopy( in[<span class="number">0</span>], out[<span class="number">0</span>] );</span><br><span class="line">VectorCopy( in[<span class="number">1</span>], out[<span class="number">1</span>] );</span><br><span class="line">VectorCopy( in[<span class="number">2</span>], out[<span class="number">2</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ProjectPointOnPlane</span><span class="params">( <span class="type">vec3_t</span> dst, <span class="type">const</span> <span class="type">vec3_t</span> p, <span class="type">const</span> <span class="type">vec3_t</span> normal )</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">float</span> d;</span><br><span class="line"><span class="type">vec3_t</span> n;</span><br><span class="line"><span class="type">float</span> inv_denom;</span><br><span class="line"></span><br><span class="line">inv_denom =  DotProduct( normal, normal );</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> Q3_VM</span></span><br><span class="line">assert( Q_fabs(inv_denom) != <span class="number">0.0f</span> ); <span class="comment">// bk010122 - zero vectors get here</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">inv_denom = <span class="number">1.0f</span> / inv_denom;</span><br><span class="line"></span><br><span class="line">d = DotProduct( normal, p ) * inv_denom;</span><br><span class="line"></span><br><span class="line">n[<span class="number">0</span>] = normal[<span class="number">0</span>] * inv_denom;</span><br><span class="line">n[<span class="number">1</span>] = normal[<span class="number">1</span>] * inv_denom;</span><br><span class="line">n[<span class="number">2</span>] = normal[<span class="number">2</span>] * inv_denom;</span><br><span class="line"></span><br><span class="line">dst[<span class="number">0</span>] = p[<span class="number">0</span>] - d * n[<span class="number">0</span>];</span><br><span class="line">dst[<span class="number">1</span>] = p[<span class="number">1</span>] - d * n[<span class="number">1</span>];</span><br><span class="line">dst[<span class="number">2</span>] = p[<span class="number">2</span>] - d * n[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">================</span></span><br><span class="line"><span class="comment">MakeNormalVectors</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Given a normalized forward vector, create two</span></span><br><span class="line"><span class="comment">other perpendicular vectors</span></span><br><span class="line"><span class="comment">================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MakeNormalVectors</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> forward, <span class="type">vec3_t</span> right, <span class="type">vec3_t</span> up)</span> &#123;</span><br><span class="line"><span class="type">float</span>d;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this rotate and negate guarantees a vector</span></span><br><span class="line"><span class="comment">// not colinear with the original</span></span><br><span class="line">right[<span class="number">1</span>] = -forward[<span class="number">0</span>];</span><br><span class="line">right[<span class="number">2</span>] = forward[<span class="number">1</span>];</span><br><span class="line">right[<span class="number">0</span>] = forward[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">d = DotProduct (right, forward);</span><br><span class="line">VectorMA (right, -d, forward, right);</span><br><span class="line">VectorNormalize (right);</span><br><span class="line">CrossProduct (right, forward, up);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">VectorRotate</span><span class="params">( <span class="type">vec3_t</span> in, <span class="type">vec3_t</span> matrix[<span class="number">3</span>], <span class="type">vec3_t</span> out )</span></span><br><span class="line">&#123;</span><br><span class="line">out[<span class="number">0</span>] = DotProduct( in, matrix[<span class="number">0</span>] );</span><br><span class="line">out[<span class="number">1</span>] = DotProduct( in, matrix[<span class="number">1</span>] );</span><br><span class="line">out[<span class="number">2</span>] = DotProduct( in, matrix[<span class="number">2</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !idppc</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** float q_rsqrt( float number )</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">Q_rsqrt</span><span class="params">( <span class="type">float</span> number )</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">long</span> i;</span><br><span class="line"><span class="type">float</span> x2, y;</span><br><span class="line"><span class="type">const</span> <span class="type">float</span> threehalfs = <span class="number">1.5F</span>;</span><br><span class="line"></span><br><span class="line">x2 = number * <span class="number">0.5F</span>;</span><br><span class="line">y  = number;</span><br><span class="line">i  = * ( <span class="type">long</span> * ) &amp;y;<span class="comment">// evil floating point bit level hacking</span></span><br><span class="line">i  = <span class="number">0x5f3759df</span> - ( i &gt;&gt; <span class="number">1</span> );               <span class="comment">// what the fuck?</span></span><br><span class="line">y  = * ( <span class="type">float</span> * ) &amp;i;</span><br><span class="line">y  = y * ( threehalfs - ( x2 * y * y ) );   <span class="comment">// 1st iteration</span></span><br><span class="line"><span class="comment">//y  = y * ( threehalfs - ( x2 * y * y ) );   // 2nd iteration, this can be removed</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> Q3_VM</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __linux__</span></span><br><span class="line">assert( !isnan(y) ); <span class="comment">// bk010122 - FPE?</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">Q_fabs</span><span class="params">( <span class="type">float</span> f )</span> &#123;</span><br><span class="line"><span class="type">int</span> tmp = * ( <span class="type">int</span> * ) &amp;f;</span><br><span class="line">tmp &amp;= <span class="number">0x7FFFFFFF</span>;</span><br><span class="line"><span class="keyword">return</span> * ( <span class="type">float</span> * ) &amp;tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">LerpAngle</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">===============</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">LerpAngle</span> <span class="params">(<span class="type">float</span> from, <span class="type">float</span> to, <span class="type">float</span> frac)</span> &#123;</span><br><span class="line"><span class="type">float</span>a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( to - from &gt; <span class="number">180</span> ) &#123;</span><br><span class="line">to -= <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( to - from &lt; <span class="number">-180</span> ) &#123;</span><br><span class="line">to += <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line">a = from + frac * (to - from);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">AngleSubtract</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Always returns a value from -180 to 180</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span><span class="title function_">AngleSubtract</span><span class="params">( <span class="type">float</span> a1, <span class="type">float</span> a2 )</span> &#123;</span><br><span class="line"><span class="type">float</span>a;</span><br><span class="line"></span><br><span class="line">a = a1 - a2;</span><br><span class="line"><span class="keyword">while</span> ( a &gt; <span class="number">180</span> ) &#123;</span><br><span class="line">a -= <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( a &lt; <span class="number">-180</span> ) &#123;</span><br><span class="line">a += <span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AnglesSubtract</span><span class="params">( <span class="type">vec3_t</span> v1, <span class="type">vec3_t</span> v2, <span class="type">vec3_t</span> v3 )</span> &#123;</span><br><span class="line">v3[<span class="number">0</span>] = AngleSubtract( v1[<span class="number">0</span>], v2[<span class="number">0</span>] );</span><br><span class="line">v3[<span class="number">1</span>] = AngleSubtract( v1[<span class="number">1</span>], v2[<span class="number">1</span>] );</span><br><span class="line">v3[<span class="number">2</span>] = AngleSubtract( v1[<span class="number">2</span>], v2[<span class="number">2</span>] );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">float</span><span class="title function_">AngleMod</span><span class="params">(<span class="type">float</span> a)</span> &#123;</span><br><span class="line">a = (<span class="number">360.0</span>/<span class="number">65536</span>) * ((<span class="type">int</span>)(a*(<span class="number">65536</span>/<span class="number">360.0</span>)) &amp; <span class="number">65535</span>);</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">AngleNormalize360</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">returns angle normalized to the range [0 &lt;= angle &lt; 360]</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">AngleNormalize360</span> <span class="params">( <span class="type">float</span> angle )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="number">360.0</span> / <span class="number">65536</span>) * ((<span class="type">int</span>)(angle * (<span class="number">65536</span> / <span class="number">360.0</span>)) &amp; <span class="number">65535</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">AngleNormalize180</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">returns angle normalized to the range [-180 &lt; angle &lt;= 180]</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">AngleNormalize180</span> <span class="params">( <span class="type">float</span> angle )</span> &#123;</span><br><span class="line">angle = AngleNormalize360( angle );</span><br><span class="line"><span class="keyword">if</span> ( angle &gt; <span class="number">180.0</span> ) &#123;</span><br><span class="line">angle -= <span class="number">360.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> angle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">AngleDelta</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">returns the normalized delta from angle1 to angle2</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">AngleDelta</span> <span class="params">( <span class="type">float</span> angle1, <span class="type">float</span> angle2 )</span> &#123;</span><br><span class="line"><span class="keyword">return</span> AngleNormalize180( angle1 - angle2 );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//============================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">SetPlaneSignbits</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SetPlaneSignbits</span> <span class="params">(<span class="type">cplane_t</span> *out)</span> &#123;</span><br><span class="line"><span class="type">int</span>bits, j;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for fast box on planeside test</span></span><br><span class="line">bits = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (j=<span class="number">0</span> ; j&lt;<span class="number">3</span> ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (out-&gt;normal[j] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">bits |= <span class="number">1</span>&lt;&lt;j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">out-&gt;signbits = bits;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">==================</span></span><br><span class="line"><span class="comment">BoxOnPlaneSide</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Returns 1, 2, or 1 + 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// this is the slow, general version</span></span><br><span class="line"><span class="comment">int BoxOnPlaneSide2 (vec3_t emins, vec3_t emaxs, struct cplane_s *p)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">inti;</span></span><br><span class="line"><span class="comment">floatdist1, dist2;</span></span><br><span class="line"><span class="comment">intsides;</span></span><br><span class="line"><span class="comment">vec3_tcorners[2];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">for (i=0 ; i&lt;3 ; i++)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if (p-&gt;normal[i] &lt; 0)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">corners[0][i] = emins[i];</span></span><br><span class="line"><span class="comment">corners[1][i] = emaxs[i];</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">else</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">corners[1][i] = emins[i];</span></span><br><span class="line"><span class="comment">corners[0][i] = emaxs[i];</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">dist1 = DotProduct (p-&gt;normal, corners[0]) - p-&gt;dist;</span></span><br><span class="line"><span class="comment">dist2 = DotProduct (p-&gt;normal, corners[1]) - p-&gt;dist;</span></span><br><span class="line"><span class="comment">sides = 0;</span></span><br><span class="line"><span class="comment">if (dist1 &gt;= 0)</span></span><br><span class="line"><span class="comment">sides = 1;</span></span><br><span class="line"><span class="comment">if (dist2 &lt; 0)</span></span><br><span class="line"><span class="comment">sides |= 2;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">return sides;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">==================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !( (defined __linux__ || __FreeBSD__) &amp;&amp; (defined __i386__) &amp;&amp; (!defined C_ONLY)) <span class="comment">// rb010123</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined __LCC__ || defined C_ONLY || !id386 || defined __VECTORC</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">BoxOnPlaneSide</span> <span class="params">(<span class="type">vec3_t</span> emins, <span class="type">vec3_t</span> emaxs, <span class="keyword">struct</span> cplane_s *p)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">float</span>dist1, dist2;</span><br><span class="line"><span class="type">int</span>sides;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fast axial cases</span></span><br><span class="line"><span class="keyword">if</span> (p-&gt;type &lt; <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;dist &lt;= emins[p-&gt;type])</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;dist &gt;= emaxs[p-&gt;type])</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// general case</span></span><br><span class="line"><span class="keyword">switch</span> (p-&gt;signbits)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">dist1 = p-&gt;normal[<span class="number">0</span>]*emins[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emins[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emins[<span class="number">2</span>];</span><br><span class="line">dist2 = p-&gt;normal[<span class="number">0</span>]*emaxs[<span class="number">0</span>] + p-&gt;normal[<span class="number">1</span>]*emaxs[<span class="number">1</span>] + p-&gt;normal[<span class="number">2</span>]*emaxs[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">dist1 = dist2 = <span class="number">0</span>;<span class="comment">// shut up compiler</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sides = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (dist1 &gt;= p-&gt;dist)</span><br><span class="line">sides = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (dist2 &lt; p-&gt;dist)</span><br><span class="line">sides |= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sides;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable: 4035 )</span></span><br><span class="line"></span><br><span class="line">__declspec( naked ) <span class="type">int</span> <span class="title function_">BoxOnPlaneSide</span> <span class="params">(<span class="type">vec3_t</span> emins, <span class="type">vec3_t</span> emaxs, <span class="keyword">struct</span> cplane_s *p)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> bops_initialized;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> Ljmptab[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">__asm &#123;</span><br><span class="line"></span><br><span class="line">push ebx</span><br><span class="line"></span><br><span class="line">cmp bops_initialized, <span class="number">1</span></span><br><span class="line">je  initialized</span><br><span class="line">mov bops_initialized, <span class="number">1</span></span><br><span class="line"></span><br><span class="line">mov Ljmptab[<span class="number">0</span>*<span class="number">4</span>], offset Lcase0</span><br><span class="line">mov Ljmptab[<span class="number">1</span>*<span class="number">4</span>], offset Lcase1</span><br><span class="line">mov Ljmptab[<span class="number">2</span>*<span class="number">4</span>], offset Lcase2</span><br><span class="line">mov Ljmptab[<span class="number">3</span>*<span class="number">4</span>], offset Lcase3</span><br><span class="line">mov Ljmptab[<span class="number">4</span>*<span class="number">4</span>], offset Lcase4</span><br><span class="line">mov Ljmptab[<span class="number">5</span>*<span class="number">4</span>], offset Lcase5</span><br><span class="line">mov Ljmptab[<span class="number">6</span>*<span class="number">4</span>], offset Lcase6</span><br><span class="line">mov Ljmptab[<span class="number">7</span>*<span class="number">4</span>], offset Lcase7</span><br><span class="line"></span><br><span class="line">initialized:</span><br><span class="line"></span><br><span class="line">mov edx,dword ptr[<span class="number">4</span>+<span class="number">12</span>+esp]</span><br><span class="line">mov ecx,dword ptr[<span class="number">4</span>+<span class="number">4</span>+esp]</span><br><span class="line">xor eax,eax</span><br><span class="line">mov ebx,dword ptr[<span class="number">4</span>+<span class="number">8</span>+esp]</span><br><span class="line">mov al,byte ptr[<span class="number">17</span>+edx]</span><br><span class="line">cmp al,<span class="number">8</span></span><br><span class="line">jge Lerror</span><br><span class="line">fld dword ptr[<span class="number">0</span>+edx]</span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp dword ptr[Ljmptab+eax*4]</span><br><span class="line">Lcase0:</span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase1:</span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase2:</span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase3:</span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase4:</span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase5:</span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase6:</span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">jmp LSetSides</span><br><span class="line">Lcase7:</span><br><span class="line">fmul dword ptr[ecx]</span><br><span class="line">fld dword ptr[0+4+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[4+ecx]</span><br><span class="line">fld dword ptr[0+8+edx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fmul dword ptr[4+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span></span><br><span class="line">fld <span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ecx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">5</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fmul dword ptr[8+ebx]</span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fxch <span class="title function_">st</span><span class="params">(<span class="number">3</span>)</span></span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">LSetSides:</span><br><span class="line">faddp <span class="title function_">st</span><span class="params">(<span class="number">2</span>)</span>,<span class="title function_">st</span><span class="params">(<span class="number">0</span>)</span></span><br><span class="line">fcomp dword ptr[12+edx]</span><br><span class="line">xor ecx,ecx</span><br><span class="line">fnstsw ax</span><br><span class="line">fcomp dword ptr[12+edx]</span><br><span class="line">and ah,1</span><br><span class="line">xor ah,1</span><br><span class="line">add cl,ah</span><br><span class="line">fnstsw ax</span><br><span class="line">and ah,1</span><br><span class="line">add ah,ah</span><br><span class="line">add cl,ah</span><br><span class="line">pop ebx</span><br><span class="line">mov eax,ecx</span><br><span class="line">ret</span><br><span class="line">Lerror:</span><br><span class="line"><span class="type">int</span> 3</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( default: 4035 )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">RadiusFromBounds</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">RadiusFromBounds</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> mins, <span class="type">const</span> <span class="type">vec3_t</span> maxs )</span> &#123;</span><br><span class="line"><span class="type">int</span>i;</span><br><span class="line"><span class="type">vec3_t</span>corner;</span><br><span class="line"><span class="type">float</span>a, b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span> ; i&lt;<span class="number">3</span> ; i++) &#123;</span><br><span class="line">a = <span class="built_in">fabs</span>( mins[i] );</span><br><span class="line">b = <span class="built_in">fabs</span>( maxs[i] );</span><br><span class="line">corner[i] = a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> VectorLength (corner);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ClearBounds</span><span class="params">( <span class="type">vec3_t</span> mins, <span class="type">vec3_t</span> maxs )</span> &#123;</span><br><span class="line">mins[<span class="number">0</span>] = mins[<span class="number">1</span>] = mins[<span class="number">2</span>] = <span class="number">99999</span>;</span><br><span class="line">maxs[<span class="number">0</span>] = maxs[<span class="number">1</span>] = maxs[<span class="number">2</span>] = <span class="number">-99999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AddPointToBounds</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v, <span class="type">vec3_t</span> mins, <span class="type">vec3_t</span> maxs )</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">0</span>] &lt; mins[<span class="number">0</span>] ) &#123;</span><br><span class="line">mins[<span class="number">0</span>] = v[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">0</span>] &gt; maxs[<span class="number">0</span>]) &#123;</span><br><span class="line">maxs[<span class="number">0</span>] = v[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">1</span>] &lt; mins[<span class="number">1</span>] ) &#123;</span><br><span class="line">mins[<span class="number">1</span>] = v[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">1</span>] &gt; maxs[<span class="number">1</span>]) &#123;</span><br><span class="line">maxs[<span class="number">1</span>] = v[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">2</span>] &lt; mins[<span class="number">2</span>] ) &#123;</span><br><span class="line">mins[<span class="number">2</span>] = v[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( v[<span class="number">2</span>] &gt; maxs[<span class="number">2</span>]) &#123;</span><br><span class="line">maxs[<span class="number">2</span>] = v[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">VectorNormalize</span><span class="params">( <span class="type">vec3_t</span> v )</span> &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> TTimo - Apple G4 altivec source uses double?</span></span><br><span class="line"><span class="type">float</span>length, ilength;</span><br><span class="line"></span><br><span class="line">length = v[<span class="number">0</span>]*v[<span class="number">0</span>] + v[<span class="number">1</span>]*v[<span class="number">1</span>] + v[<span class="number">2</span>]*v[<span class="number">2</span>];</span><br><span class="line">length = <span class="built_in">sqrt</span> (length);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( length ) &#123;</span><br><span class="line">ilength = <span class="number">1</span>/length;</span><br><span class="line">v[<span class="number">0</span>] *= ilength;</span><br><span class="line">v[<span class="number">1</span>] *= ilength;</span><br><span class="line">v[<span class="number">2</span>] *= ilength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> <span class="title function_">VectorNormalize2</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> v, <span class="type">vec3_t</span> out)</span> &#123;</span><br><span class="line"><span class="type">float</span>length, ilength;</span><br><span class="line"></span><br><span class="line">length = v[<span class="number">0</span>]*v[<span class="number">0</span>] + v[<span class="number">1</span>]*v[<span class="number">1</span>] + v[<span class="number">2</span>]*v[<span class="number">2</span>];</span><br><span class="line">length = <span class="built_in">sqrt</span> (length);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (length)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> Q3_VM <span class="comment">// bk0101022 - FPE related</span></span></span><br><span class="line"><span class="comment">//  assert( ((Q_fabs(v[0])!=0.0f) || (Q_fabs(v[1])!=0.0f) || (Q_fabs(v[2])!=0.0f)) );</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">ilength = <span class="number">1</span>/length;</span><br><span class="line">out[<span class="number">0</span>] = v[<span class="number">0</span>]*ilength;</span><br><span class="line">out[<span class="number">1</span>] = v[<span class="number">1</span>]*ilength;</span><br><span class="line">out[<span class="number">2</span>] = v[<span class="number">2</span>]*ilength;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> Q3_VM <span class="comment">// bk0101022 - FPE related</span></span></span><br><span class="line"><span class="comment">//  assert( ((Q_fabs(v[0])==0.0f) &amp;&amp; (Q_fabs(v[1])==0.0f) &amp;&amp; (Q_fabs(v[2])==0.0f)) );</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">VectorClear( out );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _VectorMA( <span class="type">const</span> <span class="type">vec3_t</span> veca, <span class="type">float</span> scale, <span class="type">const</span> <span class="type">vec3_t</span> vecb, <span class="type">vec3_t</span> vecc) &#123;</span><br><span class="line">vecc[<span class="number">0</span>] = veca[<span class="number">0</span>] + scale*vecb[<span class="number">0</span>];</span><br><span class="line">vecc[<span class="number">1</span>] = veca[<span class="number">1</span>] + scale*vecb[<span class="number">1</span>];</span><br><span class="line">vecc[<span class="number">2</span>] = veca[<span class="number">2</span>] + scale*vecb[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">vec_t</span> _DotProduct( <span class="type">const</span> <span class="type">vec3_t</span> v1, <span class="type">const</span> <span class="type">vec3_t</span> v2 ) &#123;</span><br><span class="line"><span class="keyword">return</span> v1[<span class="number">0</span>]*v2[<span class="number">0</span>] + v1[<span class="number">1</span>]*v2[<span class="number">1</span>] + v1[<span class="number">2</span>]*v2[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _VectorSubtract( <span class="type">const</span> <span class="type">vec3_t</span> veca, <span class="type">const</span> <span class="type">vec3_t</span> vecb, <span class="type">vec3_t</span> out ) &#123;</span><br><span class="line">out[<span class="number">0</span>] = veca[<span class="number">0</span>]-vecb[<span class="number">0</span>];</span><br><span class="line">out[<span class="number">1</span>] = veca[<span class="number">1</span>]-vecb[<span class="number">1</span>];</span><br><span class="line">out[<span class="number">2</span>] = veca[<span class="number">2</span>]-vecb[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _VectorAdd( <span class="type">const</span> <span class="type">vec3_t</span> veca, <span class="type">const</span> <span class="type">vec3_t</span> vecb, <span class="type">vec3_t</span> out ) &#123;</span><br><span class="line">out[<span class="number">0</span>] = veca[<span class="number">0</span>]+vecb[<span class="number">0</span>];</span><br><span class="line">out[<span class="number">1</span>] = veca[<span class="number">1</span>]+vecb[<span class="number">1</span>];</span><br><span class="line">out[<span class="number">2</span>] = veca[<span class="number">2</span>]+vecb[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _VectorCopy( <span class="type">const</span> <span class="type">vec3_t</span> in, <span class="type">vec3_t</span> out ) &#123;</span><br><span class="line">out[<span class="number">0</span>] = in[<span class="number">0</span>];</span><br><span class="line">out[<span class="number">1</span>] = in[<span class="number">1</span>];</span><br><span class="line">out[<span class="number">2</span>] = in[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _VectorScale( <span class="type">const</span> <span class="type">vec3_t</span> in, <span class="type">vec_t</span> scale, <span class="type">vec3_t</span> out ) &#123;</span><br><span class="line">out[<span class="number">0</span>] = in[<span class="number">0</span>]*scale;</span><br><span class="line">out[<span class="number">1</span>] = in[<span class="number">1</span>]*scale;</span><br><span class="line">out[<span class="number">2</span>] = in[<span class="number">2</span>]*scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Vector4Scale</span><span class="params">( <span class="type">const</span> <span class="type">vec4_t</span> in, <span class="type">vec_t</span> scale, <span class="type">vec4_t</span> out )</span> &#123;</span><br><span class="line">out[<span class="number">0</span>] = in[<span class="number">0</span>]*scale;</span><br><span class="line">out[<span class="number">1</span>] = in[<span class="number">1</span>]*scale;</span><br><span class="line">out[<span class="number">2</span>] = in[<span class="number">2</span>]*scale;</span><br><span class="line">out[<span class="number">3</span>] = in[<span class="number">3</span>]*scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Q_log2</span><span class="params">( <span class="type">int</span> val )</span> &#123;</span><br><span class="line"><span class="type">int</span> answer;</span><br><span class="line"></span><br><span class="line">answer = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ( ( val&gt;&gt;=<span class="number">1</span> ) != <span class="number">0</span> ) &#123;</span><br><span class="line">answer++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> answer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">PlaneTypeForNormal</span></span><br><span class="line"><span class="comment">=================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">intPlaneTypeForNormal (vec3_t normal) &#123;</span></span><br><span class="line"><span class="comment">if ( normal[0] == 1.0 )</span></span><br><span class="line"><span class="comment">return PLANE_X;</span></span><br><span class="line"><span class="comment">if ( normal[1] == 1.0 )</span></span><br><span class="line"><span class="comment">return PLANE_Y;</span></span><br><span class="line"><span class="comment">if ( normal[2] == 1.0 )</span></span><br><span class="line"><span class="comment">return PLANE_Z;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">return PLANE_NON_AXIAL;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">================</span></span><br><span class="line"><span class="comment">MatrixMultiply</span></span><br><span class="line"><span class="comment">================</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MatrixMultiply</span><span class="params">(<span class="type">float</span> in1[<span class="number">3</span>][<span class="number">3</span>], <span class="type">float</span> in2[<span class="number">3</span>][<span class="number">3</span>], <span class="type">float</span> out[<span class="number">3</span>][<span class="number">3</span>])</span> &#123;</span><br><span class="line">out[<span class="number">0</span>][<span class="number">0</span>] = in1[<span class="number">0</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">0</span>] + in1[<span class="number">0</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">0</span>] +</span><br><span class="line">in1[<span class="number">0</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">out[<span class="number">0</span>][<span class="number">1</span>] = in1[<span class="number">0</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">1</span>] + in1[<span class="number">0</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">1</span>] +</span><br><span class="line">in1[<span class="number">0</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">out[<span class="number">0</span>][<span class="number">2</span>] = in1[<span class="number">0</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">2</span>] + in1[<span class="number">0</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">2</span>] +</span><br><span class="line">in1[<span class="number">0</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">out[<span class="number">1</span>][<span class="number">0</span>] = in1[<span class="number">1</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">0</span>] + in1[<span class="number">1</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">0</span>] +</span><br><span class="line">in1[<span class="number">1</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">out[<span class="number">1</span>][<span class="number">1</span>] = in1[<span class="number">1</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">1</span>] + in1[<span class="number">1</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">1</span>] +</span><br><span class="line">in1[<span class="number">1</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">out[<span class="number">1</span>][<span class="number">2</span>] = in1[<span class="number">1</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">2</span>] + in1[<span class="number">1</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">2</span>] +</span><br><span class="line">in1[<span class="number">1</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">out[<span class="number">2</span>][<span class="number">0</span>] = in1[<span class="number">2</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">0</span>] + in1[<span class="number">2</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">0</span>] +</span><br><span class="line">in1[<span class="number">2</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">out[<span class="number">2</span>][<span class="number">1</span>] = in1[<span class="number">2</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">1</span>] + in1[<span class="number">2</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">1</span>] +</span><br><span class="line">in1[<span class="number">2</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">out[<span class="number">2</span>][<span class="number">2</span>] = in1[<span class="number">2</span>][<span class="number">0</span>] * in2[<span class="number">0</span>][<span class="number">2</span>] + in1[<span class="number">2</span>][<span class="number">1</span>] * in2[<span class="number">1</span>][<span class="number">2</span>] +</span><br><span class="line">in1[<span class="number">2</span>][<span class="number">2</span>] * in2[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AngleVectors</span><span class="params">( <span class="type">const</span> <span class="type">vec3_t</span> angles, <span class="type">vec3_t</span> forward, <span class="type">vec3_t</span> right, <span class="type">vec3_t</span> up)</span> &#123;</span><br><span class="line"><span class="type">float</span>angle;</span><br><span class="line"><span class="type">static</span> <span class="type">float</span>sr, sp, sy, cr, cp, cy;</span><br><span class="line"><span class="comment">// static to help MS compiler fp bugs</span></span><br><span class="line"></span><br><span class="line">angle = angles[YAW] * (M_PI*<span class="number">2</span> / <span class="number">360</span>);</span><br><span class="line">sy = <span class="built_in">sin</span>(angle);</span><br><span class="line">cy = <span class="built_in">cos</span>(angle);</span><br><span class="line">angle = angles[PITCH] * (M_PI*<span class="number">2</span> / <span class="number">360</span>);</span><br><span class="line">sp = <span class="built_in">sin</span>(angle);</span><br><span class="line">cp = <span class="built_in">cos</span>(angle);</span><br><span class="line">angle = angles[ROLL] * (M_PI*<span class="number">2</span> / <span class="number">360</span>);</span><br><span class="line">sr = <span class="built_in">sin</span>(angle);</span><br><span class="line">cr = <span class="built_in">cos</span>(angle);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (forward)</span><br><span class="line">&#123;</span><br><span class="line">forward[<span class="number">0</span>] = cp*cy;</span><br><span class="line">forward[<span class="number">1</span>] = cp*sy;</span><br><span class="line">forward[<span class="number">2</span>] = -sp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (right)</span><br><span class="line">&#123;</span><br><span class="line">right[<span class="number">0</span>] = (<span class="number">-1</span>*sr*sp*cy+<span class="number">-1</span>*cr*-sy);</span><br><span class="line">right[<span class="number">1</span>] = (<span class="number">-1</span>*sr*sp*sy+<span class="number">-1</span>*cr*cy);</span><br><span class="line">right[<span class="number">2</span>] = <span class="number">-1</span>*sr*cp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (up)</span><br><span class="line">&#123;</span><br><span class="line">up[<span class="number">0</span>] = (cr*sp*cy+-sr*-sy);</span><br><span class="line">up[<span class="number">1</span>] = (cr*sp*sy+-sr*cy);</span><br><span class="line">up[<span class="number">2</span>] = cr*cp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** assumes &quot;src&quot; is normalized</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">PerpendicularVector</span><span class="params">( <span class="type">vec3_t</span> dst, <span class="type">const</span> <span class="type">vec3_t</span> src )</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span>pos;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">float</span> minelem = <span class="number">1.0F</span>;</span><br><span class="line"><span class="type">vec3_t</span> tempvec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** find the smallest magnitude axially aligned vector</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">for</span> ( pos = <span class="number">0</span>, i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">fabs</span>( src[i] ) &lt; minelem )</span><br><span class="line">&#123;</span><br><span class="line">pos = i;</span><br><span class="line">minelem = <span class="built_in">fabs</span>( src[i] );</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">tempvec[<span class="number">0</span>] = tempvec[<span class="number">1</span>] = tempvec[<span class="number">2</span>] = <span class="number">0.0F</span>;</span><br><span class="line">tempvec[pos] = <span class="number">1.0F</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** project the point onto the plane defined by src</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ProjectPointOnPlane( dst, tempvec, src );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** normalize the result</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">VectorNormalize( dst );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 高性能计算 </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三种网络流（最大流）的实现算法讲解与代码</title>
      <link href="/2024/03/24/%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%B5%81%EF%BC%88%E6%9C%80%E5%A4%A7%E6%B5%81%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%AE%97%E6%B3%95%E8%AE%B2%E8%A7%A3%E4%B8%8E%E4%BB%A3%E7%A0%81/"/>
      <url>/2024/03/24/%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%B5%81%EF%BC%88%E6%9C%80%E5%A4%A7%E6%B5%81%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%AE%97%E6%B3%95%E8%AE%B2%E8%A7%A3%E4%B8%8E%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="洛谷P3376题解-网络流（最大流）的实现算法讲解与代码"><a href="#洛谷P3376题解-网络流（最大流）的实现算法讲解与代码" class="headerlink" title="[洛谷P3376题解]网络流（最大流）的实现算法讲解与代码"></a>[洛谷P3376题解]网络流（最大流）的实现算法讲解与代码</h1><p><a href="https://www.cnblogs.com/Icys/p/15122777.html">更坏的阅读体验</a></p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>对于给定的一个网络，<strong>有向图</strong>中每个的边权表示可以通过的最大流量。假设出发点S水流无限大，求水流到终点T后的最大流量。</p><p>起点我们一般称为<strong>源点</strong>，终点一般称为<strong>汇点</strong></p><h2 id="内容前置"><a href="#内容前置" class="headerlink" title="内容前置"></a>内容前置</h2><h3 id="1-增广路"><a href="#1-增广路" class="headerlink" title="1.增广路"></a>1.增广路</h3><p>​在一个<strong>网络</strong>从<strong>源点</strong><code>S</code>到<strong>汇点</strong><code>T</code>的一条各边剩余流量都大于0(<del>还能让水流通过,没有堵住</del>)的一条路。</p><h3 id="2-分层"><a href="#2-分层" class="headerlink" title="2.分层"></a>2.分层</h3><p>​预处理出<strong>源点</strong>到每个点的距离(<strong>每次寻找增广路都要</strong>,因为以前原本能走的路可能因为水灌满了,导致不能走了).<strong>作用</strong>是保证只往更远的地方放水,避免兜圈子或者是没事就走回头路(<del>正所谓人往高处走水往低处流</del>).</p><h3 id="3-当前弧优化"><a href="#3-当前弧优化" class="headerlink" title="3.当前弧优化"></a>3.当前弧优化</h3><p>​每次增广一条路后可以看做“榨干”了这条路，既然榨干了就没有再增广的可能了。但如果每次都扫描这些“枯萎的”边是很浪费时间的。那我们就记录一下“榨取”到那条边了，然后下一次直接从这条边开始增广，就可以节省大量的时间。这就是<strong>当前弧优化</strong></p><p>具体怎么实现呢，先把链式前向星的head数组复制一份，存进cur数组，然后在cur数组中每次记录“榨取”到哪条边了。</p><p>[#3 引用自](<a href="https://www.cnblogs.com/floatiy/p/9457809.html">Dinic当前弧优化 模板及教程 - Floatiy - 博客园 (cnblogs.com)</a>)</p><h2 id="解决算法"><a href="#解决算法" class="headerlink" title="解决算法"></a>解决算法</h2><h3 id="Ford-Fulkerson-算法-以下简称FF算法"><a href="#Ford-Fulkerson-算法-以下简称FF算法" class="headerlink" title="Ford-Fulkerson 算法(以下简称FF算法)"></a>Ford-Fulkerson 算法(<del>以下简称FF算法</del>)</h3><p>FF算法的核心是找增广路,直到找不到为止。(就是一个搜索，用尽可能多的水流填充每一个点，直到没有水用来填充，或者没有多余的节点让水流出去)。</p><p>但是这样的方法有点基于贪心的算法，找到反例是显而易见的，不一定可以得到正解。</p><p>为了解决这种问题，我们需要一个可以吃后悔药的方法——加<strong>反向边</strong>。</p><p>原本我们的DFS是一条路走到黑的，现在我们每次进入一个节点，把水流送进去，同时建立一个权值与我们送入的水流量相等，但是方向相反的路（挖一条路让水流能够反向流回来，相当于给水流吃一颗后悔药）。</p><p>我们给了FF算法一颗后悔药之后就可以让他能够找到正确的最大流。</p><p><strong>Ford-Fulkerson</strong>算法的复杂度为$O(e \times f)$ ,其中 $e$ 为边数, $f$为最大流</p><p>上代码。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N= <span class="number">256</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M= <span class="number">8192</span>*<span class="number">2</span>;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Graph</span></span><br><span class="line"><span class="type">int</span> head[N],nxt[M],to[M];</span><br><span class="line">ll dis[M];</span><br><span class="line"><span class="type">int</span> p;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> f,<span class="type">int</span> t,ll d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    to[p]=t;</span><br><span class="line">    dis[p]=d;</span><br><span class="line">    nxt[p]=head[f];</span><br><span class="line">    head[f]=p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,s,t;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ford-Fulkerson</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,ll flow)</span><span class="comment">//u是当前节点 , flow是送过来的水量</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==t)<span class="comment">// End,水送到终点了</span></span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    vis[u]=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u];i!=<span class="number">-1</span>;i=nxt[i])</span><br><span class="line">    &#123;</span><br><span class="line">        ll c;<span class="comment">//存 送水下一个节点能通到终点的最大流量</span></span><br><span class="line">        <span class="keyword">if</span>(dis[i]&gt;<span class="number">0</span> <span class="comment">//如果水流还能继续流下去</span></span><br><span class="line">            &amp;&amp; !vis[to[i]]  <span class="comment">//并且要去的点没有其他的水流去过</span></span><br><span class="line">            &amp;&amp; (c=<span class="built_in">dfs</span>(to[i],<span class="built_in">min</span>(flow,dis[i])))!=<span class="number">-1</span><span class="comment">//根据木桶效应,能传给下一个节点的水量取决于当前节点有的水量与管道(路径)能够输送的水量的最小值</span></span><br><span class="line">            <span class="comment">//要保证这条路是通的我们才可以向他送水,不然就是浪费了</span></span><br><span class="line">            ) &#123;</span><br><span class="line">                dis[i]-=c;<span class="comment">//这个管道已经被占用一部分用来送水了,需要减掉</span></span><br><span class="line">                dis[i^<span class="number">1</span>]+=c;<span class="comment">//给他的反向边加上相同的水量,送后悔药</span></span><br><span class="line">                <span class="comment">//至于为什么是这样取出反向边,下面有讲</span></span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in">sizeof</span>(head));<span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u,v,w;cin&gt;&gt;u&gt;&gt;v&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add_edge</span>(u,v,w);</span><br><span class="line">        <span class="built_in">add_edge</span>(v,u,<span class="number">0</span>);<span class="comment">//建立一条暂时无法通水的反向边(后面正向边送水后,需要加上相同的水量)</span></span><br><span class="line">        <span class="comment">//第一条边 编号是 0 ,其反向边为 1, 众所周知的 奇数^1=奇数-1, 偶数^1=偶数+1 ,利用这种性质 ,我们就可以很快求出反向边,或者反向边得出正向边(这里说的正反只是相对)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Ford-Fulkerson</span></span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    ll c;</span><br><span class="line">    <span class="comment">//          假设我们的水无限多</span></span><br><span class="line">    <span class="keyword">while</span>((c=<span class="built_in">dfs</span>(s,INF)) != <span class="number">-1</span>) <span class="comment">//把源点还能送出去的水全部都送出去,直到送不到终点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis)); <span class="comment">//重新开始送没送出去的水</span></span><br><span class="line">        ans+=c;<span class="comment">//记录总的水量</span></span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出效率比较低,我这里开了O2也过不了模板题。</p><h3 id="Edmond-Karp-算法-以下简称EK算法"><a href="#Edmond-Karp-算法-以下简称EK算法" class="headerlink" title="Edmond-Karp 算法(以下简称EK算法)"></a>Edmond-Karp 算法(<del>以下简称EK算法</del>)</h3><p>上面FF算法太慢了,原因是因为FF算法太死脑筋了,非要等现在节点水灌满了,才会灌其他的(<del>明明有一个更大的水管不灌</del>)。另外他有时候还非常<del>谦让</del>,等到明明走到了,却要返回去等别人水灌好,再灌自己的。</p><p>其实,EK算法便是FF算法的BFS版本。复杂度为$O(v \times e^2)$​(复杂度这么高行得通吗，当然可以，事实上一般情况下根本达不到这么高的上限)。</p><p>那我就直接上代码了。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N= <span class="number">256</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M= <span class="number">8192</span>*<span class="number">2</span>;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Graph</span></span><br><span class="line"><span class="type">int</span> head[N],nxt[M],to[M];</span><br><span class="line">ll dis[M];</span><br><span class="line"><span class="type">int</span> p;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> f,<span class="type">int</span> t,ll d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    to[p]=t;</span><br><span class="line">    dis[p]=d;</span><br><span class="line">    nxt[p]=head[f];</span><br><span class="line">    head[f]=p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,s,t;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Edmond-Karp</span></span><br><span class="line"><span class="type">int</span> last[N];</span><br><span class="line">ll flow[N];<span class="comment">//记录当前的点是哪条边通到来的,这样多余的水又可以这样送回去.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> <span class="comment">//水还能送到终点返回true,反之false</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(last,<span class="number">-1</span>,<span class="keyword">sizeof</span> last);</span><br><span class="line">    queue &lt;<span class="type">int</span> &gt; Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    flow[s] = INF; <span class="comment">//把起点的水量装填到无限大</span></span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k=Q.<span class="built_in">front</span>();</span><br><span class="line">        Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(k==t)<span class="comment">// End,水送到终点了</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[k];i!=<span class="number">-1</span>;i=nxt[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(dis[i]&gt;<span class="number">0</span> <span class="comment">//如果水流还能继续流下去</span></span><br><span class="line">               &amp;&amp; last[to[i]]==<span class="number">-1</span>  <span class="comment">//并且要去的点没有其他的水流去过,所以last[to[i]]还是-1</span></span><br><span class="line">               )&#123;</span><br><span class="line">                last[to[i]]=i;  <span class="comment">// 到 to[i]点 需要走 i这条边</span></span><br><span class="line">                flow[to[i]]=<span class="built_in">min</span>(flow[k],dis[i]);<span class="comment">//根据木桶效应,能传给下一个节点的水量取决于当前节点有的水量与管道(路径)能够输送的水量的最小值</span></span><br><span class="line">                Q.<span class="built_in">push</span>(to[i]);  <span class="comment">//入队</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> last[t]!=<span class="number">-1</span>;<span class="comment">//能够送到终点</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in">sizeof</span>(head));<span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u,v,w;cin&gt;&gt;u&gt;&gt;v&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add_edge</span>(u,v,w);</span><br><span class="line">        <span class="built_in">add_edge</span>(v,u,<span class="number">0</span>);<span class="comment">//建立一条暂时无法通水的反向边(后面正向边送水后,需要加上相同的水量)</span></span><br><span class="line">        <span class="comment">//第一条边 编号是 0 ,其反向边为 1, 众所周知的 奇数^1=奇数-1, 偶数^1=偶数+1 ,利用这种性质 ,我们就可以很快求出反向边,或者反向边得出正向边(这里说的正反只是相对)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Edmond-Karp</span></span><br><span class="line">    ll maxflow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())<span class="comment">//把源点还能送出去的水全部都送出去,直到送不到终点</span></span><br><span class="line">    &#123;</span><br><span class="line">        maxflow+=flow[t];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=t;i!=s;i=to[last[i]^<span class="number">1</span>])<span class="comment">//还有多余的水残留在管道里,怪可惜的,原路送回去.</span></span><br><span class="line">        &#123;</span><br><span class="line">            dis[last[i]]-=flow[t];  <span class="comment">//这个管道已经被占用一部分用来送水了,需要减掉</span></span><br><span class="line">            dis[last[i]^<span class="number">1</span>]+=flow[t];    <span class="comment">//给他的反向边加上相同的水量,送后悔药</span></span><br><span class="line">            <span class="comment">//至于为什么是这样取出反向边,上面有讲</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;maxflow&lt;&lt;endl;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>于是我们AC了这题。</p><h3 id="还能不能更快-Dinic算法"><a href="#还能不能更快-Dinic算法" class="headerlink" title="还能不能更快? Dinic算法"></a>还能不能更快? Dinic算法</h3><p><strong>FF</strong>和<strong>EK</strong>算法都有个比较严重的问题.他们每次都只能找到一条增广路(<del>到终点没有被堵上的路</del>).Dinic算法不仅用到了DFS,还用的了BFS.但是他们发挥的作用是不一样的。</p><table><thead><tr><th>种类</th><th>作用</th></tr></thead><tbody><tr><td>DFS</td><td>寻找路</td></tr><tr><td>BFS</td><td>分层(<del>内容前置里有讲哦</del>)</td></tr></tbody></table><p>Dinic快就快在可以<strong>多路增广</strong>(<del>兵分三路把你干掉</del>),这样我们可以节省很多走重复路径的时间.当找到一条增广路后,DFS会尝试用剩余的流量向其他地方扩展.找到新的增广路。</p><p><del>就这???</del></p><p>当然不止,Dinic还有<strong>当前弧优化</strong>(<del>前面也有哦</del>)，总之就是放弃被<strong>榨干</strong>的路。</p><p>这样的一通操作之后，复杂度来到了$O(v^2 \times e)$​</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">256</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">8192</span> * <span class="number">2</span>;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Graph</span></span><br><span class="line"><span class="type">int</span> head[N], nxt[M], to[M];</span><br><span class="line">ll dis[M];</span><br><span class="line"><span class="type">int</span> p;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> f, <span class="type">int</span> t, ll d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    to[p] = t;</span><br><span class="line">    dis[p] = d;</span><br><span class="line">    nxt[p] = head[f];</span><br><span class="line">    head[f] = p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// End</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, s, t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Dinic</span></span><br><span class="line"><span class="type">int</span> level[N], cur[N];</span><br><span class="line"><span class="comment">//level是各点到起点的深度，cur为当前弧优化的增广起点</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> <span class="comment">//分层函数,其实就是个普通广度优先搜索，没什么好说的，作用是计算边权为1的图，图上各点到源点的距离</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(level, <span class="number">-1</span>, <span class="built_in">sizeof</span>(level));</span><br><span class="line">    level[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(head));</span><br><span class="line">    cur[s]=head[s];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">while</span> (!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k = Q.<span class="built_in">front</span>();</span><br><span class="line">        Q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[k]; i != <span class="number">-1</span>; i = nxt[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//还能够通水的管道才有价值</span></span><br><span class="line">            <span class="keyword">if</span> (dis[i] &gt; <span class="number">0</span> &amp;&amp; level[to[i]] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                level[to[i]] = level[k] + <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(to[i]);</span><br><span class="line">                <span class="keyword">if</span>(to[i]==t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, ll flow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == t)</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line"></span><br><span class="line">    ll flow_now = flow; <span class="comment">// 剩余的流量</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = cur[u]; i != <span class="number">-1</span> &amp;&amp; flow_now &gt; <span class="number">0</span>; i = nxt[i])</span><br><span class="line">    &#123;</span><br><span class="line">        cur[u] = i; <span class="comment">//当前弧优化</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果水流还能继续流下去   并且    是向更深处走的</span></span><br><span class="line">        <span class="keyword">if</span> (dis[i] &gt; <span class="number">0</span> &amp;&amp; level[to[i]] == level[u] + <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ll c = <span class="built_in">dfs</span>(to[i], <span class="built_in">min</span>(dis[i], flow_now));</span><br><span class="line">            <span class="keyword">if</span>(!c) level[to[i]]=<span class="number">-1</span>;  <span class="comment">//剪枝，去除增广完毕的点</span></span><br><span class="line">        </span><br><span class="line">            flow_now -= c;  <span class="comment">//剩余的水流被用了c</span></span><br><span class="line"></span><br><span class="line">            dis[i] -= c;    <span class="comment">//这个管道已经被占用一部分用来送水了,需要减掉</span></span><br><span class="line">            dis[i ^ <span class="number">1</span>] += c;    <span class="comment">//给他的反向边加上相同的水量,送后悔药</span></span><br><span class="line">            <span class="comment">//至于为什么是这样取出反向边,下面有讲</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow - flow_now; <span class="comment">//返回用掉的水流</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//End</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(head)); <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        <span class="built_in">add_edge</span>(u, v, w);</span><br><span class="line">        <span class="built_in">add_edge</span>(v, u, <span class="number">0</span>); <span class="comment">//建立一条暂时无法通水的反向边(后面正向边送水后,需要加上相同的水量)</span></span><br><span class="line">        <span class="comment">//第一条边 编号是 0 ,其反向边为 1, 众所周知的 奇数^1=奇数-1, 偶数^1=偶数+1 ,利用这种性质 ,我们就可以很快求出反向边,或者反向边得出正向边(这里说的正反只是相对)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Dinic</span></span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>())</span><br><span class="line">        ans += <span class="built_in">dfs</span>(s, INF);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个算法如果应用在二分图里，复杂度为$O(v \times sqrt(e))$</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.《算法竞赛进阶指南》作者：李煜东</p><p>2.《<a href="%5B%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(28">算法学习笔记(28): 网络流</a>: 网络流 - 知乎 (zhihu.com)](<a href="https://zhuanlan.zhihu.com/p/122375531))%E3%80%8B">https://zhuanlan.zhihu.com/p/122375531))》</a> 作者：<a href="https://www.zhihu.com/people/one">Pecco</a></p><p>3.《[Dinic当前弧优化 模板及教程](<a href="https://www.cnblogs.com/floatiy/p/9457809.html">Dinic当前弧优化 模板及教程 - Floatiy - 博客园 (cnblogs.com)</a>)》作者：<a href="https://www.cnblogs.com/floatiy/">Floatiy</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 网络流 </tag>
            
            <tag> 图论 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/03/24/hello-world/"/>
      <url>/2024/03/24/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
